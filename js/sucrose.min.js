/*
Copyright 2018 SugarCRM, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.sucrose={},t.d3)})(this,function(t,e){"use strict";function n(t,e,n){return function(){var r=n.apply(e,arguments);return r===e?t:r}}function r(){function t(i){return i.each(function(i){function o(t,e,n){return{point:e,seriesKey:e.key,seriesIndex:e.seriesIndex,e:t}}var d=e.select(this),h=r-n.left-n.right,p=a-n.top-n.bottom,g="linear"===y?e.curveLinear:"cardinal"===y?e.curveCardinal:"monotone"===y?e.curveMonotoneX:"basis"===y?e.curveBasis:e.curveNatural,b=[["zero","wiggle","expand","silhouette"].indexOf(m)],x=[e.stackOffsetNone,e.stackOffsetWiggle,e.stackOffsetExpand,e.stackOffsetSilhouette][b],w=[["default","inside-out"].indexOf(v)],k=[e.stackOrderNone,e.stackOrderInsideOut][w],T=e.stack().offset(x).order(k).value(function(t,e){return t[e]}),E={};i.forEach(function(t,e){t.values.forEach(function(t,e){var n=t.x,r=t.y;E[n]||(E[n]=[],E[n].x=n),E[n].push(r)})});var N=e.keys(E),P=N.map(function(t){return parseInt(t,10)}),z=T.keys(e.range(0,i.length))(e.values(E)),O=e.min(z,function(t){return e.min(t,function(t){return e.min(t,function(t){return t})})}),_=e.max(z,function(t){return e.max(t,function(t){return e.max(t,function(t){return t})})});z.forEach(function(t,e){t.key=i[e].key,t.seriesIndex=i[e].seriesIndex,t.total=i[e].total,t.color=i[e].color,t["class"]=i[e].classes,t.forEach(function(t,n){t.seriesIndex=i[e].seriesIndex,t.si0=e-1,O&&(t[0]-=O,t[1]-=O)})});var H=e.area().curve(g).x(function(t){return l(t.data.x)}).y0(function(t,e){var n=D?D[t.si0]:null;return L(n&&n[e]?n[e][1]:0)}).y1(function(t,e){var n=D?D[t.si0]:null;return L(n&&n[e]?n[e][1]:0)}),B=e.area().curve(g).x(function(t){return l(t.data.x)}).y0(function(t){return c(t[0])}).y1(function(t){return c(t[1])}),R=e.area().curve(g).x(function(t){return l(t.data.x)}).y0(function(t,e){var n=z[t.si0];return c(n&&n[e]?n[e][1]:0)}).y1(function(t,e){var n=z[t.si0];return c(n&&n[e]?n[e][1]:0)}),V=e.transition("area").duration(f).ease(e.easeLinear);l.domain(e.extent(P)).range([0,h]),c.domain([0,_-O]).range([p,0]),t.resetDimensions=function(t,e){r=t,a=e,h=t-n.left-n.right,p=e-n.top-n.bottom,l.range([0,h]),c.range([p,0])};var G=d.selectAll("g.sc-wrap.sc-area").data([z]),W=G.enter().append("g").attr("class","sc-wrap sc-area"),Y=d.select(".sc-wrap.sc-area").merge(W),q=W.append("defs"),X=Y.select("defs");W.append("g").attr("class","sc-group");var j=Y.select(".sc-group");Y.attr("transform",S.translation(n.left,n.top)),q.append("clipPath").attr("id","sc-edge-clip-"+s).append("rect"),X.select("#sc-edge-clip-"+s+" rect").attr("width",h).attr("height",p),Y.attr("clip-path",u?"url(#sc-edge-clip-"+s+")":""),t.gradientFill=function(t,e,n){var r=s+"-"+e,a=M(t,e);return A(t,r,n,a,X)};var K=j.selectAll("g.sc-series").data(z,function(t){return t.seriesIndex}),Z=K.enter().append("g").attr("class","sc-series").style("stroke-opacity",1e-6).style("fill-opacity",1e-6),U=j.selectAll(".sc-series").merge(Z);U.attr("fill",I).attr("stroke",M).attr("class",C).classed("hover",function(t){return t.hover}),U.transition(V).style("stroke-opacity",1).style("fill-opacity",.5),K.exit().transition(V).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove();var $=U.selectAll("path.sc-area").data(function(t){return[t]}),J=$.enter().append("path").attr("class","sc-area sc-enter"),Q=U.selectAll(".sc-area").merge(J);Q.filter(function(t){return e.select(this).classed("sc-enter")}).attr("d",H),Q.transition(V).attr("d",B).on("end",function(t){e.select(this).classed("sc-enter",!1),D=z.map(function(t){return t.map(function(t){return[t[0],t[1]]})}),L=c.copy()}),K.exit().transition(V).selectAll(".sc-area").attr("d",R).remove(),Q.on("mouseover",function(t,n){var r=o(e.event,t,n);F.call("elementMouseover",this,r),e.select(this).classed("hover",!0)}).on("mousemove",function(t,n){var r=o(e.event,t,n),a=Y.select("#sc-edge-clip-"+s+" rect").node().getBoundingClientRect(),i=e.event.clientX-a.left,l=Math.round(i*P.length/h)-1;r.data=z.map(function(t,e){var n=[t[l].data.x,t[l][1]];return n.seriesKey=t.key,n.seriesIndex=t.seriesIndex,n}),r.pointIndex=l,r.origin=a,F.call("elementMousemove",this,r)}).on("mouseout",function(t,n){F.call("elementMouseout",this),e.select(this).classed("hover",!1)}).on("click",function(t,n){var r=o(e.event,t,n);e.event.stopPropagation(),e.select(this).classed("hover",!1),F.call("elementClick",this,r)}),L=c.copy()}),t}var n={top:0,right:0,bottom:0,left:0},r=960,a=500,i=function(t){return t.x},o=function(t){return t.y},s=Math.floor(1e5*Math.random()),l=e.scaleLinear(),c=e.scaleLinear(),u=!1,d=0,f=0,h=S.buildLocality(),p="ltr",g="stack",m="zero",v="default",y="linear",b=null,x=null,w=[],k=[],M=function(t,e){return S.defaultColor()(t,t.seriesIndex)},A=S.colorLinearGradient,I=M,C=function(t,e){return"sc-area sc-series-"+t.seriesIndex},F=e.dispatch("tooltipShow","tooltipHide","tooltipMove","elementClick","elementMouseover","elementMouseout","elementMousemove"),D,L=c.copy();return t.dispatch=F,t.id=function(e){return arguments.length?(s=e,t):s},t.color=function(e){return arguments.length?(M=e,t):M},t.fill=function(e){return arguments.length?(I=e,t):I},t.classes=function(e){return arguments.length?(C=e,t):C},t.gradient=function(e){return arguments.length?(A=e,t):A},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.clipEdge=function(e){return arguments.length?(u=e,t):u},t.x=function(e){return arguments.length?(i=e,t):i},t.y=function(e){return arguments.length?(o=e,t):o},t.xScale=function(e){return arguments.length?(l=e,t):l},t.yScale=function(e){return arguments.length?(c=e,t):c},t.xDomain=function(e){return arguments.length?(b=e,t):b},t.yDomain=function(e){return arguments.length?(x=e,t):x},t.forceX=function(e){return arguments.length?(w=e,t):w},t.forceY=function(e){return arguments.length?(k=e,t):k},t.delay=function(e){return arguments.length?(d=e,t):d},t.duration=function(e){return arguments.length?(f=e,t):f},t.locality=function(e){return arguments.length?(h=S.buildLocality(e),t):h},t.direction=function(e){return arguments.length?(p=e,t):p},t.interpolate=function(e){return arguments.length?(y=e,t):y},t.offset=function(e){return arguments.length?(m=e,t):m},t.order=function(e){return arguments.length?(v=e,t):v},t.style=function(e){if(!arguments.length)return g;switch(g=e){case"stack":t.offset("zero"),t.order("default");break;case"stream":t.offset("wiggle"),t.order("inside-out");break;case"stream-center":t.offset("silhouette"),t.order("inside-out");break;case"expand":t.offset("expand"),t.order("default")}return t},t}function a(){function t(d){return d.each(function(d){function m(){return G.range().length>1?Math.abs(G.range()[1]-G.range()[0]):0}function b(){return G.range().length>1?Math.max(.25,1-S.round(G.bandwidth()/m(),2)):0}function x(){return"function"==typeof G.rangeExtent?G.rangeExtent():G.range()}function w(){return h?G.bandwidth():0}function k(){return h?G.range()[0]:0}function M(){return k()/D()}function D(){var t=0,n;return h?t=G.range().length>1?Math.abs(G.range()[1]-G.range()[0]):e.max(x())/2:(n=G.ticks(ot.size()),t=G(n[n.length-1])-G(n[n.length-2])),t}function L(t){if("rtl"===o){if("start"===t)return"end";if("end"===t)return"start"}return t}function T(){return"left"!==s&&"bottom"!==s}function E(t){t=t||1,I=C.tickPadding()+(X?K:Z)*t}function N(){P(),K=e.max(Q,function(t){return t.width}),Z=e.max(Q,function(t){return t.height})}function P(){Q=[],tt={},a&&ut.attr("transform",function(t,e){var n=X?"0,"+G(t):G(t)+",0";return"translate("+n+")"}),ft.each(function(t,e){var n=this.getBoundingClientRect();n.width>0&&Q.push({key:t,width:parseInt(n.width,10),height:parseInt(n.height,10),left:n.left,right:n.right,top:n.top,bottom:n.bottom})}),Q.sort(function(t,e){return t.key-e.key}).forEach(function(t,e){t.index=e,tt["key-"+t.key.toString()]=t}),et=Q[0],nt=Q[Q.length-1]}function z(t){P();for(var e=a?2:t||1,n=a?1:0,r=Q.length-e;r>n;n+=1)if(Q[n].right+U>Q[n+t].left)return!0;return!1}function O(t){var e=t?(t+180)%180:0,n=e>90,r=null,a=null;if(Q.forEach(function(t,i){var o=null===r||t.left<=r,s=null===a||t.right>=a,l=0,c=0,u=0;(o||s)&&(u=e?t.width-6:t.width/2,l=G(t.key)+h*w()/2,!o||e&&!n||(r=t.left,c=Math.abs(Y[0]-l),W.left=Math.max(u-c,0)),!s||e&&n||(a=t.right,c=Math.abs(Y[1]-l),W.right=Math.max(u-c,0)))}),!h){var i=A.right-Math.max(A.right,W.right);i+=A.left-Math.max(A.left,W.left);var o=[Y[0],Y[1]+i];G.range(o),Y=x(),q=Math.abs(Y[1]-Y[0]),C.scale(G),it.call(C)}}function _(){W={top:0,right:0,bottom:0,left:0},G=n.copy(),Y=x(),q=Math.abs(Y[1]-Y[0]),C.scale(n),it.call(C),ft.selectAll("tspan").remove(),ft.attr("dy",X?".32em":.355+.355*j+"em").attr("x",X?C.tickPadding()*j:0).attr("y",X?0:C.tickPadding()*j).attr("transform","translate(0,0)").style("text-anchor","middle").style("opacity",1),dt.text(function(t,e,n){return v(t,e,n,"maxmin")}),N(),E()}function H(){var t=D();ft.each(function(n,r,a){var i=v(n,r,a,"no-ellipsis"),o=e.select(this),s=S.isValidDate(S.parseDatetime(i)),l=1===j?.71:-1,c=0,u=(i&&""!==i?s?i:i.replace("/","/ "):[]).split(" "),d=u.length;this.textContent="";var f,h=o.append("tspan").text(u[c]+" ").attr("dy",l+"em").attr("x",0);for(c+=1,l=1;d>c;)for(h=o.append("tspan").text(u[c]+" ").attr("dy",l+"em").attr("x",0),c+=1;d>c;){if(f=h.text(),h.text(f+" "+u[c]),!(this.getBoundingClientRect().width<=t)){h.text(f);break}c+=1}}),N(),E()}function B(){ft.attr("transform",function(t,e){var n=tt["key-"+t.toString()].index%2*Z;return"translate(0,"+n+")"}),N(),E(2)}function R(t){var e=(t+180)%180,n=e>90,r=(e-(n?180:0))*j,a=L(n?"end":"start"),i=Math.abs(Math.cos(t*Math.PI/180));ft.attr("transform",function(t,e,n){return"translate(0,"+C.tickPadding()*j+") rotate("+r+")"}).attr("y","0").style("text-anchor",a),N(),E()}var V=e.select(this),G=C.scale().copy(),W={top:0,right:0,bottom:0,left:0},Y=x(),q=Math.abs(Y[1]-Y[0]);F=F||C.scale();var X="left"===s||"right"===s?!0:!1,j="left"===s||"top"===s?-1:1,K=0,Z=0,U=6,$=0,J=0,Q=[],tt={},et={},nt={};I=0,null!==g?C.ticks(g):X?C.ticks(Math.ceil(q/48)):C.ticks(Math.ceil(q/100)),C.tickFormat(function(t,e,n){return v(t,e,n,"axis")}),u&&!S.isNumeric(String(u))&&(u=30),h&&(a=!1);var rt=V.selectAll("g.sc-wrap.sc-axis").data([d]),at=rt.enter().append("g").attr("class","sc-wrap sc-axis").append("g").attr("class","sc-axis-inner"),it=V.select(".sc-axis-inner").merge(at);it.call(C);var ot=it.selectAll("g.tick"),st=a?e.extent(n.domain()):[],lt=it.selectAll("g.sc-axisMaxMin").data(st),ct=lt.enter().append("g").attr("class","sc-axisMaxMin");lt.exit().remove();var ut=it.selectAll("g.sc-axisMaxMin").merge(ct);ct.append("text").style("opacity",1);var dt=ut.select("text"),ft=it.selectAll("g.tick, g.sc-axisMaxMin").select("text").filter(function(t){return this.getBoundingClientRect().width}),ht=r?[r]:[],pt=it.selectAll("text.sc-axislabel").data(ht),gt=pt.enter().append("text").attr("class","sc-axislabel");pt.exit().remove();var mt=it.selectAll("text.sc-axislabel").merge(gt);mt.text(S.identity);var vt=!1,yt=!1,bt=!1;if(X?(_(!0),ft.style("text-anchor",L(p||(T()?"start":"end")))):(_(!1),O(),z(1)&&(l&&(_(!1),H(),O(),H(),z(1)||(vt=!0)),!vt&&c&&(_(!1),B(),O(),B(),z(2)||(yt=!0)),vt||yt||(u||(u=30),_(!0),X||(J=Z/Math.sin(u*Math.PI/180)),R(u),O(u),R(u),bt=!0))),a?ot.each(function(t,n){var r=e.select(this),a=tt["key-"+t.toString()],i=!1,o=G(t)===Y[0]||G(t)===Y[1];i=o?!0:X?et.top-a.bottom+1<0||a.top-nt.bottom<0:bt?a.left-J/2<et.left||a.left+J/2>nt.left:yt?(a.left-U<et.right||a.right+U>nt.left)&&(a.bottom===et.bottom||a.bottom<et.top||a.top>nt.bottom):a.left-U<et.right||a.right+U>nt.left,r.select("line").classed("extent",o),r.select("text").style("opacity",1-i)}):ot.select("line").style("stroke-opacity",function(t){return G(t)===Y[0+T()]?0:null}),ot.filter(function(t){return 1e-10>t&&t>-1e-10&&G(t)!==Y[0]&&G(t)!==Y[1]}).select("line").classed("zero",i),r){var xt=X?f?q/-2:(I+y)*j:q/2,wt=X?f?(I+y)*j:q/2:(I+y)*j;mt.attr("x",xt).attr("y",wt).attr("dy",.355+.355*j+"em").attr("transform",X&&f?"rotate(-90)":"").style("text-anchor",X&&!f?L("end"):"middle"),mt.each(function(t,e){$+=X?parseInt(this.getBoundingClientRect().width/1.3,10):parseInt(this.getBoundingClientRect().height/1.3,10)}),I+=$+y}F=n.copy(),A={top:W.top,right:W.right,bottom:W.bottom,left:W.left},A[s]=I,t.resizeTickLines=function(t){it.selectAll("g.tick, g.sc-axisMaxMin").select("line").attr(X?"x2":"y2",t*j)},t.labelThickness=function(){return $}}),t}var n=e.scaleLinear(),r=null,a=!0,i=!0,o="ltr",s="bottom",l=!1,c=!1,u=30,d=!1,f=!0,h=!1,p=null,g=null,m=4,v=function(t){return t},y=8,b,x,w,k,M,A={top:0,right:0,bottom:0,left:0},I=0,C=e.axisBottom(),F;return t.axis=C,S.rebind(t,n,"domain","range"),t.width=function(e){return arguments.length?t:I},t.height=function(e){return arguments.length?t:I},t.margin=function(e){return arguments.length?(A=e,t):A},t.ticks=function(e){return arguments.length?(g=e,t):g},t.axisLabel=function(e){return arguments.length?(r=e,t):r},t.showMaxMin=function(e){return arguments.length?(a=e,t):a},t.highlightZero=function(e){return arguments.length?(i=e,t):i},t.wrapTicks=function(e){return arguments.length?(l=e,t):l},t.rotateTicks=function(e){return arguments.length?(u=e,t):u},t.staggerTicks=function(e){return arguments.length?(c=e,t):c},t.reduceXTicks=function(e){return arguments.length?(d=e,t):d},t.rotateYLabel=function(e){return arguments.length?(f=e,t):f},t.axisLabelDistance=function(e){return arguments.length?(y=e,t):y},t.textAnchor=function(e){return arguments.length?(p=e,t):p},t.direction=function(e){return arguments.length?(o=e,t):o},t.orient=function(n){return arguments.length?(s=n,C="bottom"===s?e.axisBottom():"right"===s?e.axisRight():"left"===s?e.axisLeft():"top"===s?e.axisTop():e.axisBottom(),t):s},t.scale=function(e){return arguments.length?(n=e,C.scale(n),h="function"==typeof n.padding,S.rebind(t,n,"domain","range"),t):n},t.valueFormat=function(e){return arguments.length?(v=e,t):v||C.tickFormat()},t.tickFormat=function(e){return arguments.length?(b=e,C.tickFormat(e),t):b||C.tickFormat()},t.tickValues=function(e){return arguments.length?(x=e,C.tickValues(e),t):x},t.tickSize=function(e){return arguments.length?(w=e,C.tickSize(e),t):w},t.tickPadding=function(e){return arguments.length?(m=e,C.tickPadding(e),t):m},t.tickSizeInner=function(e){return arguments.length?(k=e,C.tickSizeInner(e),t):k},t.tickSizeOuter=function(e){return arguments.length?(M=e,C.tickSizeOuter(e),t):M},t}function i(){function t(o){return o.each(function(o){function f(){D=G(ut),L=W(),T=Y(ut)}function h(){var t=V(L,D),n=0,r=4,a=D-2*w*L,i=L;o.forEach(function(e,o){e.values.forEach(function(e){e._height=ct>0?R(t*e.value/ct,a):0,e._height<r?(n+=e._height-r,e._height=r):0>n&&e._height+n>r&&(e._height+=n,n=0),e._base=a,e._bottom=i,e._top=e._bottom-e._height,a+=2*w*e._height,i-=e._height})});var s=M||e.extent(e.merge(o.map(function(t){return t.values.map(function(t){return t._top})})).concat(A));k.domain(s).range([L,0])}function p(){It.selectAll("polyline").remove(),It.selectAll("rect").remove(),It.selectAll("text").remove(),It.append("rect").attr("class","sc-label-box").attr("x",0).attr("y",0).attr("width",0).attr("height",0).attr("rx",2).attr("ry",2).style("pointer-events","none").style("stroke-width",0).style("fill-opacity",0),It.append("text").text(c).call(tt,"sc-label",.85,"middle",J),It.select(".sc-label").call(O,I?z:_,q,function(t,e){tt(t,"sc-label",e,"middle",J)}),It.append("text").text(u).call(tt,"sc-value",.85,"middle",J),It.select(".sc-value").append("tspan").text(d),It.call(et).call(K).call(nt),It.classed("sc-label-side",function(t){return t.tooTall||t.tooWide})}function E(){var t=0,n=0,r,a,i,o;for(Ct=It.filter(".sc-label-side"),Ct.selectAll(".sc-label").remove(),Ct.selectAll("rect").remove(),Ct.selectAll("polyline").remove(),Ct.append("text").text(c).call(tt,"sc-label",.85,"start","#555"),Ct.select(".sc-label").call(O,I?z:_,I?X:H,function(t,e){tt(t,"sc-label",e,"start","#555")}),Ct.call(et),Ct.select(".sc-value").style("text-anchor","start").style("fill","#555"),Ct.call(Z),r=Ct.nodes(),i=r.length-1;i>=0;i-=1)if(n=e.select(r[i]).data()[0]){if(!t){n.labelBottom=n.labelTop+n.labelHeight+st,t=n.labelBottom;continue}n.labelTop=Math.max(t,n.labelTop),n.labelBottom=n.labelTop+n.labelHeight+st,t=n.labelBottom}if(t&&t-st>e.max(k.range())){for(t=0,r=Ct.nodes(),a=0,o=r.length;o>a;a+=1)if(n=e.select(r[a]).data()[0]){if(!t){n.labelBottom=L-1,n.labelTop=n.labelBottom-n.labelHeight,t=n.labelTop;continue}n.labelBottom=Math.min(t,n.labelBottom),n.labelTop=n.labelBottom-n.labelHeight-st,t=n.labelTop}0>t&&Ct.each(function(e){e.labelTop-=t,e.labelBottom-=t})}t=0,Ct.call($)}function N(){p(),E()}function P(t,e,n){return{id:i,key:c(e),value:s(e),count:l(e),data:e,series:e.series,seriesIndex:e.series.seriesIndex,e:t}}function z(t,n,r,a){var i=n.text(),o=parseFloat(n.attr("dy")),s,l=i.split(/\s+/).reverse(),c=[],u=0,d=r(t,0),f=e.select(n.node().parentNode);for(n.text(null);s=l.pop();)c.push(s),n.text(c.join(" ")),n.node().getBoundingClientRect().width>d&&c.length>1&&(c.pop(),n.text(c.join(" ")),c=[s],n=f.append("text"),n.text(s).call(a,1.1*++u+o))}function O(t,n,r,a){t.each(function(t){var i=e.select(this);n(t,i,r,a)})}function _(t,e,n,r){var a=e.text(),i=parseFloat(e.attr("dy")),o=n(t);e.text(S.stringEllipsify(a,it,o)).call(r,i)}function H(t){var e=Math.max(rt-at/1.1,C),n=t._bottom,r=n*w,a=e+r,i=Math.abs(t.labelBottom-n),o=i*w,s=ot+o+ot+ot,l=a-s;return Math.max(l,C)}function B(t,e,n){var r=t._bottom,a=t._top,i=n/2-w*r,o=n/2-w*a,s=T;return s-i+","+r*e+" "+(s-o)+","+a*e+" "+(s+o)+","+a*e+" "+(s+i)+","+r*e}function R(t,e){var n=e/w/2;return Math.abs(Math.sqrt(t/w+n*n))-n}function V(t,e){return t*(e-t*w)}function G(t){return Math.round(Math.max(Math.min(at/1.1,rt-t),40))}function W(){return Math.min(1.1*D,(D-D*w)/(2*w))}function Y(t){return D/2+t}function q(t){var e=D,n=t._bottom-t._height/2;return e-n*w*2}function X(t,e){var n=Math.max((rt-D)/2,e),r=t._top;return n+r*w}function j(t){return e.select(t).node().getBoundingClientRect()}function K(t){t.each(function(t){var e=j(this);t.labelHeight=e.height,t.labelWidth=e.width,t.labelTop=t._bottom-t._height/2-t.labelHeight/2,t.labelBottom=t.labelTop+t.labelHeight+st,t.tooWide=t.labelWidth>q(t),t.tooTall=t.labelHeight>t._height-4})}function Z(t){t.each(function(t){var e=j(this);t.labelHeight=e.height,t.labelWidth=e.width,t.labelTop=t._top,t.labelBottom=t.labelTop+t.labelHeight+st})}function U(t){for(var n=t.size(),r=t.nodes(),a=r.length-1;a>=0;--a){var i=e.select(r[a]),o=i.data()[0],s=n-1>a?e.select(r[a+1]).data()[0]:null,l=a?e.select(r[a-1]).data()[0]:null,c=Math.round(o.labelHeight)+.5,u=Math.round(o._bottom-o.labelTop)-.5,d=s?s.labelWidth-(o.labelBottom-s.labelBottom)*w:0,f=o.labelWidth,h=l&&u>c?l.labelWidth:0,p=Math.round(Math.max(d,f,h))+ot,g=Math.round(X(o,ut))-lt-ot,m="0,"+c+" "+p+","+c+" "+(p+Math.abs(c-u)*w)+","+u+" "+g+","+u;o.labelWidth=p,i.attr("points",m)}}function $(t){var e=(rt-D)/2,n=0;t.each(function(t){var e=t._bottom,r=Math.abs(t.labelBottom+ot-e)*w,a=e*w,i=t.labelWidth+r+3*ot-a;i>=n&&(n=i)}),n=Math.round(10*n)/10,0>=n?(lt=e,ut=e):n>0&&e>n?(lt=e-n,ut=e):(lt=0,ut=n)}function J(t,n,r){var a=t.series||t,i=a.seriesIndex||n,o=y(a),s="inherit"===o?e.select("."+x(a,i).split(" ").join(".")).style("color"):o;return S.getTextContrast(s,i)}function Q(t){return S.isRTLChar(t.slice(-1))?"rtl":"ltr"}function tt(t,e,n,r,a){t.attr("x",0).attr("y",0).attr("dy",n+"em").attr("class",e).attr("direction",function(){return"ltr"}).style("pointer-events","none").style("text-anchor",r).style("fill",a)}function et(t){t.each(function(t){var n=e.select(this),r=n.selectAll(".sc-label").size()+1,a=.85+r-1+"em";n.select(".sc-value").attr("dy",a)})}function nt(t){t.each(function(t,n){var r=e.select(this);r.select(".sc-label-box").attr("x",(t.labelWidth+6)/-2).attr("y",-2).attr("width",t.labelWidth+6).attr("height",t.labelHeight+4).attr("rx",2).attr("ry",2).style("fill-opacity",1)})}var rt=r-n.left-n.right,at=a-n.top-n.bottom,it=e.select(this),ot=5,st=5,lt=0,ct=0,ut=0;ct=e.sum(o,function(t){return t.value}),f(),h();var dt=it.selectAll("g.sc-wrap").data([o]),ft=dt.enter().append("g").attr("class","sc-wrap sc-funnel"),ht=it.select(".sc-wrap.sc-funnel").merge(ft),pt=ft.append("defs"),gt=ht.select("defs");if(ht.attr("transform",S.translation(n.left,n.top)),b)var mt=S.createTexture(pt,i);t.gradientFill=function(t,e,n){var r=i+"-"+e,a=m(t,e);return v(t,r,n,a,gt)};var vt=ht.selectAll(".sc-series").data(o,function(t){return t.seriesIndex}),yt=vt.enter().append("g").attr("class","sc-series");vt.exit().remove();var bt=ht.selectAll(".sc-series").merge(yt);yt.style("stroke","#FFF").style("stroke-width",2).style("stroke-opacity",1).on("mouseover",function(t,n,r){e.select(this).classed("hover",!0)}).on("mouseout",function(t,n,r){e.select(this).classed("hover",!1)}),bt.attr("class",function(t){return x(t,t.seriesIndex)}).attr("fill",function(t){return y(t,t.seriesIndex)}).classed("sc-active",function(t){return"active"===t.active}).classed("sc-inactive",function(t){return"inactive"===t.active}),bt.transition().duration(g).style("stroke-opacity",1).style("fill-opacity",1);var xt=bt.selectAll("g.sc-slice").data(function(t){return t.values},function(t){return t.seriesIndex});xt.exit().remove();var wt=xt.enter().append("g").attr("class","sc-slice"),kt=bt.selectAll("g.sc-slice").merge(wt);wt.append("polygon").attr("class","sc-base"),kt.select("polygon.sc-base").attr("points",function(t){return B(t,0,D)}),b&&(wt.append("polygon").attr("class","sc-texture").style("mask","url("+mt+")"),kt.select("polygon.sc-texture").attr("points",function(t){return B(t,0,D)})),wt.on("mouseover",function(t,n){e.select(this).classed("hover",!0);var r=P(e.event,t,n);F.call("elementMouseover",this,r)}).on("mousemove",function(t,n){var r=e.event;F.call("elementMousemove",this,r)}).on("mouseout",function(t,n){e.select(this).classed("hover",!1),F.call("elementMouseout",this)}).on("click",function(t,n){e.event.stopPropagation();var r=P(e.event,t,n);F.call("elementClick",this,r)}).on("dblclick",function(t,n){e.event.stopPropagation();var r=P(e.event,t,n);F.call("elementDblClick",this,r)});var Mt=bt.selectAll(".sc-label-value").data(function(t){return t.values},function(t){return t.seriesIndex});Mt.exit().remove();var At=Mt.enter().append("g").attr("class","sc-label-value"),It=bt.selectAll("g.sc-label-value").merge(At);It.attr("transform","translate("+T+",0)");var Ct=It.filter(".sc-label-side");N(),f(),h(),N(),f(),h(),N(),f(),h(),kt.select(".sc-base").attr("points",function(t){return B(t,1,D)}),b&&kt.selectAll(".sc-texture").attr("points",function(t){return B(t,1,D)}).style("fill",J),It.attr("transform",function(t){var e=t.tooTall?0:T,n=t.tooTall?0:t.labelTop;return"translate("+e+","+n+")"}),Ct.attr("transform",function(t){return"translate("+lt+","+t.labelTop+")"}),Ct.append("polyline").attr("class","sc-label-leader").style("fill-opacity",0).style("stroke","#999").style("stroke-width",1).style("stroke-opacity",.5),Ct.selectAll("polyline").call(U)}),t}var n={top:0,right:0,bottom:0,left:0},r=960,a=500,i=Math.floor(1e4*Math.random()),o=function(t){return(t.series||t).key},s=function(t,e){return(t.series||t).value},l=function(t,e){return(t.series||t).count},c=function(t){return o(t)},u=function(t){return s(t)},d=function(t){return isNaN(l(t))?"":" ("+l(t)+")"},f=S.buildLocality(),h="ltr",p=0,g=0,m=function(t,e){return S.defaultColor()(t,t.seriesIndex)},v=S.colorLinearGradient,y=m,b=!1,x=function(t,e){return"sc-series sc-series-"+t.seriesIndex},w=.3,k=e.scaleLinear(),M=null,A=[0],I=!0,C=75,F=e.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove"),D=0,L=0,T=0;return t.dispatch=F,t.id=function(e){return arguments.length?(i=e,t):i},t.color=function(e){return arguments.length?(m=e,t):m},t.fill=function(e){return arguments.length?(y=e,t):y},t.classes=function(e){return arguments.length?(x=e,t):x},t.gradient=function(e){return arguments.length?(v=e,t):v},t.margin=function(e){return arguments.length?(n.top="undefined"!=typeof e.top?e.top:n.top,n.right="undefined"!=typeof e.right?e.right:n.right,n.bottom="undefined"!=typeof e.bottom?e.bottom:n.bottom,n.left="undefined"!=typeof e.left?e.left:n.left,t):n},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.getKey=function(e){return arguments.length?(o=e,t):o},t.getValue=function(e){return arguments.length?(s=e,t):s},t.getCount=function(e){return arguments.length?(l=e,t):l},t.fmtKey=function(e){return arguments.length?(c=e,t):c},t.fmtValue=function(e){return arguments.length?(u=e,t):u},t.fmtCount=function(e){return arguments.length?(d=e,t):d},t.direction=function(e){return arguments.length?(h=e,t):h},t.delay=function(e){return arguments.length?(p=e,t):p},t.duration=function(e){return arguments.length?(g=e,t):g},t.locality=function(e){return arguments.length?(f=S.buildLocality(e),t):f},t.textureFill=function(e){return arguments.length?(b=e,t):b},t.yScale=function(e){return arguments.length?(k=e,t):k},t.yDomain=function(e){return arguments.length?(M=e,t):M},t.forceY=function(e){return arguments.length?(A=e,t):A},t.wrapLabels=function(e){return arguments.length?(I=e,t):I},t.minLabelWidth=function(e){return arguments.length?(C=e,t):C},t}function o(){function t(o){return o.each(function(o){function s(t,n,r){return{point:n,index:r,e:e.event,id:i}}function l(t){T=t,ut.transition().duration(v).ease(e.easeElastic).attr("transform","rotate("+u(t)+")"),Z.select(".sc-odomText").text(T),Z.call(c)}function c(t){var e=t.select(".sc-odomText").node().getBoundingClientRect();t.select(".sc-odomBox").attr("d",S.roundedRectangle(-e.width/2,-e.height+B(1.5),e.width+B(4),e.height+B(2),B(2))),t.attr("transform","translate("+D+","+(n.top+B(70)+e.height)+")")}function u(t){return P+H(t)*_}function d(t){return S.angleToRadians(u(t.y0))}function f(t){return S.angleToRadians(u(t.y1))}function h(){return"translate("+D+","+D+")"}function p(t,e){var n=(f(t)-d(t))/(2*Math.PI);return 0===e||n>C?1:0}var g=r-n.left-n.right,m=a-n.top-n.bottom,A=e.select(this),D=Math.min(g/2,m)/((100+O)/100),_=z-P,H=e.scaleLinear().range([0,1]).domain([E,N]),B=function(t){return t*D/100},R=A.selectAll("g.sc-wrap").data([o]),V=R.enter().append("g").attr("class","sc-wrap sc-gauge"),G=A.select(".sc-wrap.sc-gauge").merge(V),W=V.append("defs"),Y=G.select("defs");V.append("g").attr("class","sc-group");var q=G.select(".sc-group");V.append("g").attr("class","sc-labels");var X=G.select(".sc-labels");V.append("g").attr("class","sc-pointer");var j=G.select(".sc-pointer"),K=V.append("g").attr("class","sc-odometer"),Z=G.select(".sc-odometer");G.attr("transform","translate("+(n.left/2+n.right/2+B(O))+","+(n.top+B(O))+")"),t.gradientFill=function(t,e){var n=i+"-"+e,r={x:0,y:0,r:D,s:M/100,u:"userSpaceOnUse"},a=y(t,e);return b(t,n,r,a,Y)},q.attr("transform",h);var U=q.selectAll(".sc-series").data(o),$=U.enter().append("g").attr("class","sc-series");U.exit().remove();var J=q.selectAll(".sc-series").merge($);$.style("stroke","#FFF").style("stroke-width",2).style("stroke-opacity",0).on("mouseover",function(t,n,r){e.select(this).classed("hover",!0)}).on("mouseout",function(t,n,r){e.select(this).classed("hover",!1)}),J.attr("class",function(t){return w(t,t.seriesIndex)}).attr("fill",function(t){return x(t,t.seriesIndex)}).classed("sc-active",function(t){return"active"===t.active}).classed("sc-inactive",function(t){return"inactive"===t.active});var Q=e.arc().innerRadius(B(M)).outerRadius(D).startAngle(d).endAngle(f),tt=J.selectAll("g.sc-slice").data(function(t){return t.values},function(t){return t.seriesIndex});tt.exit().remove();var et=tt.enter().append("g").attr("class","sc-slice"),nt=J.selectAll("g.sc-slice").merge(et);et.append("path").attr("class","sc-base").attr("d",Q).on("mouseover",function(t,n){e.select(this).classed("hover",!0);var r=s(e.event,t,n);k.call("elementMouseover",this,r)}).on("mousemove",function(t,n){var r=e.event;k.call("elementMousemove",this,r)}).on("mouseout",function(t,n){e.select(this).classed("hover",!1),k.call("elementMouseout",this)}).on("click",function(t,n){e.event.stopPropagation();var r=s(e.event,t,n);k.call("elementClick",this,r)}).on("dblclick",function(t,n){e.event.stopPropagation();var r=s(e.event,t,n);k.call("elementDblClick",this,r)}),nt.select(".sc-base").attr("d",Q).style("stroke-opacity",1);var rt=[{x:0,y:E,y0:E,y1:E}].concat(o.map(function(t){return t.values[0]}));X.attr("transform",h);var at=X.selectAll("text").data(rt),it=at.enter().append("text");at.exit().remove();var ot=X.selectAll("text").merge(it);if(ot.attr("transform",function(t){return"rotate("+u(t.y1)+") translate(0,"+(B(-1.5)-D)+")"}).text(function(t){return t.y1}).style("fill-opacity",p).style("text-anchor","middle").style("font-size",B(.6)+"em"),I){var st=[[Math.round(B(F)/2),0],[0,-Math.round(B(L))],[-Math.round(B(F)/2),0],[0,Math.round(B(F))],[Math.round(B(F)/2),0]];j.attr("transform",h);var lt=j.selectAll("path").data([st]),ct=lt.enter().append("path").attr("transform","rotate("+P+")");lt.exit().remove();var ut=j.selectAll("path").merge(ct);ut.attr("d",e.line()),K.append("text").attr("class","sc-odom sc-odomText").attr("x",0).attr("y",0).style("text-anchor","middle").style("stroke","none").style("fill","black"),Z.select(".sc-odomText").style("font-size",B(.7)+"em").text(T),K.insert("path",".sc-odomText").attr("class","sc-odom sc-odomBox").attr("fill","#EFF").attr("stroke","black").attr("stroke-width","2px").attr("opacity",.8),Z.call(c)}else j.selectAll("path").remove(),Z.select(".sc-odomText").remove(),Z.select(".sc-odomBox").remove();t.setGaugePointer=l}),t}var n={top:0,right:0,bottom:0,left:0},r=null,a=null,i=Math.floor(1e4*Math.random()),o=function(t){return t.key},s=function(t){return S.isNumeric(t.y)?parseFloat(t.y):null},l=function(t){return t.hasOwnProperty("key")?t.key:t},c=function(t){return S.isNumeric(t.value)?t.value:s(t)},u=function(t){return S.isNumeric(t.count)?t.count:t},d=function(t){return l(t)},f=function(t){return c(t)},h=function(t){return(" ("+u(t)+")").replace(" ()","")},p=S.buildLocality(),g="ltr",m=0,v=0,y=function(t,e){return S.defaultColor()(t,t.seriesIndex)},b=S.colorRadialGradient,x=y,w=function(t,e){return"sc-slice sc-series-"+t.seriesIndex},k=e.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove"),M=50,A=!0,I=!0,C=.01,F=5,D=5,L=90,T=0,E=0,N=0,P=-90,z=90,O=10;return t.dispatch=k,t.id=function(e){return arguments.length?(i=e,t):i},t.color=function(e){return arguments.length?(y=e,t):y},t.fill=function(e){return arguments.length?(x=e,t):x},t.classes=function(e){return arguments.length?(w=e,t):w},t.gradient=function(e){return arguments.length?(b=e,t):b},t.margin=function(e){return arguments.length?(n.top="undefined"!=typeof e.top?e.top:n.top,n.right="undefined"!=typeof e.right?e.right:n.right,n.bottom="undefined"!=typeof e.bottom?e.bottom:n.bottom,n.left="undefined"!=typeof e.left?e.left:n.left,t):n},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.x=function(e){return arguments.length?(o=e,t):o},t.y=function(e){return arguments.length?(s=S.functor(e),t):s},t.getKey=function(e){return arguments.length?(l=e,t):l},t.getValue=function(e){return arguments.length?(c=e,t):c},t.getCount=function(e){return arguments.length?(u=e,t):u},t.fmtKey=function(e){return arguments.length?(d=e,t):d},t.fmtValue=function(e){return arguments.length?(f=e,t):f},t.fmtCount=function(e){return arguments.length?(h=e,t):h},t.direction=function(e){return arguments.length?(g=e,t):g},t.delay=function(e){return arguments.length?(m=e,t):m},t.duration=function(e){return arguments.length?(v=e,t):v},t.locality=function(e){return arguments.length?(p=S.buildLocality(e),t):p},t.showLabels=function(e){return arguments.length?(A=e,t):A;
},t.labelThreshold=function(e){return arguments.length?(C=e,t):C},t.ringWidth=function(e){return arguments.length?(M=e,t):M},t.pointerWidth=function(e){return arguments.length?(F=e,t):F},t.pointerTailLength=function(e){return arguments.length?(D=e,t):D},t.pointerHeadLength=function(e){return arguments.length?(L=e,t):L},t.setPointer=function(e){return arguments.length?(t.setGaugePointer(e),t):t.setGaugePointer},t.showPointer=function(e){return arguments.length?(I=e,t):I},t.minValue=function(e){return arguments.length?(E=e,t):E},t.maxValue=function(e){return arguments.length?(N=e,t):N},t.minAngle=function(e){return arguments.length?(P=e,t):P},t.maxAngle=function(e){return arguments.length?(z=e,t):z},t.labelInset=function(e){return arguments.length?(O=e,t):O},t}function s(){function t(r){return r.each(function(r){function D(){K.style("opacity",.9*I).style("display",I?"inline":"none"),Q.style("opacity",I).style("display",I?"inline":"none"),U.text(1===I?b.close:b.open)}var E=e.select(this),N=[],P=0,z=0,O="",_="start"===s?!0:!1,H="rtl"===o?!0:!1,B=d*(_?1:.6),R=u+(_?c+f:0);if(!r||!r.length||!r.filter(function(t){return!t.values||t.values.length}).length)return t;var V=r.filter(function(t){return t.hasOwnProperty("seriesIndex")}).length;r.filter(function(t){return!t.hasOwnProperty("seriesIndex")}).map(function(t){t.seriesIndex=V,V+=1}),y=!0,O=r[0].type&&"bar"!==r[0].type?"line":"bar",i=H&&"center"!==i?"left"===i?"right":"left":i;var G=E.selectAll("g.sc-wrap").data([r]),W=G.enter().append("g").attr("class","sc-wrap sc-menu"),Y=E.select("g.sc-wrap").merge(W);Y.attr("transform","translate(0,0)");var q=W.append("defs"),X=Y.select("defs");q.append("clipPath").attr("id","sc-edge-clip-"+x).append("rect");var j=Y.select("#sc-edge-clip-"+x+" rect");W.append("rect").attr("class","sc-menu-background");var K=Y.select(".sc-menu-background"),Z=S.dropShadow("menu_back_"+x,X,{blur:2});W.append("text").attr("class","sc-menu-link");var U=Y.select(".sc-menu-link"),$=W.append("g").attr("class","sc-menu-mask"),J=Y.select(".sc-menu-mask");$.append("g").attr("class","sc-group");var Q=Y.select(".sc-group"),tt=Q.selectAll(".sc-series").data(S.identity,function(t){return t.seriesIndex});tt.exit().remove();var et=tt.enter().append("g").attr("class","sc-series").on("mouseover",function(t){A.call("legendMouseover",this,t)}).on("mouseout",function(t){A.call("legendMouseout",this,t)}).on("click",function(t){e.event.preventDefault(),e.event.stopPropagation(),A.call("legendClick",this,t)}),nt=Q.selectAll(".sc-series").merge(et);nt.attr("class",M).attr("fill",k).attr("stroke",k);var rt=et.append("rect").attr("x",(c+f)/-2).attr("y",(c+B)/-2).attr("width",c+f).attr("height",c+B).style("fill","#FFE").style("stroke-width",0).style("opacity",.1),at=nt.selectAll("rect").merge(rt),it=et.selectAll("circle").data(function(t){return"line"===O?[t,t]:[t]});it.exit().remove();var ot=it.enter().append("circle").attr("r",l).style("stroke-width","2px"),st=nt.selectAll("circle").merge(ot),lt=et.selectAll("line").data("line"===O?function(t){return[t]}:[]);lt.exit().remove();var ct=lt.enter().append("line").attr("x0",0).attr("y0",0).attr("y1",0).style("stroke-width","4px"),ut=nt.selectAll("line").merge(ct),dt=et.append("text").attr("dx",0),ft=nt.selectAll("text").merge(dt);ft.attr("dy",_?".36em":".71em").text(w),j.attr("x",.5).attr("y",.5).attr("width",0).attr("height",0),K.attr("x",.5).attr("y",.5).attr("width",0).attr("height",0).style("opacity",0).style("pointer-events","all").on("click",function(){e.event.stopPropagation()}),U.text(1===I?b.close:b.open).attr("text-anchor","left"===i?H?"end":"start":H?"start":"end").attr("dy",".36em").attr("dx",0).style("opacity",0).on("click",function(t,n){e.event.preventDefault(),e.event.stopPropagation(),A.call("toggleMenu",this,t,n)}),nt.classed("disabled",function(t){return t.disabled}),t.calcMaxWidth=function(){return N=[],Q.style("display","inline"),ft.each(function(){var t=e.select(this).node().getBoundingClientRect().width;N.push(Math.max(Math.floor(t),"line"===O?50:20))}),t.width(e.sum(N)+N.length*R-u),t.width()},t.getLineHeight=function(){Q.style("display","inline");var t=Math.floor(ft.node().getBoundingClientRect().height);return t},t.arrange=function(r){function o(t){return N[t]+R}function y(t){return N[t]+R-u}function b(t){return t?1:-1}0===N.length&&this.calcMaxWidth();var w=N.length,k=1,M=w,A=[],S=[],D=r-n.left-n.right,E=a,V=0,G=this.getLineHeight(),W=c+(_?0:G)+B,Y={top:7,right:7,bottom:7,left:7},q=0,X=0,$,tt,et;if(h){for(;M>0;){for(A=[],$=0;w>$;$+=1)o($)>(A[$%M]||0)&&(A[$%M]=o($));if(e.sum(A)-u<D)break;M-=1}for(M=M||1,k=Math.ceil(w/M),V=e.sum(A)-u,$=0;w>$;$+=1)tt=$%M,_?0===tt?q=H?V:0:q+=A[tt-1]*b(!H):0===tt?q=(H?V:0)+(A[tt]-u)/2*b(!H):q+=(A[tt-1]+A[tt])/2*b(!H),X=Math.floor($/M)*W,S[$]={x:q,y:X}}else if(H)for(q=D,$=0;w>$;$+=1)q-y($)<0&&(V=Math.max(V,y($)),q=D,$&&(k+=1)),q-y($)>V&&(V=q-y($)),S[$]={x:q,y:(k-1)*(B+c)},q-=o($);else for(q=0,$=0;w>$;$+=1)$&&q+y($)>D&&(q=0,k+=1),q+y($)>V&&(V=q+y($)),S[$]={x:q,y:(k-1)*(B+c)},q+=o($);if(!g&&(p||v>=k)){switch(I=0,m=!1,C=!1,t.width(n.left+V+n.right).height(n.top+k*W-B+n.bottom),i){case"left":et=0;break;case"center":et=(r-t.width())/2;break;case"right":et=0}j.attr("y",0).attr("width",t.width()).attr("height",t.height()),K.attr("x",et).attr("width",t.width()).attr("height",t.height()).attr("rx",0).attr("ry",0).attr("filter","none").style("display","inline").style("opacity",0),J.attr("clip-path","none").attr("transform",function(){var t=et+n.left+(_?l*b(!H):0),e=n.top+Y.top;return"translate("+t+","+e+")"}),Q.style("opacity",1).style("display","inline"),nt.attr("transform",function(t){var e=S[t.seriesIndex];return"translate("+e.x+","+e.y+")"}),at.attr("x",function(t){var e=0;return _?(e=(c+u)/2*b(H),e-=H?o(t.seriesIndex):0):e=o(t.seriesIndex)/-2,e}).attr("width",function(t){return o(t.seriesIndex)}).attr("height",W),st.attr("r",function(t){return"dash"===t.type?0:l}).attr("transform",function(t,e){var n=_||"bar"===O?0:3*l*b(e);return"translate("+n+",0)"}),ut.attr("x1",function(t){return"dash"===t.type?8*l:4*l}).attr("transform",function(t){var e=l*("dash"===t.type?-4:-2);return"translate("+e+",0)"}).style("stroke-dasharray",function(t){return"dash"===t.type?"8, 8":"none"}).style("stroke-dashoffset",-4),ft.attr("dy",_?".36em":".71em").attr("text-anchor",s).attr("transform",function(){var t=_?(l+f)*b(!H):0,e=_?0:(c+B)/2;return"translate("+t+","+e+")"})}else m=!0,C=!0,t.width(Y.left+e.max(N)+c+f+Y.right).height(n.top+c+n.top),P=Y.top+c*w+d*(w-1)+Y.bottom,z=Math.min(E-t.height(),P),j.attr("x",.5-Y.top-l).attr("y",.5-Y.top-l).attr("width",t.width()).attr("height",z),K.attr("x",.5).attr("y",.5+t.height()).attr("width",t.width()).attr("height",z).attr("rx",2).attr("ry",2).attr("filter",Z).style("opacity",.9*I).style("display",I?"inline":"none"),U.attr("transform",function(){var e="left"===i?.5:.5+t.width(),r=n.top+l;return"translate("+e+","+r+")"}).style("opacity",1),J.attr("clip-path","url(#sc-edge-clip-"+x+")").attr("transform",function(){var e=Y.left+l,n=t.height()+Y.top+l;return"translate("+e+","+n+")"}),Q.style("opacity",I).style("display",I?"inline":"none").attr("transform",function(){var t=H?e.max(N)+l:0;return"translate("+t+",0)"}),nt.attr("transform",function(t,e){var n=e*(c+d);return"translate(0,"+n+")"}),at.attr("x",function(t){var e=(c+u)/2*b(H);return e-=H?o(t.seriesIndex):0}).attr("width",function(t){return o(t.seriesIndex)}).attr("height",c+B),st.attr("r",function(t){return"dash"===t.type?0:"line"===t.type?l-2:l}).attr("transform",""),ut.attr("x1",16).attr("transform","translate(-8,0)").style("stroke-dasharray",function(t){return"dash"===t.type?"6, 4, 6":"none"}).style("stroke-dashoffset",0),ft.attr("text-anchor","start").attr("dy",".36em").attr("transform",function(){var t=(l+f)*b(!H);return"translate("+t+",0)"});if(F){var rt=z-P,it=function(t){if(t){var n=e.zoom().on("zoom",ot);K.call(n),Q.call(n)}else K.on(".zoom",null),Q.on(".zoom",null)},ot=function(){var t=e.event,n,r=0,a=0,i=0,o="";!t||"click"!==t.type&&"zoom"!==t.type||(n=t.sourceEvent,"zoom"===t.type&&n&&("wheel"===n.type?(r=-n.deltaX,a=-n.deltaY,i=L+(Math.abs(r)>Math.abs(a)?r:a)):"mousemove"===n.type?(r=n.movementX,a=n.movementY,i=L+(Math.abs(r)>Math.abs(a)?r:a)):"touchmove"===n.type&&(r=t.transform.x,a=t.transform.y,i=Math.abs(r)>Math.abs(a)?r:a)),L=Math.min(Math.max(i,rt),0),o="translate("+(H?e.max(N)+l:0)+","+L+")",(i>0||rt>i)&&T(Math.abs(a)>Math.abs(r)?a:0),Q.attr("transform",o))};it(C)}},A.on("toggleMenu",function(){e.event.stopPropagation(),I=1-I,D()}),A.on("closeMenu",function(){1===I&&(I=0,D())})}),t}var n={top:10,right:10,bottom:15,left:10},r=0,a=0,i="right",o="ltr",s="start",l=6,c=2*l,u=10,d=12,f=5,h=!0,p=!1,g=!1,m=!1,v=3,y=!1,b=D(),x=Math.floor(1e4*Math.random()),w=function(t){return t.key.length>0||!isNaN(parseFloat(t.key))&&S.isNumeric(t.key)?t.key:b.noLabel},k=function(t){return S.defaultColor()(t,t.seriesIndex)},M=function(t){return"sc-series sc-series-"+t.seriesIndex},A=e.dispatch("legendClick","legendMouseover","legendMouseout","toggleMenu","closeMenu"),I=0,C=!1,F=!0,L=0,T=function(){};return t.dispatch=A,t.margin=function(e){return arguments.length?(n.top="undefined"!=typeof e.top?e.top:n.top,n.right="undefined"!=typeof e.right?e.right:n.right,n.bottom="undefined"!=typeof e.bottom?e.bottom:n.bottom,n.left="undefined"!=typeof e.left?e.left:n.left,t):n},t.width=function(e){return arguments.length?(r=Math.round(e),t):r},t.height=function(e){return arguments.length?(a=Math.round(e),t):a},t.id=function(e){return arguments.length?(x=e,t):x},t.key=function(e){return arguments.length?(w=e,t):w},t.color=function(e){return arguments.length?(k=S.getColor(e),t):k},t.classes=function(e){return arguments.length?(M=e,t):M},t.align=function(e){return arguments.length?(i=e,t):i},t.position=function(e){return arguments.length?(s=e,t):s},t.showAll=function(e){return arguments.length?(p=e,t):p},t.showMenu=function(e){return arguments.length?(g=e,t):g},t.collapsed=function(){return m},t.rowsCount=function(e){return arguments.length?(v=e,t):v},t.spacing=function(e){return arguments.length?(d=e,t):d},t.gutter=function(e){return arguments.length?(u=e,t):u},t.radius=function(e){return arguments.length?(l=e,t):l},t.strings=function(e){return arguments.length?(b=e,t):b},t.equalColumns=function(e){return arguments.length?(h=e,t):h},t.enabled=function(e){return arguments.length?(y=e,t):y},t.direction=function(e){return arguments.length?(o=e,t):o},t}function l(){function t(s){return s.each(function(){var s=e.select(this),y=s.select(".sc-chart-wrap"),b=y.select(".sc-title-wrap"),x=y.select(".sc-controls-wrap"),w=y.select(".sc-legend-wrap"),k=a.margin(),M=0,A=0,I=0,C=0,F=0,D={width:0,height:0,top:0,left:0},L=0,T=0,E=0;if(d=d&&l&&l.length>0,b.select(".sc-title").remove(),d&&(b.append("text").attr("class","sc-title").attr("x","rtl"===m?n:0).attr("y",0).attr("dy",".75em").attr("text-anchor","start").attr("stroke","none").attr("fill","black").text(l),D=S.getTextBBox(b.select(".sc-title"),!0),D.top-=s.node().getBoundingClientRect().top,L=D.height),f&&(i.id("controls_"+a.id()).strings(v.controls).color(["#444"]).align(p).height(r-L),x.datum(c).call(i),I=i.calcMaxWidth()),h&&(o.id("legend_"+a.id()).strings(v.legend).align(g).height(r-L),w.datum(u).call(o),C=o.calcMaxWidth()),F=n/(I+C),I=Math.floor(I*F),C=Math.floor(C*F),f&&(i.arrange(I),C=n-i.width()),h&&(o.arrange(C),I=n-o.width()),f&&(M="rtl"===m?n-i.width():0,A=d?D.height-k.top+D.top:0-i.margin().top,x.attr("transform",S.translation(M,A)),T=i.height()-(d?0:i.margin().top)),h){var N=S.getTextBBox(w.select(".sc-menu-link")),P=n-D.width-6,z=d&&!f&&o.collapsed()&&P>N.width?!0:!1;M="rtl"===m||!o.collapsed()&&"center"===g?0:n-o.width(),z?(A=D.height-o.height()/2-N.height/2,A-=k.top-D.top):A=d?D.height-k.top+D.top:0-o.margin().top,w.attr("transform",S.translation(M,A)),E=z?o.margin().bottom:o.height()-(d?0:o.margin().top)}t.getHeight=function(){var t=L+Math.max(T,E,10);return t}}),t}var n=960,r=500,a=null,i=s(),o=s(),l="",c=[],u=[],d=!1,f=!1,h=!1,p="left",g="right",m="ltr",v=D();return t.controls=i,t.legend=o,t.chart=function(e){return arguments.length?(a=e,t):a},t.width=function(e){return arguments.length?(n=e,t):n},t.height=function(e){return arguments.length?(r=e,t):r},t.title=function(e){return arguments.length?(l=e,t):l},t.controlsData=function(e){return arguments.length?(c=e,t):c},t.legendData=function(e){return arguments.length?(u=e,t):u},t.showTitle=function(e){return arguments.length?(d=e,t):d},t.showControls=function(e){return arguments.length?(f=e,t):f},t.showLegend=function(e){return arguments.length?(h=e,t):h},t.alignControls=function(e){return arguments.length?(p=e,t):p},t.alignLegend=function(e){return arguments.length?(g=e,t):g},t.direction=function(e){return arguments.length?(m=e,o.direction(e),i.direction(e),t):m},t.strings=function(e){return arguments.length?(v=D(e),o.strings(v.legend),i.strings(v.controls),t):v},t}function c(){function t(C){return C.each(function(C){function N(){if(u.domain(b||e.extent(J.map(h).concat(m))),d.domain(x||e.extent(J.map(p).concat(v))),T&&C[0])if(-1===E){var t=Math.sqrt(k[1]/Math.PI);u.range([0+t,K-t]),d.range([Z-t,0+t])}else 1>E?(u.range([(K*E+K)/(2*C[0].values.length),K-K*(1+E)/(2*C[0].values.length)]),d.range([Z,0])):(u.range([E,K-E]),d.range([Z-E,E]));else u.range([0,K]),d.range([Z,0]);V&&d.nice(),B=u.domain()[0]===u.domain()[1]||d.domain()[0]===d.domain()[1],u.domain()[0]===u.domain()[1]&&(u.domain()[0]?u.domain([u.domain()[0]-.1*u.domain()[0],u.domain()[1]+.1*u.domain()[1]]):u.domain([-1,1])),d.domain()[0]===d.domain()[1]&&(d.domain()[0]?d.domain([d.domain()[0]-.1*d.domain()[0],d.domain()[1]+.1*d.domain()[1]]):d.domain([-1,1])),f.domain(w||e.extent(J.map(function(t){return t.size}).concat(y))).range(k),f.domain().length<2&&f.domain([0,f.domain()]),G=G||u,W=W||d,Y=Y||f}function z(t,e,r,a){var i={pointIndex:r,point:e,seriesIndex:a.seriesIndex,series:a,groupIndex:e.group,id:n,e:t};return i}function j(){if(!D)return!1;if(_===!0){var t=e.merge(C.map(function(t,e){return t.values.map(function(t,n){var r=h(t,n),a=p(t,n),i=t.group;return[u(r)+1e-4*Math.random(),d(a)+1e-4*Math.random(),t,e,i,n]}).filter(function(t,e){return L(t[4],e)})}));t.length<=3&&(t.push([u.range()[0]-20,d.range()[0]-20,null,null,null,null]),t.push([u.range()[1]+20,d.range()[1]+20,null,null,null,null]),t.push([u.range()[0]-20,d.range()[0]+20,null,null,null,null]),t.push([u.range()[1]+20,d.range()[1]-20,null,null,null,null]));try{var i=e.voronoi().extent([[-10,-10],[r+10,a+10]]).polygons(t).map(function(e,n){return{data:e,seriesIndex:t[n][3],groupIndex:t[n][4],pointIndex:t[n][5]}}).filter(function(t){return null!==t.seriesIndex})}catch(o){_=!1,console.warn("Sucrose: [ERROR] D3 Voronoi paths in line chart are disabled due to error.")}}if(_){if(H){var s=et.select("#sc-points-clip-"+n).selectAll("circle").data(t),l=s.enter().append("circle"),c=et.select("#sc-points-clip-"+n).selectAll("circle").merge(l);s.exit().remove(),c.attr("cx",function(t){return t[0]}).attr("cy",function(t){return t[1]}).attr("r",function(t,e){return M(t[2],e)}),it.attr("clip-path","url(#sc-points-clip-"+n+")")}var f=it.selectAll("path").data(i),g=f.enter().append("path").attr("class",function(t,e){return"sc-path-"+e}),m=it.selectAll("path").merge(g);f.exit().remove(),m.attr("d",function(t){return t?"M"+t.data.join("L")+"Z":null}).on("mouseover",function(t){var n=C[t.seriesIndex],r=t.pointIndex,a=n.values[r];if(X||!n)return 0;var i=z(e.event,a,r,n);R.call("elementMouseover",this,i)}).on("mousemove",function(t){var n=e.event;R.call("elementMousemove",this,n)}).on("mouseout",function(t){var n=C[t.seriesIndex],r=t.pointIndex,a=n.values[r];if(X||!n)return 0;var i=z(e.event,a,r,n);R.call("elementMouseout",this,i)}).on("click",function(t){var n=C[t.seriesIndex],r=t.pointIndex,a=n.values[r];if(X||!n)return 0;var i=z(e.event,a,r,n);R.call("elementClick",this,i)})}else lt.selectAll(".sc-point").style("pointer-events","auto").on("mouseover",function(t,n){var r=e.select(this.parentNode).datum(),a=r.values[n];if(X||!r)return 0;var i=z(e.event,a,n,r);R.call("elementMouseover",this,i)}).on("mousemove",function(t,n){var r=e.event;R.call("elementMousemove",this,r)}).on("mouseout",function(t,n){var r=e.select(this.parentNode).datum(),a=r.values[n];if(X||!r)return 0;var i=z(e.event,a,n,r);R.call("elementMouseout",this,i)}).on("click",function(t,n){var r=e.select(this.parentNode).datum(),a=r.values[n];if(X||!r)return 0;var i=z(e.event,a,n,r);R.call("elementClick",this,i)});X=!1}var K=r-i.left-i.right,Z=a-i.top-i.bottom,U=e.select(this),$=e.transition("scatter").duration(O).ease(e.easeLinear);X=!0;var J=b&&x&&w?[]:e.merge(C.map(function(t){return t.values.map(function(t,e){return{x:h(t,e),y:p(t,e),size:g(t,e)}})}));t.resetDimensions=function(t,e){r=t,a=e,K=t-i.left-i.right,Z=e-i.top-i.bottom,N()},N();var Q=U.selectAll("g.sc-wrap.sc-scatter").data([C]),tt=Q.enter().append("g").attr("class","sc-wrap sc-scatter"),et=U.select(".sc-wrap.sc-scatter").merge(tt),nt=tt.append("defs"),rt=et.select("defs");tt.append("g").attr("class","sc-group");var at=et.select(".sc-group");tt.append("g").attr("class","sc-point-paths");var it=et.select(".sc-point-paths");et.classed("sc-single-point",B).attr("transform",S.translation(i.left,i.top)),nt.append("clipPath").attr("id","sc-edge-clip-"+n).append("rect"),nt.append("clipPath").attr("id","sc-points-clip-"+n).attr("class","sc-point-clips"),rt.select("#sc-edge-clip-"+n+" rect").attr("width",K).attr("height",Z),et.attr("clip-path",P?"url(#sc-edge-clip-"+n+")":""),t.gradientFill=function(t,e){var r=n+"-"+e,a={x:.5,y:.5,r:.5,s:0,u:"objectBoundingBox"},i=o(t,e);return s(t,r,a,i,rt)};var ot=at.selectAll(".sc-series").data(S.identity,function(t){return t.seriesIndex}),st=ot.enter().append("g").attr("class","sc-series").style("stroke-opacity",1e-6).style("fill-opacity",1e-6),lt=at.selectAll(".sc-series").merge(st);lt.attr("class",function(t,e){return c(t,t.seriesIndex)}).attr("fill",function(t,e){return l(t,t.seriesIndex)}).attr("stroke",function(t,e){return l(t,t.seriesIndex)}).classed("hover",function(t){return t.hover}),lt.transition($).style("stroke-opacity",1).style("fill-opacity",1),ot.exit().transition($).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove();var ct,ut,dt;F?(ct=lt.selectAll("circle.sc-point").data(function(t){return t.values}),ut=ct.enter().append("circle").attr("class",function(t,e){return"sc-point sc-enter sc-point-"+e}).attr("r",M),dt=lt.selectAll(".sc-point").merge(ut),dt.filter(function(t){return e.select(this).classed("sc-enter")}).attr("cx",function(t,e){return u(h(t,e))}).attr("cy",function(t,e){return d(0)}),dt.transition($).attr("cx",function(t,e){return u(h(t,e))}).attr("cy",function(t,e){return d(p(t,e))}).on("end",function(t){e.select(this).classed("sc-enter",!1).classed("sc-active",function(t){return"active"===t.active})}),ot.exit().transition($).selectAll(".sc-point").attr("cx",function(t,e){return u(h(t,e))}).attr("cy",function(t,e){return d(0)}).remove()):(ct=lt.selectAll("path.sc-point").data(function(t){return t.values}),ut=ct.enter().append("path").attr("class",function(t,e){return"sc-point sc-enter sc-point-"+e}).attr("d",e.symbol().type(I).size(A)),dt=lt.selectAll(".sc-point").merge(ut),dt.filter(function(t){return e.select(this).classed("sc-enter")}).attr("transform",function(t,e){return"translate("+G(h(t,e))+","+d(0)+")"}),dt.transition($).attr("transform",function(t,e){return"translate("+u(h(t,e))+","+d(p(t,e))+")"}).attr("d",e.symbol().type(I).size(A)).on("end",function(t){e.select(this).classed("sc-enter",!1).classed("active",function(t){return"active"===t.active})}),ot.exit().transition($).selectAll(".sc-point").attr("transform",function(t,e){return"translate("+u(h(t,e))+","+d(0)+")"}).remove()),clearTimeout(q),q=setTimeout(j,300),G=u.copy(),W=d.copy(),Y=f.copy(),R.on("elementMouseover.point",function(t){D&&U.select(".sc-series-"+t.seriesIndex+" .sc-point-"+t.pointIndex).classed("hover",!0)}),R.on("elementMouseout.point",function(t){D&&U.select(".sc-series-"+t.seriesIndex+" .sc-point-"+t.pointIndex).classed("hover",!1)})}),t}var n=Math.floor(1e5*Math.random()),r=960,a=500,i={top:0,right:0,bottom:0,left:0},o=function(t,e){return S.defaultColor()(t,t.seriesIndex)},s=S.colorRadialGradient,l=o,c=function(t,e){return"sc-series sc-series-"+t.seriesIndex},u=e.scaleLinear(),d=e.scaleLinear(),f=e.scaleLinear(),h=function(t){return t.x},p=function(t){return t.y},g=function(t){return t.size||1},m=[],v=[],y=[],b=null,x=null,w=null,k=[1*Math.PI,25*Math.PI],M=function(t,e){return Math.sqrt(f(g(t,e))/Math.PI)},A=function(t,e){return f(g(t,e))},I=function(t){return t.shape||"circle"},C=S.buildLocality(),F=!0,D=!0,L=function(t){return!t.notActive},T=!1,E=.1,N="ltr",P=!1,z=0,O=0,_=!0,H=!0,B=!1,R=e.dispatch("elementClick","elementMouseover","elementMouseout","elementMousemove"),V=!1,G,W,Y,q,X=!1;return t.dispatch=R,t.id=function(e){return arguments.length?(n=e,t):n},t.color=function(e){return arguments.length?(o=e,t):o},t.fill=function(e){return arguments.length?(l=e,t):l},t.classes=function(e){return arguments.length?(c=e,t):c},t.gradient=function(e){return arguments.length?(s=e,t):s},t.x=function(e){return arguments.length?(h=S.functor(e),t):h},t.y=function(e){return arguments.length?(p=S.functor(e),t):p},t.z=function(e){return arguments.length?(g=S.functor(e),t):g},t.xScale=function(e){return arguments.length?(u=e,t):u},t.yScale=function(e){return arguments.length?(d=e,t):d},t.zScale=function(e){return arguments.length?(f=e,t):f},t.xDomain=function(e){return arguments.length?(b=e,t):b},t.yDomain=function(e){return arguments.length?(x=e,t):x},t.zDomain=function(e){return arguments.length?(w=e,t):w},t.forceX=function(e){return arguments.length?(m=e,t):m},t.forceY=function(e){return arguments.length?(v=e,t):v},t.forceZ=function(e){return arguments.length?(y=e,t):y},t.size=function(e){return arguments.length?(g=S.functor(e),t):g},t.sizeRange=function(e){return arguments.length?(k=e,t):k},t.sizeDomain=function(e){return arguments.length?(w=e,t):w},t.forceSize=function(e){return arguments.length?(y=e,t):y},t.margin=function(e){if(!arguments.length)return i;for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.interactive=function(e){return arguments.length?(D=e,t):D},t.pointActive=function(e){return arguments.length?(L=e,t):L},t.padData=function(e){return arguments.length?(T=e,t):T},t.padDataOuter=function(e){return arguments.length?(E=e,t):E},t.clipEdge=function(e){return arguments.length?(P=e,t):P},t.clipVoronoi=function(e){return arguments.length?(H=e,t):H},t.useVoronoi=function(e){return arguments.length?(_=e,_===!1&&(H=!1),t):_},t.circleRadius=function(e){return arguments.length?(M=e,t):M},t.clipRadius=function(e){return arguments.length?(M=e,t):M},t.shape=function(e){return arguments.length?(I=e,t):I},t.onlyCircles=function(e){return arguments.length?(F=e,t):F},t.singlePoint=function(e){return arguments.length?(B=e,t):B},t.delay=function(e){return arguments.length?(z=e,t):z},t.duration=function(e){return arguments.length?(O=e,t):O},t.direction=function(e){return arguments.length?(N=e,t):N},t.nice=function(e){return arguments.length?(V=e,t):V},t.locality=function(e){return arguments.length?(C=S.buildLocality(e),t):C},t}function u(){function t(c){return c.each(function(c){function g(t){if(!t.values||!t.values.length)return[null];if(t.values.length>1)return[t.values];var e=l.domain().map(function(e,n){if(Array.isArray(t.values[0]))return[e,t.values[0][1]];var r=JSON.parse(JSON.stringify(t.values[0]));return r.x=e,r});return[e]}var b=e.select(this),w=a-r.left-r.right,k=i-r.top-r.bottom,M="linear"===h?e.curveLinear:"cardinal"===h?e.curveCardinal:"monotone"===h?e.curveMonotoneX:"basis"===h?e.curveBasis:e.curveNatural,A=e.area().curve(M).defined(d).x(function(t,e){return l(o(t,e))}).y0(function(t,e){return u(s(t,e))}).y1(function(t,e){return u(u.domain()[0]<=0?u.domain()[1]>=0?0:u.domain()[1]:u.domain()[0])}),I=e.area().curve(M).defined(d).x(function(t,e){return l(o(t,e))}).y0(function(t,e){return u(0)}).y1(function(t,e){return u(u.domain()[0]<=0?u.domain()[1]>=0?0:u.domain()[1]:u.domain()[0])}),C=e.transition("points").duration(m).ease(e.easeLinear),F=n.id();y=function(t,e,r){return S.colorLinearGradient(t,n.id()+"-"+e,r,v(t,e),T.select("defs"))},l=n.xScale(),u=n.yScale(),t.resetDimensions=function(t,e){a=t,i=e,w=t-r.left-r.right,k=e-r.top-r.bottom,n.resetDimensions(t,e)};var D=b.selectAll("g.sc-wrap.sc-line").data([c]),L=D.enter().append("g").attr("class","sc-wrap sc-line"),T=b.select(".sc-wrap.sc-line").merge(L),E=L.append("defs");L.append("g").attr("class","sc-group");var N=T.select(".sc-group");L.append("g").attr("class","sc-scatter-wrap");var P=T.select(".sc-scatter-wrap");T.attr("transform",S.translation(r.left,r.top)),E.append("clipPath").attr("id","sc-edge-clip-"+F).append("rect"),T.select("#sc-edge-clip-"+F+" rect").attr("width",w).attr("height",k),T.attr("clip-path",p?"url(#sc-edge-clip-"+F+")":""),P.attr("clip-path",p?"url(#sc-edge-clip-"+F+")":"");var z=N.selectAll("g.sc-series").data(c,function(t){return t.seriesIndex}),O=z.enter().append("g").attr("class","sc-series").style("stroke-opacity",1e-6).style("fill-opacity",1e-6),_=N.selectAll(".sc-series").merge(O);_.classed("hover",function(t){return t.hover}).attr("class",x).attr("fill",v).attr("stroke",v),_.transition(C).style("stroke-opacity",1).style("fill-opacity",.5),z.exit().transition(C).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove(),n.clipEdge(p).width(w).height(k),P.call(n);var H=_.selectAll("path.sc-area").data(function(t){return f(t)?[t]:[]}),B=H.enter().append("path").attr("class","sc-area sc-enter"),R=_.selectAll(".sc-area").merge(B);R.filter(function(t){return e.select(this).classed("sc-enter")}).attr("d",function(t){return I.apply(this,[t.values])}),R.transition(C).attr("d",function(t){return A.apply(this,[t.values])}).on("end",function(t){e.select(this).classed("sc-enter",!1)}),H.exit().remove(),z.exit().transition(C).selectAll(".sc-area").attr("d",function(t){return I.apply(this,[t.values])}).remove();var V=_.selectAll("path.sc-line").data(g,function(t){return t.seriesIndex}),G=V.enter().append("path").attr("class","sc-line sc-enter"),W=_.selectAll(".sc-line").merge(G);W.filter(function(t){return e.select(this).classed("sc-enter")}).attr("d",e.line().curve(M).defined(d).x(function(t,e){return l(o(t,e))}).y(function(t,e){return u(0)})),W.transition(C).attr("d",e.line().curve(M).defined(d).x(function(t,e){return l(o(t,e))}).y(function(t,e){return u(s(t,e))})).on("end",function(t){e.select(this).classed("sc-enter",!1)}),z.exit().transition(C).selectAll(".sc-line").attr("d",e.line().curve(M).defined(d).x(function(t,e){return l(o(t,e))}).y(function(t,e){return u(0)})).remove()}),t}var n=c(),r={top:0,right:0,bottom:0,left:0},a=960,i=500,o=function(t){return t.x},s=function(t){return t.y},l,u,d=function(t,e){return!isNaN(s(t,e))&&null!==s(t,e)},f=function(t){return t&&t.area||!1},h="linear",p=!1,g=0,m=0,v=function(t,e){return S.defaultColor()(t,t.seriesIndex)},y=null,b=v,x=function(t,e){return"sc-series sc-series-"+t.seriesIndex};return t.dispatch=n.dispatch,t.scatter=n,S.rebind(t,n,"id","interactive","size","xScale","yScale","zScale","xDomain","yDomain","sizeDomain","sizeRange","forceX","forceY","forceSize","useVoronoi","clipVoronoi","clipRadius","padData","padDataOuter","singlePoint","direction","nice","locality"),t.color=function(e){return arguments.length?(v=e,n.color(v),t):v},t.fill=function(e){return arguments.length?(b=e,n.fill(b),t):b},t.classes=function(e){return arguments.length?(x=e,n.classes(x),t):x},t.gradient=function(e){return arguments.length?(y=e,t):y},t.margin=function(e){if(!arguments.length)return r;for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return t},t.width=function(e){return arguments.length?(a=e,t):a},t.height=function(e){return arguments.length?(i=e,t):i},t.x=function(e){return arguments.length?(o=e,n.x(e),t):o},t.y=function(e){return arguments.length?(s=e,n.y(e),t):s},t.delay=function(e){return arguments.length?(g=e,t):g},t.duration=function(e){return arguments.length?(m=e,n.duration(e),t):m},t.clipEdge=function(e){return arguments.length?(p=e,t):p},t.interpolate=function(e){return arguments.length?(h=e,t):h},t.defined=function(e){return arguments.length?(d=e,t):d},t.isArea=function(e){return arguments.length?(f=S.functor(e),t):f},t}function d(){function t(u){return u.each(function(u){function f(t){return t?1:-1}function m(t){return t.reverse().filter(function(t,e,n){return-1===n.indexOf(t,e+1)}).reverse()}function M(){var t=t||m(mt.map(l).concat(h)),n=b?Q:tt,r=b?tt:Q,a=g?x:x*it+x,s=x*(g?.25:1),c=Math.max(.25,(n-ot*a-s)/(2*a));i.domain(t).range([0,n]).paddingInner(y?.3:.25).paddingOuter(c);var u=u||e.extent(mt.map(function(t){var e=t.y0+(b?0:t.y),n=t.y0+(b?t.y:0);return g?t.y>0?e:n:t.y}).concat(p)),d=b?[r,0]:[0,r];if(o.domain(u).range(d),v&&(ct=b&&e.max(ht)+8>C(),ut=ct||!b),ft){var f=0,w=r,k=0,M=0;s=b?ct?2:-2:2,gt.forEach(function(t,e){var n=ut?ht[e]:pt,r=parseFloat(t.y),a=o(r),i=0;b&&r>0||!b&&0>r?(i=a-n,f>i&&(M=n,f=i)):(i=a+n,i>w&&(k=n,w=i))}),b?o.range([r-(o.domain()[0]<0?k+s+2:0),o.domain()[1]>0?M+s:0]):o.range([o.domain()[0]<0?M+s+4:0,r-(o.domain()[1]>0?k+s:0)])}F&&o.nice(),O=O||i,_=_||o}function A(t,n){var r=T(t),a="inherit"===r?e.select("."+P(t,n).split(" ").join(".")).style("color"):r;return S.getTextContrast(a,n)}function I(t,e){return Math.max(Math.round(Math.abs(o(c(t,e))-o(0))),0)}function C(){return i.bandwidth()/(g?1:u.length)}function N(t,e){var n;return n=g?{x:Math.round(i(l(t,e))),y:Math.round(o(t.y0))}:{x:Math.round(t.seri*C()+i(l(t,e))),y:Math.round(o(c(t,e)<0?b?0:c(t,e):b?c(t,e):0))},"translate("+n[rt]+","+n[at]+")"}function H(t,e){var n="total"===dt?vt[e][c(t,e)<0?"neg":"pos"]:t;return d(n)}function B(t,e){var n=this.getBoundingClientRect(),r=Math.floor(n.width),a=Math.floor(n.height);t.labelWidth=t.labelWidth||(ct?a:r)+4,t.labelHeight=t.labelHeight||(ct?r:a),t.barLength=I(t,e),t.barThickness=C()}function R(t,e){var n="middle",r=c(t,e)<0;if(ut){switch(dt){case"start":n=r?"end":"start";break;case"middle":n="middle";break;case"end":n=r?"start":"end";break;case"top":case"total":n=r?"end":"start"}n="rtl"===w&&"middle"!==n?"start"===n?"end":"start":n}else n="middle";return n}function V(t,e){var n=0,r=c(t,e)<0?-1:1,a=0>r,i=(4+2*ut)*r;if(b&&!ct)n=t.barThickness/2;else switch(dt){case"start":n=t.barLength*(a-ct)+i;break;case"middle":n=t.barLength*(ct?-1:1)/2;break;case"end":n=t.barLength*(!ct-a)-i;break;case"top":case"total":n=t.barLength*(!ct-a)+2*r}return n}function G(t,e){var n=0,r=c(t,e)<0?-1:1,a=0>r,i=(t.labelHeight/2+(4+2*ct)*!ft)*r;if(ut)n=t.barThickness/2;else switch(dt){case"start":n=t.barLength*(1-a)-i;break;case"middle":n=t.barLength/2;break;case"end":n=t.barLength*(0+a)+i;break;case"top":case"total":n=t.barLength*(0+a)-i}return n}function W(t,e,n){return ft?"#000":A(t,e)}function Y(t,e){if(ft)return"total"===dt&t.seriesIndex!==st&&t.seriesIndex!==lt?0:1;var n=t.barLength<(ut?t.labelWidth:t.labelHeight)+8,r=t.barThickness<(ut?t.labelHeight:t.labelWidth)+4;return n||r?0:1}function q(t,e){return j(t,e,!0)}function X(t,e){return j(t,e,!1)}function j(t,e,n){var r,a,i,o,s,l,u;if(r=0,a=c(t,e)>=0,i=4*f(n)*f(a),o=n===a?0:1,!n^b)r=(t.barThickness-(ut?t.labelHeight:t.labelWidth))/2;else switch(l=t.barLength-(ut?t.labelWidth:t.labelHeight),dt){case"start":r=l*(0+o)+i;break;case"middle":r=l/2;break;case"end":r=l*(1-o)-i;break;case"top":case"total":s=ct===n?t.labelHeight:t.labelWidth,r=t.barLength*(1-o)-s*(0+o)}return r}function K(t){return ct?t.labelHeight:t.labelWidth}function Z(t){return ct?t.labelWidth:t.labelHeight}function U(t,e){return ft?"#fff":D(t,e)}function $(t,e,n){return{pointIndex:n,point:e,seriesIndex:e.seriesIndex,series:u[e.seri],groupIndex:e.groupIndex,id:s,e:t}}var J=e.select(this),Q=r-n.left-n.right,tt=a-n.top-n.bottom,et=b?"width":"height",nt=b?"height":"width",rt=b?"x":"y",at=b?"y":"x",it=0,ot=0,st=0,lt=u.length-1,ct=!1,ut=!1,dt=v,ft=!1,ht=[],pt=0,gt=[],mt=[],vt=[];
if(dt&&(g?("top"===dt||dt===!0)&&(dt="end"):"total"===dt?dt="top":dt===!0&&(dt="end"),ct=b,ft="total"===dt||"top"===dt),t.resetDimensions=function(t,e){r=t,a=e,Q=t-n.left-n.right,tt=e-n.top-n.bottom,M()},mt=e.merge(u.map(function(t){return t.values})),it=u.length,ot=u[0].values.length,v){u.forEach(function(t,e){t.values.forEach(function(t,e){t.label=d(t)})}),gt="total"===dt?e.merge(vt.map(function(t){return[t.neg,t.pos]})):mt,ht=S.stringSetLengths(gt.map(d),J,"sc-label-value"),pt=S.stringSetThickness(["Xy"],J,"sc-label-value")[0];var yt=e.extent(u.map(function(t,e){return t.seriesIndex}));st=yt[0],lt=yt[1]}M();var bt=J.selectAll("g.sc-wrap.sc-multibar").data([u]),xt=bt.enter().append("g").attr("class","sc-wrap sc-multibar"),wt=J.select(".sc-wrap.sc-multibar").merge(xt),kt=xt.append("defs"),Mt=wt.select("defs");if(wt.attr("transform",S.translation(n.left,n.top)),k&&(kt.append("clipPath").attr("id","sc-edge-clip-"+s).append("rect"),Mt.select("#sc-edge-clip-"+s+" rect").attr("width",Q).attr("height",tt)),wt.attr("clip-path",k?"url(#sc-edge-clip-"+s+")":""),E)var At=S.createTexture(kt,s);t.gradientFill=function(t,e,n){var r=s+"-"+e,a=D(t,e);return L(t,r,n,a,Mt)};var It=T===D,Ct=wt.selectAll(".sc-series").data(S.identity),St=Ct.enter().append("g").attr("class",P).style("stroke-opacity",1e-6).style("fill-opacity",1e-6);Ct.exit().remove();var Ft=wt.selectAll(".sc-series").merge(St);Ft.attr("fill",T).attr("class",P).classed("hover",function(t){return t.hover}).classed("sc-active",function(t){return"active"===t.active}).classed("sc-inactive",function(t){return"inactive"===t.active}).style("stroke-opacity",1).style("fill-opacity",1),Ft.on("mouseover",function(t,n,r){e.select(this).classed("hover",!0)}).on("mouseout",function(t,n,r){e.select(this).classed("hover",!1)});var Dt=Ft.selectAll(".sc-bar").data(function(t){return t.values}),Lt=Dt.enter().append("g").attr("class","sc-bar");Dt.exit().remove();var Tt=Ft.selectAll(".sc-bar").merge(Lt);Lt.append("rect").attr("class","sc-base").style("fill","inherit").attr("x",0).attr("y",0),E&&Lt.append("rect").attr("class","sc-texture").attr("x",0).attr("y",0).style("mask","url("+At+")"),Lt.append("rect").attr("class","sc-label-box").attr("x",0).attr("y",0).attr("width",0).attr("height",0).attr("rx",2).attr("ry",2).style("fill","transparent").style("stroke-width",0).style("fill-opacity",0);var Et=Tt.select(".sc-label-box");Lt.append("text").attr("class","sc-label-value");var Nt=Tt.select(".sc-label-value");Tt.attr("class",function(t,e){return"sc-bar "+(c(t,e)<0?"negative":"positive")}).classed("sc-active",function(t){return"active"===t.active}).attr("transform",N).style("display",function(t,e){return 0!==I(t,e)?"inline":"none"}),Tt.select("rect.sc-base").attr(rt,0).attr(nt,I).attr(et,C),E&&Tt.select("rect.sc-texture").attr(rt,0).attr(nt,I).attr(et,C).style("fill",A),v?(Nt.text(H).attr("transform","rotate("+(0-90*ct)+")").each(B),Nt.attr("dy","0.35em").attr("text-anchor",R).attr("x",V).attr("y",G).style("fill",W).style("fill-opacity",Y),Et.attr("x",q).attr("y",X).attr("width",K).attr("height",Z).style("fill",U).style("fill-opacity",Y)):(Nt.text("").style("fill-opacity",0),Tt.select("rect.label-box").style("fill-opacity",0)),Tt.on("mouseover",function(t,n){var r=$(e.event,t,n);z.call("elementMouseover",this,r)}).on("mousemove",function(t,n){var r=e.event;z.call("elementMousemove",this,r)}).on("mouseout",function(t,n){var r=$(e.event,t,n);z.call("elementMouseout",this,r)}).on("click",function(t,n){e.event.stopPropagation();var r=$(e.event,t,n);z.call("elementClick",this,r)}).on("dblclick",function(t,n){e.event.stopPropagation();var r=$(e.event,t,n);z.call("elementDblClick",this,r)}),O=i.copy(),_=o.copy()}),t}var n={top:0,right:0,bottom:0,left:0},r=960,a=500,i=e.scaleBand(),o=e.scaleLinear(),s=Math.floor(1e4*Math.random()),l=function(t){return t.x},c=function(t){return t.y},u=function(t,e,n){return n||t},d=function(t,e){return u(t.y,e,t.label)},f=S.buildLocality(),h=[],p=[0],g=!0,m,v=!1,y=!1,b=!0,x=60,w="ltr",k=!1,M=0,A=0,I=null,C=null,F=!1,D=function(t,e){return S.defaultColor()(t,t.seriesIndex)},L=S.colorLinearGradient,T=D,E=!1,N=null,P=function(t,e){return"sc-series sc-series-"+t.seriesIndex},z=e.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove"),O,_;return t.dispatch=z,t.color=function(e){return arguments.length?(D=e,t):D},t.fill=function(e){return arguments.length?(T=e,t):T},t.classes=function(e){return arguments.length?(P=e,t):P},t.gradient=function(e){return arguments.length?(L=e,t):L},t.x=function(e){return arguments.length?(l=e,t):l},t.y=function(e){return arguments.length?(c=e,t):c},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.xScale=function(e){return arguments.length?(i=e,t):i},t.yScale=function(e){return arguments.length?(o=e,t):o},t.xDomain=function(e){return arguments.length?(I=e,t):I},t.yDomain=function(e){return arguments.length?(C=e,t):C},t.forceX=function(e){return arguments.length?(h=e,t):h},t.forceY=function(e){return arguments.length?(p=e,t):p},t.stacked=function(e){return arguments.length?(g=e,t):g},t.barColor=function(e){return arguments.length?(N=S.getColor(e),t):N},t.disabled=function(e){return arguments.length?(m=e,t):m},t.id=function(e){return arguments.length?(s=e,t):s},t.delay=function(e){return arguments.length?(M=e,t):M},t.duration=function(e){return arguments.length?(A=e,t):A},t.clipEdge=function(e){return arguments.length?(k=e,t):k},t.showValues=function(e){return arguments.length?(v=isNaN(parseInt(e,10))?e:parseInt(e,10)&&!0||!1,t):v},t.valueFormat=function(e){return arguments.length?(u=e,t):u},t.withLine=function(e){return arguments.length?(y=e,t):y},t.vertical=function(e){return arguments.length?(b=e,t):b},t.baseDimension=function(e){return arguments.length?(x=e,t):x},t.direction=function(e){return arguments.length?(w=e,t):w},t.textureFill=function(e){return arguments.length?(E=e,t):E},t.nice=function(e){return arguments.length?(F=e,t):F},t.locality=function(e){return arguments.length?(f=S.buildLocality(e),t):f},t}function f(){function t(o){return o.each(function(o){function u(t,e,n){return{id:i,key:c(e),value:s(e),count:l(e),data:e,series:e.series,seriesIndex:e.series.seriesIndex,e:t}}function d(t,n,r){function a(t){return(t+f)%s}var i=[],o=[],s=2*Math.PI,l=0,c=Math.PI/2,u=Math.PI,d=3*Math.PI/2,f=0;t.each(function(t,e){var h=0===B(t)?0:(B(t)+s)%s,p=0===R(t)?0:(R(t)+s)%s,g=Math.round(1e4*Math.sin(h))/1e4,m=Math.round(1e4*Math.sin(p))/1e4,v=Math.round(1e4*Math.cos(h))/1e4,y=Math.round(1e4*Math.cos(p))/1e4;f=h>p?s-h:0,p===h?(h=0,p=s):(h=a(h),p=a(p)),l=a(l),c=a(c),u=a(u),d=a(d),(h%s===0||p%s===0)&&(o.push(r),C&&o.push(r*P)),c>=h&&p>=c&&(i.push(n),C&&i.push(n*P)),u>=h&&p>=u&&(o.push(-r),C&&o.push(-r*P)),d>=h&&p>=d&&(i.push(-n),C&&i.push(-n*P)),i.push(n*g),i.push(n*m),C?(i.push(n*P*g),i.push(n*P*m)):i.push(0),o.push(r*v),o.push(r*y),C?(o.push(r*P*v),o.push(r*P*y)):o.push(0)}),dt=e.extent(i),ft=e.extent(o),ct*=Y/(e.max(dt)-e.min(dt)),ut*=q/(e.max(ft)-e.min(ft))}function f(){var t=[ct],n=[ut+L];it.select(".sc-base").each(function(e,r){if(g(e)){var a=(B(e)+R(e))/2,i=Math.sin(a),o=Math.cos(a),s=ct-gt-j[r],l=ut-pt,c=i?s/i:s,u=o?l/o:l;t.push(c),n.push(u)}});var r=e.min(t.concat(n).concat([]),function(t){return Math.abs(t)});return r}function p(){var t=.3*et.node().getBoundingClientRect().height,n=Math.abs(ut*e.min(ft)),r=Math.round(t-n);return r}function g(t){var e=(R(t)-B(t))/(2*Math.PI);return e>I?1:0}function E(t,e){var n=2*Math.PI,r=((B(t)+R(t))/2+n)%n;return r>0&&r<Math.PI?1:-1}function N(t){C||(t.innerRadius=0);var n=e.interpolate(this._current,t);return this._current=n(0),function(t){var e=n(t);return It(e)}}function W(t){t.innerRadius=0;var n=e.interpolate({startAngle:0,endAngle:0},t);return function(t){return It(n(t))}}var Y=r-n.left-n.right,q=a-n.top-n.bottom,X=e.select(this),j=[],K=w&&M?!0:!1;K&&(j=S.stringSetLengths(o.map(c),X,"sc-label"));var Z=X.selectAll("g.sc-wrap").data([o]),U=Z.enter().append("g").attr("class","sc-wrap sc-pie"),$=X.select(".sc-wrap.sc-pie").merge(U),J=U.append("defs"),Q=$.select("defs");U.append("g").attr("class","sc-group");var tt=$.select(".sc-group");U.append("g").attr("class","sc-hole-wrap");var et=$.select(".sc-hole-wrap");if($.attr("transform",S.translation(n.left,n.top)),b)var nt=S.createTexture(J,i,-Y/2,-q/2);t.gradientFill=function(t,e){var n=i+"-"+e,r={x:0,y:0,r:xt,s:C?100*P+"%":"0%",u:"userSpaceOnUse"},a=m(t,e);return v(t,n,r,a,Q)};var rt=tt.selectAll(".sc-series").data(G),at=rt.enter().append("g").attr("class","sc-series");rt.exit().remove();var it=tt.selectAll(".sc-series").merge(at);at.style("stroke","#FFF").style("stroke-width",2).style("stroke-opacity",0).on("mouseover",function(t,n,r){e.select(this).classed("hover",!0)}).on("mouseout",function(t,n,r){e.select(this).classed("hover",!1)}),it.attr("class",function(t){return x(t.data,t.data.seriesIndex)}).attr("fill",function(t){return y(t.data,t.data.seriesIndex)}).classed("sc-active",function(t){return"active"===t.data.active}).classed("sc-inactive",function(t){return"inactive"===t.data.active});var ot=it.selectAll("g.sc-slice").data(function(t,e){return t.data.values.map(function(n,r){return n.endAngle=t.endAngle,n.padAngle=t.padAngle,n.startAngle=t.startAngle,n.index=e,n})},function(t){return t.seriesIndex});ot.exit().remove();var st=ot.enter().append("g").attr("class","sc-slice"),lt=it.selectAll("g.sc-slice").merge(st);st.append("path").attr("class","sc-base").each(function(t,e){this._current=t}),b&&st.append("path").attr("class","sc-texture").each(function(t,e){this._current=t}).style("mask","url("+nt+")"),st.on("mouseover",function(t,n){e.select(this).classed("hover",!0);var r=u(e.event,t,n);_.call("elementMouseover",this,r)}).on("mousemove",function(t,n){var r=e.event;_.call("elementMousemove",this,r)}).on("mouseout",function(t,n){e.select(this).classed("hover",!1),_.call("elementMouseout",this)}).on("click",function(t,n){e.event.stopPropagation();var r=u(e.event,t,n);_.call("elementClick",this,r)}).on("dblclick",function(t,n){e.event.stopPropagation();var r=u(e.event,t,n);_.call("elementDblClick",this,r)}),st.append("g").attr("class","sc-label").attr("transform","translate(0,0)"),st.select(".sc-label").append("rect").style("fill-opacity",0).style("stroke-opacity",0),st.select(".sc-label").append("text").style("fill-opacity",0),st.append("polyline").attr("class","sc-label-leader").style("stroke-opacity",0);var ct=Y/2,ut=q/2,dt=[],ft=[],ht=0,pt=K?5:0,gt=L+T,mt=0;lt.select(".sc-base").call(d,ct,ut),et.call(H,F?[F]:[]),F&&(mt=p(),mt>0&&(pt+=mt,ht-=mt/2));var vt=Y/2,yt=q/2;K&&(L=Math.max(Math.min(Math.min(f())/12,20),10)),V(t)&&(z=V(t),O=V(t));var bt=Math.min(Math.max(f(),z),O),xt=bt-(K?L:0),wt=(e.max(ft)-e.min(ft))/2+e.min(ft),kt=(bt+ht)/yt;yt+=wt*kt+ht/2;var Mt=(e.max(dt)-e.min(dt))/2-e.max(dt),At=bt/vt;vt+=Mt*At,tt.attr("transform","translate("+vt+","+yt+")"),et.attr("transform","translate("+vt+","+yt+")"),tt.select(nt).attr("x",-xt/2).attr("y",-xt/2);var It=e.arc().innerRadius(C?xt*P:0).outerRadius(xt).startAngle(B).endAngle(R),Ct=e.arc().innerRadius(0).outerRadius(xt).startAngle(B).endAngle(R);M&&(!C||A?Ct.innerRadius(bt).outerRadius(bt):Ct.outerRadius(xt*P)),lt.select(".sc-base").attr("d",It).style("stroke-opacity",function(t){return B(t)===R(t)?0:1}),b&&lt.select(".sc-texture").attr("d",It).style("stroke-opacity",function(t){return B(t)===R(t)?0:1}).style("fill",function(t,n){var r=t.series||t,a=r.seriesIndex||n,i=y(r),o="inherit"===i?e.select("."+x(r,a).split(" ").join(".")).style("color"):i;return S.getTextContrast(o,a)}),w?(lt.select(".sc-label").attr("transform",function(t){if(D){t.outerRadius=xt+10,t.innerRadius=xt+15;var e=(B(t)+R(t))/2*(180/Math.PI);return e+=90*E(t,Ct),"translate("+Ct.centroid(t)+") rotate("+e+")"}var n=Ct.centroid(t),r=k?(L+T)*E(t,Ct):0;return"translate("+[n[0]+r,n[1]]+")"}),lt.select(".sc-label text").text(c).attr("dy",".35em").style("fill","#555").style("fill-opacity",g).style("text-anchor",function(t){if(!M)return"middle";var e=1===E(t,Ct)?"start":"end";return"rtl"===h&&(e="start"===e?"end":"start"),e}),lt.each(function(t,n){var r,a,i,o,s,l;(j[n]>z||bt===z)&&(r=(B(t)+R(t))/2,a=Math.abs(Math.sin(r)),i=j[t.index],o=bt*a+L+T+i,s=Y/2-vt+Y/2-o,0>s&&(l=S.stringEllipsify(c(t),X,i+s),e.select(this).select("text").text(l)))}),M?k&&lt.select(".sc-label-leader").attr("points",function(t){if(!g(t))return"0,0 0,0";var n=e.arc().innerRadius(xt).outerRadius(xt).startAngle(B).endAngle(R),r=k?L*E(t,n):0,a=n.centroid(t),i=Ct.centroid(t),o=[i[0]+r,i[1]];return a+" "+i+" "+o}).style("stroke","#AAA").style("fill","none").style("stroke-opacity",g):lt.select(".sc-label").each(function(t){if(g(t)){var n=e.select(this),r=n.select("text").node().getBoundingClientRect();n.select("rect").attr("rx",3).attr("ry",3).attr("width",r.width+10).attr("height",r.height+10).attr("transform",function(){return"translate("+[r.x-5,r.y-5]+")"}).style("fill","#FFF").style("fill-opacity",g)}})):(lt.select(".sc-label-leader").style("stroke-opacity",0),lt.select(".sc-label rect").style("fill-opacity",0),lt.select(".sc-label text").style("fill-opacity",0))}),t}var n={top:0,right:0,bottom:0,left:0},r=500,a=500,i=Math.floor(1e4*Math.random()),o=function(t){return(t.series||t).key},s=function(t,e){return(t.series||t).value},l=function(t,e){return(t.series||t).count},c=function(t){return o(t)},u=function(t){return s(t)},d=function(t){return isNaN(l(t))?"":" ("+l(t)+")"},f=S.buildLocality(),h="ltr",p=0,g=0,m=function(t,e){return S.defaultColor()(t.series,t.seriesIndex)},v=S.colorRadialGradient,y=m,b=!1,x=function(t,e){return"sc-series sc-series-"+t.seriesIndex},w=!0,k=!0,M=!0,A=!0,I=.01,C=!1,F=!1,D=!1,L=20,T=5,E=360,N=0,P=.447,z=75,O=250,_=e.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove"),H=function(t,e){var n=t.selectAll(".sc-hole-container").data(e),r=n.enter().append("g").attr("class","sc-hole-container");r.append("text").text(e).attr("class","sc-pie-hole-value").attr("dy",".35em").attr("text-anchor","middle").style("font-size","50px"),n.exit().remove()},B=function(t){return t.startAngle*E/360+S.angleToRadians(N)},R=function(t){return t.endAngle*(E/360)+S.angleToRadians(N)},V=function(t){return null},G=e.pie().sort(null).value(s);return t.dispatch=_,t.id=function(e){return arguments.length?(i=e,t):i},t.color=function(e){return arguments.length?(m=e,t):m},t.fill=function(e){return arguments.length?(y=e,t):y},t.classes=function(e){return arguments.length?(x=e,t):x},t.gradient=function(e){return arguments.length?(v=e,t):v},t.margin=function(e){return arguments.length?(n.top="undefined"!=typeof e.top?e.top:n.top,n.right="undefined"!=typeof e.right?e.right:n.right,n.bottom="undefined"!=typeof e.bottom?e.bottom:n.bottom,n.left="undefined"!=typeof e.left?e.left:n.left,t):n},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.getKey=function(e){return arguments.length?(o=e,t):o},t.getValue=function(e){return arguments.length?(s=e,t):s},t.getCount=function(e){return arguments.length?(l=e,t):l},t.fmtKey=function(e){return arguments.length?(c=e,t):c},t.fmtValue=function(e){return arguments.length?(u=e,t):u},t.fmtCount=function(e){return arguments.length?(d=e,t):d},t.direction=function(e){return arguments.length?(h=e,t):h},t.delay=function(e){return arguments.length?(p=e,t):p},t.duration=function(e){return arguments.length?(g=e,t):g},t.locality=function(e){return arguments.length?(f=S.buildLocality(e),t):f},t.textureFill=function(e){return arguments.length?(b=e,t):b},t.showLabels=function(e){return arguments.length?(w=e,t):w},t.labelSunbeamLayout=function(e){return arguments.length?(D=e,t):D},t.donutLabelsOutside=function(e){return arguments.length?(A=e,t):A},t.pieLabelsOutside=function(e){return arguments.length?(M=e,t):M},t.showLeaders=function(e){return arguments.length?(k=e,t):k},t.donut=function(e){return arguments.length?(C=e,t):C},t.hole=function(e){return arguments.length?(F=e,t):F},t.holeFormat=function(e){return arguments.length?(H=S.functor(e),t):H},t.donutRatio=function(e){return arguments.length?(P=e,t):P},t.startAngle=function(e){return arguments.length?(B=e,t):B},t.endAngle=function(e){return arguments.length?(R=e,t):R},t.labelThreshold=function(e){return arguments.length?(I=e,t):I},t.arcDegrees=function(e){return arguments.length?(E=Math.max(Math.min(e,360),1),t):E},t.rotateDegrees=function(e){return arguments.length?(N=e%360,t):N},t.minRadius=function(e){return arguments.length?(z=e,t):z},t.maxRadius=function(e){return arguments.length?(O=e,t):O},t.fixedRadius=function(e){return arguments.length?(V=S.functor(e),t):V},t}function h(){function t(d,f,h,p){function g(){if(u){var t=e.zoom().on("zoom",l);h.call(t),P.call(t)}else h.on("zoom",null),P.on("zoom",null)}function m(){L.append("linearGradient").attr("class","sc-scroll-gradient").attr("id","sc-back-gradient-prev-"+n);var t=L.select("#sc-back-gradient-prev-"+n);L.append("linearGradient").attr("class","sc-scroll-gradient").attr("id","sc-back-gradient-more-"+n);var e=L.select("#sc-back-gradient-more-"+n);t.append("stop").attr("stop-color","#000").attr("stop-opacity","0.3").attr("offset",0),t.append("stop").attr("stop-color","#FFF").attr("stop-opacity","0").attr("offset",1),e.append("stop").attr("stop-color","#FFF").attr("stop-opacity","0").attr("offset",0),e.append("stop").attr("stop-color","#000").attr("stop-opacity","0.3").attr("offset",1),L.append("linearGradient").attr("class","sc-scroll-gradient").attr("id","sc-fore-gradient-prev-"+n);var r=L.select("#sc-fore-gradient-prev-"+n);L.append("linearGradient").attr("class","sc-scroll-gradient").attr("gradientUnits","objectBoundingBox").attr("x1",0).attr("y1",0).attr("id","sc-fore-gradient-more-"+n);var a=L.select("#sc-fore-gradient-more-"+n);r.append("stop").attr("stop-color","#FFF").attr("stop-opacity","1").attr("offset",0),r.append("stop").attr("stop-color","#FFF").attr("stop-opacity","0").attr("offset",1),a.append("stop").attr("stop-color","#FFF").attr("stop-opacity","0").attr("offset",0),a.append("stop").attr("stop-color","#FFF").attr("stop-opacity","1").attr("offset",1),D.selectAll(".sc-scroll-gradient").attr("gradientUnits","objectBoundingBox").attr("x1",0).attr("y1",0)}function v(){D.selectAll(".sc-scroll-gradient").attr("x2",a?1:0).attr("y2",a?0:1)}function y(){L.append("clipPath").attr("class","sc-scroll-mask").attr("id","sc-edge-clip-"+n).append("rect"),N=D.select(".sc-scroll-mask rect")}function b(){h.attr("clip-path",u?"url(#sc-edge-clip-"+n+")":"")}function x(t,e){N.attr("x",a?2:-r.left).attr("y",a?0:2).attr("width",t+(a?-2:r.left)).attr("height",e+(a?r.bottom:-2))}function w(){f.select(".sc-background-wrap").append("rect").attr("class","sc-scroll-target").attr("fill","transparent"),P=d.select(".sc-scroll-target")}function k(t,e,n,r){P.attr("x",t).attr("y",e).attr("width",n).attr("height",r)}function M(){var t=f.select(".sc-background-wrap").append("g").attr("class","sc-back-shadow-wrap");t.append("rect").attr("class","sc-back-shadow-prev"),t.append("rect").attr("class","sc-back-shadow-more"),z=d.select(".sc-back-shadow-wrap")}function A(){var t=a?"width":"height";z.select("rect.sc-back-shadow-prev").attr("fill",u?"url(#sc-back-gradient-prev-"+n+")":"transparent").attr(t,7),z.select("rect.sc-back-shadow-more").attr("fill",u?"url(#sc-back-gradient-more-"+n+")":"transparent").attr(t,7)}function I(t,e,n,r,i,o){z.select(".sc-back-shadow-prev").attr("x",t).attr("y",e).attr(i,o),z.select(".sc-back-shadow-more").attr("x",t+(a?n-5:1)).attr("y",e+(a?0:r-6)).attr(i,o)}function C(){var t=f.select(".sc-background-wrap").insert("g").attr("class","sc-fore-shadow-wrap");t.append("rect").attr("class","sc-fore-shadow-prev"),t.append("rect").attr("class","sc-fore-shadow-more"),O=d.select(".sc-fore-shadow-wrap")}function S(){var t=a?"width":"height";O.select(".sc-fore-shadow-prev").attr("fill",u?"url(#sc-fore-gradient-prev-"+n+")":"transparent").attr(t,20),O.select(".sc-fore-shadow-more").attr("fill",u?"url(#sc-fore-gradient-more-"+n+")":"transparent").attr(t,20)}function F(t,e,n,r){O.select(".sc-fore-shadow-prev").attr("x",t+(a?1:0)).attr("y",e+(a?0:1)).attr(n,r),O.select(".sc-fore-shadow-more").attr("x",t+(a?s-17:0)).attr("y",e+(a?0:s-19)).attr(n,r)}var D=d.select("defs"),L=f.select("defs"),T=h.select(".sc-axis-wrap.sc-axis-x"),E=h.select(".sc-bars-wrap"),N,P,z,O,_=0;return m(),y(),w(),M(),C(),t.render=function(){g(),v(),b(),A(),S()},t.resize=function(e,n){var s,l,d,f,h,g,m;_=e,c=n,t.render(),u&&(s=p.labelThickness()+p.tickPadding()/2,l=a?r.left:s,d=r.top,f=i+(a?0:r[p.orient()]-s),h=o+(a?r[p.orient()]-s:0),g=a?"height":"width",m=a?h:f,x(i,o),k(l,d,f,h),I(l,d,i,o,g,m),F(l,d,g,m))},t.pan=function(t){var n=e.event,r,i=0,o=0,s=0,l="";return!n||"click"!==n.type&&"zoom"!==n.type?0:(r=n.sourceEvent,"zoom"===n.type&&r&&("wheel"===r.type?(i=-r.deltaX,o=-r.deltaY,s=_+(Math.abs(i)>Math.abs(o)?i:o)):"mousemove"===r.type?(i=r.movementX,o=r.movementY,s=_+(Math.abs(i)>Math.abs(o)?i:o)):"touchmove"===r.type&&(i=n.transform.x,o=n.transform.y,s=Math.abs(i)>Math.abs(o)?i:o)),_=Math.min(Math.max(s,t),-1),l="translate("+(a?_+",0":"0,"+_)+")",(s>0||t>s)&&c(Math.abs(o)>Math.abs(i)?o:0),O.attr("transform",l),E.attr("transform",l),T.select(".sc-wrap.sc-axis").attr("transform",l),_)},t}var n,r={},a,i,o,s,l,c,u;return t.id=function(e){return arguments.length?(n=e,t):n},t.margin=function(e){return arguments.length?(r.top="undefined"!=typeof e.top?e.top:r.top,r.right="undefined"!=typeof e.right?e.right:r.right,r.bottom="undefined"!=typeof e.bottom?e.bottom:r.bottom,r.left="undefined"!=typeof e.left?e.left:r.left,t):r},t.width=function(e){return arguments.length?(i=e,t):i},t.height=function(e){return arguments.length?(o=e,t):o},t.vertical=function(e){return arguments.length?(a=e,t):a},t.minDimension=function(e){return arguments.length?(s=e,t):s},t.panHandler=function(e){return arguments.length?(l=S.functor(e),t):l},t.enable=function(e){return arguments.length?(u=e,t):u},t}function p(){function t(r){return r.each(function(r){function a(e){var r=e&&e.length&&e.filter(function(t){return t.values.length}).length,a=(c-n.left-n.right)/2+n.left,o=(u-n.top-n.bottom)/2+n.top;return S.displayNoData(r,i,t.strings().noData,a,o)}var i=e.select(this),s=r?r.properties:{},l=r&&r.data?r.data.map(function(t,e){return{key:t.key||"Undefined",type:t.type||null,disabled:t.disabled||!1,series:t.seriesIndex||e,values:t._values||t.values}}):null,c=parseInt(i.style("width"),10),u=parseInt(i.style("height"),10),d=s.groups||e.range(1,e.max(l.map(function(t){return t.values.length}))+1).map(function(t){return{group:t,l:"Group "+t}}),f=1===e.max(l.map(function(t){return t.values.length}));if(a(l))return t;var h=i.selectAll("table").data([l]),p=h.enter().append("table");h.exit().remove();var g=i.selectAll("table").merge(p),m=p.attr("class","sucrose"),v=m.append("thead").attr("class","sc-thead").append("tr").attr("class","sc-groups"),y=g.select(".sc-groups").merge(v);v.append("th").attr("class","sc-th sc-series-state").text("Enabled"),v.append("th").attr("class","sc-th sc-series-keys").text(s.key||"Series Key");var b=y.selectAll(".sc-group").data(d),x=b.enter().append("th").attr("class","sc-th sc-group");b.exit().remove(),y.selectAll(".sc-group").merge(x).text(function(t){return f?"Series Total":t.l}),f||v.append("th").attr("class","sc-th sc-series-totals").text("Series Total");var w=m.append("tfoot").attr("class","sc-tfoot").append("tr").attr("class","sc-sums"),k=g.select(".sc-sums").merge(w);w.append("th").attr("class","sc-th sc-group-sums").text(""),w.append("th").attr("class","sc-th sc-group-sums").text(f?"Sum":"Group Sums");var M=k.selectAll(".sc-sum").data(function(t){return t.filter(function(t){return!t.disabled}).map(function(t){return t.values.map(function(t){return o(t)})}).reduce(function(t,e){return t.map(function(t,n){return t+e[n]})})}),A=M.enter().append("th").attr("class","sc-sum");M.exit().remove(),k.selectAll(".sc-sum").merge(A).text(function(t){return t}),f||(w.append("th").attr("class","sc-th sc-sum-total"),k.select(".sc-sum-total").text(function(t){return t.filter(function(t){return!t.disabled}).map(function(t){return t.values.map(function(t){return o(t)}).reduce(function(t,e){return t+e})}).reduce(function(t,e){return t+e})})),m.append("tbody").attr("class","sc-tbody");var I=g.select(".sc-tbody"),C=I.selectAll(".sc-series").data(function(t){return t});C.exit().remove();var F=C.enter().append("tr").attr("class","sc-series");F.append("td").attr("class","sc-td sc-state").attr("tabindex",-1).attr("data-editable",!1).append("input").attr("type","checkbox"),F.append("td").attr("class","sc-td sc-key");var D=I.selectAll(".sc-series").merge(F).style("color",function(t){return t.disabled?"#ddd":"#000"}).style("text-decoration",function(t){return t.disabled?"line-through":"inherit"});D.select(".sc-state input").property("checked",function(t){return t.disabled?!1:!0}),D.select(".sc-key").text(function(t){return t.key});var L=D.selectAll(".sc-val").data(function(t,e){return t.values.map(function(t,n){var r=Array.isArray(t)?{0:t[0],1:t[1]}:{x:t.x,y:t.y};return r.series=e,r.index=n,r})}),T=L.enter().append("td").attr("class","sc-td sc-val");L.exit().remove(),I.selectAll(".sc-val").merge(T).text(function(t){return o(t)}),f||(F.append("td").attr("class","sc-td sc-total").attr("tabindex",-1).attr("data-editable",!1),D.select(".sc-total").text(function(t){return t.values.map(function(t){return o(t)}).reduce(function(t,e){return t+e})}))}),t}var n={top:2,right:0,bottom:2,left:0},r=0,a=0,i=function(t){return t.x},o=function(t){return t.y},s=D(),l=S.getColor(["#000"]);return t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.x=function(e){return arguments.length?(i=S.functor(e),t):i},t.y=function(e){return arguments.length?(o=S.functor(e),t):o},t.strings=function(e){return arguments.length?(s=D(e),t):s},t.color=function(e){return arguments.length?(l=S.getColor(e),t):l},t}function g(){function t(e){var n=e.data?e.data:e,r=d(n).toLowerCase(),a,i;if(r&&-1===I.indexOf(r)&&(I.push(r),n.children))for(i=n.children.length,a=0;i>a;a+=1)t(n.children[a]);return I}function n(p){return p.each(function(p){function g(t,e){return t.colorIndex||I.indexOf(d(t).toLowerCase())||e}function C(){var t=B.selectAll(".sc-grandparent.sc-trans").data([M]),n=t.enter().append("g").attr("class","sc-grandparent sc-trans"),a=B.selectAll(".sc-grandparent.sc-trans").merge(n);a.attr("transform",S.translation(r.left,r.top)).lower();var i=a.selectAll("g.sc-parent").data(M.children),o=i.enter().append("g").classed("sc-parent",!0),s=a.selectAll(".sc-parent").merge(o);i.exit().remove(),s.classed("sc-active",function(t){return"active"===t.active}).style("stroke-opacity",1).style("fill-opacity",1);var l=s.selectAll("rect.sc-child").data(function(t){return t.children||[t]}),c=l.enter().append("rect").attr("class","sc-child"),d=s.selectAll(".sc-child").merge(c);l.exit().remove(),b&&o.append("rect").attr("class","sc-texture").attr("x",0).attr("y",0).style("mask","url("+G+")"),d.attr("class",function(t,e){return x(t,g(t.parent.data,e))}).attr("fill",function(t,e){return this.getAttribute("fill")||y(t,g(t.parent.data,e),I.length)}).call(T),b&&s.select("rect.sc-texture").style("fill",function(t,e){var n=this.getAttribute("fill")||y(t,g(t.parent.data,e),I.length),r=S.getTextContrast(n,e);return r}).call(T);var f=s.selectAll("text.sc-label").data(function(t){return[t]}),h=f.enter().append("text").attr("class","sc-label").attr("dy",".75em"),p=s.selectAll(".sc-label").merge(h);f.exit().remove(),p.text(function(t){return u(t.data)}).style("fill",function(t,e){var n=this.getAttribute("fill")||y(t,g(t.data,e),I.length),r=S.getTextContrast(n,e);return r}).call(L);var m=s.selectAll("rect.sc-target").data(function(t){return[t]}),v=m.enter().append("rect").attr("class","sc-target"),w=s.selectAll(".sc-target").merge(v);return m.exit().remove(),w.call(T),q.selectAll("text").datum(M).text(E),q.selectAll("rect").datum(M),w.filter(function(t){return t.children}).on("click",function(t){t.parent&&k.call("chartClick",this,t.parent),D.call(this,t)}),w.filter(function(t){return!t.children}).on("click",function(t,n){e.event.stopPropagation();var r={d:t,i:n};k.call("elementClick",this,r)}),w.on("mouseover",function(t,n){e.select(this).classed("hover",!0);var r=F(e.event,t,n);k.call("elementMouseover",this,r)}).on("mousemove",function(t,n){var r=e.event;k.call("elementMousemove",this,r)}).on("mouseout",function(t,n){e.select(this).classed("hover",!1),k.call("elementMouseout",this)}),d.on("mouseover",function(t,n){e.select(this).classed("hover",!0);var r=F(e.event,t,n);k.call("elementMouseover",this,r)}).on("mouseout",function(t,n){e.select(this).classed("hover",!1),k.call("elementMouseout",this)}),a}function F(t,n,r){return{label:u(n),value:c(n),point:n,pointIndex:r,e:e.event,id:l}}function D(t){var n,r,a,i;k.call("elementMouseout",this),!O&&t&&(M=t,O=!0,X.classed("sc-trans",!1),n=e.select(this).classed("sc-target")?"out":"in",r=e.transition("treemap-out").duration(h).ease(e.easeCubicIn),a=e.transition("treemap-in").duration(h).ease(e.easeCubicIn),i=C(),o.domain([t.x0,t.x1]),s.domain([t.y0,t.y1]),z.style("shape-rendering",null),i.selectAll("text").style("fill-opacity",0),i.selectAll("text").transition(a).style("fill-opacity",1).call(L),i.selectAll("rect").transition(a).style("fill-opacity",1).call(T),X.selectAll("text").transition(r).style("fill-opacity",0).call(L).remove(),X.selectAll("rect").transition(r).style("fill-opacity",0).call(T).on("end",function(t,e){O=!1,z.style("shape-rendering","crispEdges"),X.selectAll("*").interrupt("treemap-out"),X.remove(),X=i}))}function L(t){t.attr("x",function(t){var e="rtl"===w?-1:1;return o(t.x0)+6*e}).attr("y",function(t){return s(t.y0)+6})}function T(t){t.attr("x",function(t){return o(t.x0)}).attr("y",function(t){return s(t.y0)}).attr("width",function(t){return o(t.x1)-o(t.x0)}).attr("height",function(t){return s(t.y1)-s(t.y0)})}function E(t){return t.parent?E(t.parent)+" / "+u(t.data):u(t.data)}var N=a-r.left-r.right,P=i-r.top-r.bottom,z=e.select(this),O;A=A||e.hierarchy(p[0]).sum(function(t){return c(t)}).sort(function(t,e){return e.height-t.height||e.value-t.value}),I=I.length?I:t(A),e.treemap().size([N,P]).round(!1)(A),M=M||A,o.domain([M.x0,M.x1]).range([0,N]),s.domain([M.y0,M.y1]).range([0,P]);var _=z.selectAll("g.sc-wrap.sc-treemap").data([A]),H=_.enter().append("g").attr("class","sc-wrap sc-treemap"),B=z.select(".sc-wrap.sc-treemap").merge(H),R=H.append("defs"),V=B.select("defs");if(R.append("clipPath").attr("id","sc-edge-clip-"+l).append("rect"),V.select("#sc-edge-clip-"+l+" rect").attr("width",a).attr("height",i),B.attr("clip-path",f?"url(#sc-edge-clip-"+l+")":""),b)var G=S.createTexture(R,l);n.gradientFill=function(t,e,n){var r=l+"-"+e,a=m(t,g(t.parent.data,e),I.length);return v(t,r,n,a,V)};var W=H.selectAll(".sc-treepath").data([A]),Y=W.enter().append("g").attr("class","sc-treepath"),q=B.selectAll(".sc-treepath").merge(Y);Y.append("rect").attr("class","sc-target").on("click",function(t){k.call("chartClick",this,t),D.call(this,t.parent)}),Y.append("text").attr("x","rtl"===w?a-6:6).attr("y",6).attr("dy",".75em"),q.select(".sc-target").attr("width",a).attr("height",r.top);var X=C()}),n}var r={top:20,right:0,bottom:0,left:0},a=0,i=0,o=e.scaleLinear(),s=e.scaleLinear(),l=Math.floor(1e4*Math.random()),c=function(t){return t.size},u=function(t){return t.name},d=function(t){return u(t)},f=!0,h=0,p=0,g=function(t,e){return!1},m=e.scaleOrdinal().range(e.schemeCategory20.map(function(t){return t=e.rgb(t),t.opacity=.6,t})),v=S.colorLinearGradient,y=m,b=!1,x=function(t,e){return"sc-child"},w="ltr",k=e.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove"),M,A,I=[];
return n.dispatch=k,n.color=function(t){return arguments.length?(m=t,n):m},n.fill=function(t){return arguments.length?(y=t,n):y},n.classes=function(t){return arguments.length?(x=t,n):x},n.gradient=function(t){return arguments.length?(v=t,n):v},n.margin=function(t){return arguments.length?(r.top="undefined"!=typeof t.top?t.top:r.top,r.right="undefined"!=typeof t.right?t.right:r.right,r.bottom="undefined"!=typeof t.bottom?t.bottom:r.bottom,r.left="undefined"!=typeof t.left?t.left:r.left,n):r},n.width=function(t){return arguments.length?(a=t,n):a},n.height=function(t){return arguments.length?(i=t,n):i},n.xScale=function(t){return arguments.length?(o=t,n):o},n.yScale=function(t){return arguments.length?(s=t,n):s},n.leafClick=function(t){return arguments.length?(g=t,n):g},n.getValue=function(t){return arguments.length?(c=t,n):c},n.getKey=function(t){return arguments.length?(u=t,n):u},n.groupBy=function(t){return arguments.length?(d=t,n):d},n.groups=function(t){return arguments.length?(I=t,n):I},n.duration=function(t){return arguments.length?(h=t,n):h},n.delay=function(t){return arguments.length?(p=t,n):p},n.id=function(t){return arguments.length?(l=t,n):l},n.direction=function(t){return arguments.length?(w=t,n):w},n.textureFill=function(t){return arguments.length?(b=t,n):b},n}function m(){function t(r){return r.each(function(r){function a(t,e){var r=t&&t.length&&t.filter(function(t){return!t.disabled&&Array.isArray(t.values)&&t.values.length}).length,a=(T-n.left-n.right)/2+n.left,i=(E-n.top-n.bottom)/2+n.top;return S.displayNoData(r,u,e||p.noData,a,i)}function s(t){B=t.map(function(t){return t.label}),R=B.length,V=R>0}function l(t,n){var r=n.map(function(t){return e.select(t).datum()}),a=e.max(e.extent(r),function(t){return S.siDecimal(Math.abs(t))}),i=e.max(r,function(t){return S.countSigFigsAfter(e.formatPrefix(".2s",a)(t))});return"maxmin"===t&&Q.axis&&(i=Math.max(Q.axis.precision,i)),Q[t]={decimal:a,precision:i},Q[t]}var c=this,u=e.select(this),m="area",D=r?r.properties||{}:{},L=r?r.data||null:null,T=parseInt(u.style("width"),10),E=parseInt(u.style("height"),10),N=i,P=o,z="datetime"===D.xDataType||!1,O="currency"===D.yDataType||!1,_=D.groups,H=Array.isArray(_)&&_.length>0,B=[],R=0,V=!1,G=[],W=0,Y=0,q=0,X=[{key:"Stacked",disabled:"zero"!==x.offset()},{key:"Stream",disabled:"wiggle"!==x.offset()},{key:"Expanded",disabled:"expand"!==x.offset()}],j,K;if(t.update=function(){u.transition().duration(d).call(t)},t.container=this,a(L))return t;if(L.forEach(function(t,n){t.seriesIndex=n,t.key=t.key||p.noLabel,t.total=e.sum(t.values,function(t,e){return x.y()(t,e)}),t.disabled=t.disabled||0===t.total}),G=L.filter(function(t){return!t.disabled}).map(function(t,e){return t.seri=e,t}),W=G.length,a(G))return t;H?(_.forEach(function(t,e){var n="undefined"==typeof t.label||""===t.label?p.noLabel:z?S.isNumeric(t.label)||-1!==t.label.indexOf("GMT")?new Date(t.label):new Date(t.label+" GMT"):t.label;t.group=e,t.label=n,t.total=0,G.forEach(function(n,r){n.values.filter(function(t,n){return t.group===e}).forEach(function(e,n){t.total+=e.y})})}),s(_),Y=e.sum(_,function(t){return t.total})):(B=e.merge(G.map(function(t){return t.values})).reduce(function(t,e){return-1===t.indexOf(e.x)&&t.push(e.x),t},[]).map(function(t,e){return z?new Date(t):t}),R=Math.min(Math.ceil(innerWidth/100),B.length),Y=e.sum(G,function(t){return t.total}));var Z=75,U=null,$=null,J=null,Q={axis:null,maxmin:null};z&&(U=S.getDateFormatUTC(B)),$=function(t,e,n,r){var a=V?B[e]:t,i=v(t,e,a,z,U);return"no-ellipsis"===r?i:S.stringEllipsify(i,u,Z)},J=function(t,e,n,r){var a=Q[r]||l(r,n);return y(t,e,null,O,a.precision,a.decimal)},h.disabled=G.map(function(t){return!!t.disabled}),h.style=x.style(),w.chart(t).title(D.title).controlsData(X).legendData(L),x.xDomain(null).yDomain(null).xScale(z?e.scaleTime():e.scaleLinear()),j=x.xScale(),K=x.yScale(),k.orient("bottom").ticks(null).tickValues(null).scale(j).tickPadding(6).valueFormat($).highlightZero(!1).showMaxMin(z),M.orient("left").ticks(null).scale(K).tickPadding(6).valueFormat(J).highlightZero(!0).showMaxMin(!0),A.id(x.id()).useVoronoi(!1).clipEdge(!1).xScale(j).yScale(K);var tt=u.selectAll("g.sc-chart-wrap").data([G]),et=tt.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+m),nt=u.select(".sc-chart-wrap").merge(et);et.append("defs");var rt=nt.select("defs");et.append("g").attr("class","sc-background-wrap");var at=nt.select(".sc-background-wrap");et.append("g").attr("class","sc-title-wrap"),et.append("g").attr("class","sc-axis-wrap sc-axis-x");var it=nt.select(".sc-axis-wrap.sc-axis-x");et.append("g").attr("class","sc-axis-wrap sc-axis-y");var ot=nt.select(".sc-axis-wrap.sc-axis-y");et.append("g").attr("class","sc-"+m+"-wrap");var st=nt.select(".sc-"+m+"-wrap");et.append("g").attr("class","sc-controls-wrap"),et.append("g").attr("class","sc-legend-wrap"),et.append("g").attr("class","sc-guide-wrap");var lt=nt.select(".sc-guide-wrap");nt.attr("transform",S.translation(n.left,n.top)),et.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){function r(t){return"width"===t?I:"height"===t?L:0}function s(){R=k.margin(),B=M.margin(),y.left=Math.max(R.left,B.left),y.right=Math.max(R.right,B.right),y.top=Math.max(R.top,B.top),y.bottom=Math.max(R.bottom,B.bottom),l()}function l(){I=N-y.left-y.right,L=P-O-y.top-y.bottom,x.resetDimensions(r("width"),r("height"))}function f(){M.ticks("wiggle"===x.offset()?0:null).tickSize(q-I,0).margin(y),ot.call(M),s()}function h(){k.tickSize(q-L,0).margin(y),it.call(k),s()}var g,m,y,I,L,O,_=0,H=0;if(T=parseInt(u.style("width"),10),E=parseInt(u.style("height"),10),g=i||T||960,m=o||E||400,N=g-n.left-n.right,P=m-n.top-n.bottom,y={top:0,right:0,bottom:0,left:0},I=N-y.left-y.right,L=P-y.top-y.bottom,at.select(".sc-background").attr("width",g).attr("height",m),Z=Math.max(.2*N,75),w.width(N).height(P),u.call(w),O=w.getHeight(),y.top+=O,L=P-y.top-y.bottom,100>L)return a(null,p.displayError),t;x.width(r("width")).height(r("height")),st.datum(G).call(x);var B={top:0,right:0,bottom:0,left:0},R={top:0,right:0,bottom:0,left:0};f(),h(),f(),h(),f(),st.transition().duration(d).call(x);var V=Math.pow(3,2)*Math.PI;A.width(I).height(L).size(V).sizeRange([V,V]).xDomain(j.domain()).yDomain(K.domain()),lt.datum([{key:"guide",values:[{x:0,y:0},{x:0,y:K.domain()[1]}]}]).call(A),t.showTooltip=function(t,e,n){var r=b(t,n);return F.show(t.e,r,null,null,e)},t.moveGuide=function(n,r,a){var i=a.data[0][0],o=[{x:i,y:0}].concat(a.data.map(function(t,e){return{x:i,y:t[1]}})).concat([{x:i,y:K.domain()[1]}]),s={clientX:a.origin.left+j(i)},l=[i,0];l.e=a.e,l.seriesIndex=0,l.seriesKey="x",lt.datum([{key:"guide",values:o,seriesIndex:0}]).call(A),C||(C={},a.data.forEach(function(e,n){e.e=a.e,C[n]=t.showTooltip(e,c.parentNode,D)}),C.x=t.showTooltip(l,c.parentNode,D)),a.data.forEach(function(t,n){var r=b(t,D);s.clientY=a.origin.top+K(t[1]),e.select(C[n]).select(".tooltip-inner").html(r),F.position(c.parentNode,C[n],s,"e")}),l.forEach(function(t,n){var r=v(t,n,i,z);s.clientY=a.origin.top,e.select(C.x).select(".tooltip-inner").html(r),F.position(c.parentNode,C.x,s,"s")})},y.top+=O,_=y.left,H=y.top+("bottom"===k.orient()?L:0),it.attr("transform",S.translation(_,H)),_=y.left+("left"===M.orient()?0:I),H=y.top,ot.attr("transform",S.translation(_,H)),st.attr("transform",S.translation(y.left,y.top)),lt.attr("transform",S.translation(y.left,y.top))},t.render(),w.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,L.filter(function(t){return!t.disabled}).length||L.forEach(function(t){t.disabled=!1}),h.disabled=L.map(function(t){return!!t.disabled}),e.active="inactive",t.update(),g.call("stateChange",this,h)}),w.controls.dispatch.on("legendClick",function(e,n){if(e.disabled){switch(X.forEach(function(t){t.disabled=!0}),e.disabled=!1,e.key){case"Stacked":x.style("stack");break;case"Stream":x.style("stream");break;case"Expanded":x.style("expand")}h.style=x.style(),t.render(),g.call("stateChange",this,h)}}),g.on("tooltipShow",function(t){f&&(I=!0,lt.classed("hover",!0))}),g.on("tooltipMove",function(e){I&&t.moveGuide(c.parentNode,u,e)}),g.on("tooltipHide",function(){f&&(I=!1,F.cleanup(),C=null,lt.classed("hover",!1))}),x.dispatch.on("elementClick.toggle",function(e){L=1===L.filter(function(t){return!t.disabled}).length?L.map(function(t){return t.disabled=!1,t}):L.map(function(t,n){return t.disabled=n!==e.seriesIndex,t}),h.disabled=L.map(function(t){return!!t.disabled}),t.update(),g.call("stateChange",this,h),g.call("tooltipHide",this)}),g.on("changeState",function(e){"undefined"!=typeof e.disabled&&(L.forEach(function(t,n){t.disabled=e.disabled[n]}),h.disabled=e.disabled),"undefined"!=typeof e.style&&(x.style(e.style),h.style=e.style),t.update()}),g.on("chartClick",function(){w.controls.enabled()&&w.controls.dispatch.call("closeMenu",this),w.legend.enabled()&&w.legend.dispatch.call("closeMenu",this)}),u.on("click",function(){e.event.stopPropagation(),g.call("chartClick",this)})}),t}var n={top:10,right:10,bottom:10,left:10},i=null,o=null,s="ltr",c=0,d=0,f=!0,h={},p=D(),g=e.dispatch("chartClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),m=3,v=function(e,n,r,a,i){var o=r||e;return a?(i=i&&0===i.indexOf("%")?i:"%x",S.dateFormat(o,i,t.locality())):o},y=function(e,n,r,a,i){return i=isNaN(i)?2:i,S.numberFormatSI(e,i,a,t.locality())},b=function(t,e){var n=t.seriesKey,r="currency"===e.yDataType,a=y(t[1],t.pointIndex,null,r,2);return"<p>"+n+": "+a+"</p>"},x=r(),w=l(),k=a(),M=a(),A=u(),I=null,C=null;return x.clipEdge(!0),w.showTitle(!0).showControls(!1).showLegend(!0),A.duration(0),x.dispatch.on("elementMouseover.tooltip",function(t){g.call("tooltipShow",this,t)}),x.dispatch.on("elementMousemove.tooltip",function(t){g.call("tooltipMove",this,t)}),x.dispatch.on("elementMouseout.tooltip",function(t){g.call("tooltipHide",this,t)}),t.dispatch=g,t.area=x,t.legend=w.legend,t.controls=w.controls,t.xAxis=k,t.xAxisLabel=k.axisLabel,t.yAxis=M,t.yAxisLabel=M.axisLabel,t.options=S.optionsFunc.bind(t),S.rebind(t,x,"id","x","y","xScale","yScale","xDomain","yDomain","forceX","forceY","clipEdge","color","fill","classes","gradient","locality"),S.rebind(t,x,"offset","order","style"),S.rebind(t,w,"showTitle","showControls","showLegend"),S.rebind(t,k,"rotateTicks","reduceXTicks","staggerTicks","wrapTicks"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t){return S.defaultColor()(t,t.seriesIndex)},o=function(t){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t){var e=t.seriesIndex,n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+e+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t){return S.defaultColor()(t,t.seriesIndex)},o=function(t){var e=t.seriesIndex;return"sc-series sc-series-"+e+(t.classes?" "+t.classes:"")}}var s=a.gradient?function(t,e){var n={orientation:a.orientation||"horizontal",position:a.position||"base"};return x.gradientFill(t,t.seriesIndex,n)}:i;return x.color(i),x.fill(s),x.classes(o),w.legend.color(i),w.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(i=e,t):i},t.height=function(e){return arguments.length?(o=e,t):o},t.tooltips=function(e){return arguments.length?(f=e,t):f},t.tooltipContent=function(e){return arguments.length?(b=e,t):b},t.state=function(e){return arguments.length?(h=e,g.call("stateChange",this,h),t):h},t.strings=function(e){return arguments.length?(p=D(e),w.strings(p),t):p},t.direction=function(e){return arguments.length?(s=e,x.direction(e),k.direction(e),M.direction(e),w.direction(e),t):s},t.duration=function(e){return arguments.length?(d=e,x.duration(e),t):d},t.delay=function(e){return arguments.length?(c=e,x.delay(e),t):c},t.xValueFormat=function(e){return arguments.length?(v=e,t):v},t.yValueFormat=function(e){return arguments.length?(y=e,t):y},t.pointRadius=function(e){return arguments.length?(m=e,t):m},t}function v(){function t(a){return a.each(function(a){function o(t,e){var r=t&&t.length,a=(O-n.left-n.right)/2+n.left,i=(_-n.top-n.bottom)/2+n.top;return S.displayNoData(r,D,e||h.noData,a,i)}function s(t){var n=e.extent(e.merge(t.map(function(t){return t.values.map(function(t,n){return e.timeParse("%Y-%m-%d")(g(t))})}))),r=[e.timeMonth.floor(n[0]),e.timeDay.offset(e.timeMonth.ceil(n[1]),-1)];return r}function l(t){function n(t){return 32-new Date(t.getFullYear(),t.getMonth(),32).getDate()}var r=e.timeMonth.range(t[0],t[1]),a=r.map(function(t){return e.timeDay.offset(e.timeMonth.floor(t),n(t)/2-1)});return a}function c(t){var n=e.nest().key(y).entries(t),r=1e3/n.length,a=j,i=[0,1],o=[0,1],s=e.scaleLinear().domain(i).range(o),l=[],c=0;return n.map(function(t,e){return t.total=0,t.values=t.values.sort(function(t,e){return e.y<t.y?-1:e.y>t.y?1:0}).map(function(e){return t.total+=e.y,e}),t.group=e,t}).sort(function(t,e){return t.total<e.total?-1:t.total>e.total?1:0}).map(function(t,n){return c+=t.total,i=e.extent(t.values.map(function(t){return t.y})),o=[r*n+a,r*(n+1)-a],s.domain(i).range(o),t.values=t.values.map(function(e){return e.group=t.group,e.opportunity=e.y,e.y=s(e.opportunity),e}),l.push({key:t.key,y:e.min(t.values.map(function(t){return t.y}))}),t}),l}var k=this,D=e.select(this),N="bubble",P=a?a.properties||{}:{},z=a?a.data||[]:[],O=parseInt(D.style("width"),10),_=parseInt(D.style("height"),10),H=r,B=i,R="datetime"===P.xDataType||!1,V="currency"===P.yDataType||!1,G,W,Y,q,X,j,K=function(t,e,n,r){return x(t,e,t,R,"%B")},Z=function(t,e,n,r){var a=X&&Array.isArray(X)?X[e].key||t:t,i=Math.max(.2*H,75);return isNaN(a)?S.stringEllipsify(a,D,i):w(t,e,a,V)},U=[];if(t.update=function(){D.transition().duration(u).call(t)},t.container=this,o(z))return t;f.disabled=z.map(function(t){return!!t.disabled}),W=e.nest().key(b).entries(z),G=W.sort(function(t,e){return parseInt(t.key,10)<parseInt(e.key,10)?-1:parseInt(t.key,10)>parseInt(e.key,10)?1:0}).map(function(t,e){return t.seriesIndex=e,t.classes=t.values[0].classes,t.color=t.values[0].color,t}),j=Math.sqrt(A.sizeRange()[1]/Math.PI),I.chart(t).title(P.title).controlsData(U).legendData(G),I.legend.key(function(t){return t.key+"%"}),Y=s(G),X=c(z),q=e.extent(e.merge(G.map(function(t){return t.values.map(function(t,e){return m(t,e)})})).concat(v)),C.orient("bottom").scale(A.xScale()).valueFormat(K).ticks(e.timeMonths,1).tickValues(l(Y)).tickSize(0).tickPadding(4).highlightZero(!1).showMaxMin(!1),L.orient("left").scale(A.yScale()).valueFormat(Z).ticks(X.length).tickValues(X.map(function(t,e){return X[e].y})).tickPadding(7).highlightZero(!1).showMaxMin(!1);var $=D.selectAll("g.sc-chart-wrap").data([G]),J=$.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+N),Q=D.select(".sc-chart-wrap").merge(J);J.append("defs"),J.append("g").attr("class","sc-background-wrap");var tt=Q.select(".sc-background-wrap");J.append("g").attr("class","sc-title-wrap"),J.append("g").attr("class","sc-axis-wrap sc-axis-x");var et=Q.select(".sc-axis-wrap.sc-axis-x");J.append("g").attr("class","sc-axis-wrap sc-axis-y");var nt=Q.select(".sc-axis-wrap.sc-axis-y");J.append("g").attr("class","sc-"+N+"-wrap");var rt=Q.select(".sc-"+N+"-wrap");J.append("g").attr("class","sc-controls-wrap"),J.append("g").attr("class","sc-legend-wrap"),Q.attr("transform",S.translation(n.left,n.top)),J.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){function e(){c.left=Math.max(y.left,v.left),c.right=Math.max(y.right,v.right),c.top=Math.max(y.top,v.top)+p,c.bottom=Math.max(y.bottom,v.bottom)}function a(){d=H-c.left-c.right,f=B-c.top-c.bottom,A.resetDimensions(d,f)}var s,l,c,d,f,p,g=0,m=0;if(O=parseInt(D.style("width"),10),_=parseInt(D.style("height"),10),s=r||O||960,l=i||_||400,H=s-n.left-n.right,B=l-n.top-n.bottom,c={top:0,right:0,bottom:0,left:0},d=H-c.left-c.right,f=B-c.top-c.bottom,tt.select(".sc-background").attr("width",s).attr("height",l),I.width(H).height(B),D.call(I),p=I.getHeight(),c.top+=p,c.top+=j,f=B-c.top-c.bottom,100>f)return o(null,h.displayError),t;A.width(d).height(f).id(t.id()).xDomain(Y).yDomain(q),rt.datum(G.filter(function(t){return!t.disabled})).transition().duration(u).call(A);var v={top:0,right:0,bottom:0,left:0},y={top:0,right:0,bottom:0,left:0};L.margin(c),nt.call(L),v=L.margin(),e(),a(),C.tickSize(0).margin(c),et.call(C),y=C.margin(),e(),a(),L.tickSize(-d,0).margin(c),nt.call(L),nt.select("path.domain").attr("d","M0,0V0.5H0V"+f),rt.transition().duration(t.delay()).call(A),g=c.left,m=c.top+("bottom"===C.orient()?f:0),et.attr("transform",S.translation(g,m)),g=c.left+("left"===L.orient()?0:d),m=c.top,nt.attr("transform",S.translation(g,m)),rt.attr("transform",S.translation(c.left,c.top))},t.render(),I.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,G.filter(function(t){return!t.disabled}).length||G.forEach(function(t){t.disabled=!1,D.selectAll(".sc-series").classed("disabled",!1)}),f.disabled=G.map(function(t){return!!t.disabled}),p.call("stateChange",this,f),t.update()}),p.on("tooltipShow",function(t){d&&(T=E(t,k.parentNode,P))}),p.on("tooltipMove",function(t){T&&F.position(k.parentNode,T,t,"s")}),p.on("tooltipHide",function(){d&&F.cleanup()}),p.on("changeState",function(e){"undefined"!=typeof e.disabled&&(z.forEach(function(t,n){t.disabled=e.disabled[n]}),f.disabled=e.disabled),t.update()}),p.on("chartClick",function(){p.call("tooltipHide",this),I.controls.enabled()&&I.controls.dispatch.call("closeMenu",this),I.legend.enabled()&&I.legend.dispatch.call("closeMenu",this)}),A.dispatch.on("elementClick",function(e){p.call("chartClick",this),M(z,e,t)}),D.on("click",function(){e.event.stopPropagation(),p.call("chartClick",this)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,i=null,o="ltr",s=0,u=0,d=!0,f={},h=D(),p=e.dispatch("chartClick","elementClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),g=function(t){return t.x},m=function(t){return t.y},v=[0],y=function(t){return t.y},b=function(t){return t.y},x=function(e,n,r,a,i){var o=r||e;return a?(i=i&&0===i.indexOf("%")?i:"MM",S.dateFormat(o,i,t.locality())):o},w=function(e,n,r,a,i){return i=isNaN(i)?2:i,S.numberFormatSI(r,i,a,t.locality())},k=function(t,e){var n=t.series.key,r=t.point.x,a=t.point.y;return"<h3>"+n+"</h3><p>"+a+" on "+r+"</p>"},M=function(t,e,n,r){},A=c(),I=l(),C=a(),L=a(),T=null,E=function(t,e,n){var r=k(t,n),a=t.value<0?"n":"s";return F.show(t.e,r,a,null,e)};return A.padData(!0).padDataOuter(-1).size(function(t){return t.y}).sizeRange([256,1024]).singlePoint(!0),I.showTitle(!0).showControls(!1).showLegend(!0).alignLegend("center"),A.dispatch.on("elementMouseover.tooltip",function(t){p.call("tooltipShow",this,t)}),A.dispatch.on("elementMousemove.tooltip",function(t){p.call("tooltipMove",this,t)}),A.dispatch.on("elementMouseout.tooltip",function(){p.call("tooltipHide",this)}),t.dispatch=p,t.scatter=A,t.legend=I.legend,t.controls=I.controls,t.xAxis=C,t.xAxisLabel=C.axisLabel,t.yAxis=L,t.yAxisLabel=L.axisLabel,t.options=S.optionsFunc.bind(t),S.rebind(t,A,"id","x","y","xScale","yScale","xDomain","yDomain","forceX","forceY","clipEdge","color","fill","classes","gradient","locality"),S.rebind(t,A,"size","zScale","sizeDomain","forceSize","interactive","clipVoronoi","clipRadius"),S.rebind(t,I,"showTitle","showControls","showLegend"),S.rebind(t,C,"rotateTicks","reduceXTicks","staggerTicks","wrapTicks"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t){return S.defaultColor()(t,t.seriesIndex)},o=function(t){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t){var e=t.seriesIndex,n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+e+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t){return t.classes?"inherit":t.color||S.defaultColor()(t,t.seriesIndex)},o=function(t){var e=t.seriesIndex;return"sc-series sc-series-"+e+(t.classes?" "+t.classes:"")}}var s=a.gradient?function(t,e){return A.gradientFill(t,t.seriesIndex)}:i;return A.color(i),A.fill(s),A.classes(o),I.legend.color(i),I.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(i=e,t):i},t.tooltips=function(e){return arguments.length?(d=e,t):d},t.tooltipContent=function(e){return arguments.length?(k=e,t):k},t.state=function(e){return arguments.length?(f=e,p.call("stateChange",this,f),t):f},t.strings=function(e){return arguments.length?(h=D(e),I.strings(h),t):h},t.direction=function(e){return arguments.length?(o=e,A.direction(e),C.direction(e),L.direction(e),I.direction(e),t):o},t.duration=function(e){return arguments.length?(u=e,A.duration(e),t):u},t.delay=function(e){return arguments.length?(s=e,A.delay(e),t):s},t.xValueFormat=function(e){return arguments.length?(x=e,t):x},t.yValueFormat=function(e){return arguments.length?(w=e,t):w},t.seriesClick=function(e){return arguments.length?(M=e,t):M},t.groupBy=function(e){return arguments.length?(y=e,t):y},t.filterBy=function(e){return arguments.length?(b=e,t):b},t}function y(){function t(i){return i.each(function(i){function o(t,e){var r=t&&t.length,a=(A-n.left-n.right)/2+n.left,i=(I-n.top-n.bottom)/2+n.top;return S.displayNoData(r,l,e||h.noData,a,i)}var s=this,l=e.select(this),b="funnel",k=i?i.properties||{}:{},M=i?i.data||null:null,A=parseInt(l.style("width"),10),I=parseInt(l.style("height"),10),C="datetime"===k.xDataType||!1,D="currency"===k.yDataType||!1;if(t.update=function(){l.transition().duration(c).call(t)},t.container=this,o(M))return t;t.setActiveState=function(t,e){t.active=e},t.clearActive=function(e){M.forEach(function(n){t.setActiveState(n,e||"")}),delete d.active},t.seriesActivate=function(e){var n=e.series||M[e.seriesIndex],r;n&&(f?(r="undefined"==typeof n.active||"inactive"===n.active||""===n.active?"active":"",t.clearActive("active"===r?"inactive":""),t.setActiveState(n,r),d.active=M.map(function(t){return"active"===t.active})):t.dataSeriesActivate({series:n}))},t.dataSeriesActivate=function(e){var n=e.series;n.active=n.active&&"inactive"!==n.active?"inactive":"active","active"===n.active&&M.filter(function(t){return"active"!==t.active}).forEach(function(t){return t.active="inactive",t}),M.filter(function(t){return"active"===t.active}).length||t.clearActive()},M.forEach(function(t,n){t.seriesIndex=n,t.values||(t.value?isNaN(t.value)||(t.values=[{x:0,y:parseInt(t.value,10)}]):t.values=[]),t.values.forEach(function(e,n){e.index=n,e.series=t,"undefined"==typeof e.value&&(e.value=e.y)}),t.key=t.key||h.noLabel,t.value=t.value||e.sum(t.values,function(t){return t.value}),t.count=t.count||t.values.length,t.disabled=t.disabled||0===t.value});var L=M.filter(function(t){return!t.disabled});if(L.length||(L=[{values:[]}]),k.count=e.sum(L,function(t){return t.count}),k.total=e.sum(L,function(t){return t.value}),d.disabled=M.map(function(t){return!!t.disabled}),!k.total)return o(),t;m.chart(t).title(k.title).controlsData(v).legendData(M);var T=l.selectAll("g.sc-chart-wrap").data([L]),E=T.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+b),N=l.select(".sc-chart-wrap").merge(E);E.append("defs");var P=N.select("defs");E.append("g").attr("class","sc-background-wrap");var z=N.select(".sc-background-wrap");E.append("g").attr("class","sc-title-wrap"),E.append("g").attr("class","sc-"+b+"-wrap");var O=N.select(".sc-"+b+"-wrap");E.append("g").attr("class","sc-controls-wrap"),E.append("g").attr("class","sc-legend-wrap"),N.attr("transform",S.translation(n.left,n.top)),E.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){var e,i,s,u,d,f,p,v;return A=parseInt(l.style("width"),10),I=parseInt(l.style("height"),10),e=r||A||960,i=a||I||400,s=e-n.left-n.right,u=i-n.top-n.bottom,d={top:0,right:0,bottom:0,left:0},f=s-d.left-d.right,p=u-d.top-d.bottom,z.select(".sc-background").attr("width",e).attr("height",i),m.width(s).height(u),l.call(m),v=m.getHeight(),d.top+=v,p=u-d.top-d.bottom,100>p?(o(null,h.displayError),t):(g.width(f).height(p),void O.datum(L).attr("transform",S.translation(d.left,d.top)).transition().duration(c).call(g))},t.render(),m.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,e.active=!1,M.filter(function(t){return!t.disabled}).length||M.forEach(function(t){t.disabled=!1}),M.filter(function(t){return"active"===t.active}).length||M.forEach(function(t){t.active=""}),d.disabled=M.map(function(t){return!!t.disabled}),p.call("stateChange",this,d),t.update()}),p.on("tooltipShow",function(t){u&&(y=x(t,s.parentNode,k))}),p.on("tooltipMove",function(t){y&&F.position(s.parentNode,y,t)}),p.on("tooltipHide",function(){u&&F.cleanup()}),p.on("changeState",function(e){"undefined"!=typeof e.disabled&&(L.forEach(function(t,n){t.disabled=e.disabled[n]}),d.disabled=e.disabled),t.update()}),p.on("chartClick",function(){m.controls.enabled()&&m.controls.dispatch.call("closeMenu",this),m.legend.enabled()&&m.legend.dispatch.call("closeMenu",this)}),g.dispatch.on("elementClick",function(e){p.call("chartClick",this),w(M,e,t)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,a=null,o="ltr",s=0,c=0,u=!0,d={},f=!0,h=D(),p=e.dispatch("chartClick","elementClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),g=i(),m=l(),v=[],y=null,b=function(e,n){var r=g.getValue()(e),a=n.total?(100*r/n.total).toFixed(1):100,i="currency"===n.yDataType,o={key:g.fmtKey()(e),label:i?h.tooltip.amount:h.tooltip.count,value:S.numberFormat(r,2,i,t.locality()),percent:S.numberFormat(a,2,!1,t.locality())};return F.single(o,h)},x=function(t,e,n){var r=b(t,n);return F.show(t.e,r,null,null,e)},w=function(t,e,n){};return m.showTitle(!0).showControls(!1).showLegend(!0).alignLegend("center"),g.dispatch.on("elementMouseover.tooltip",function(t){p.call("tooltipShow",this,t)}),g.dispatch.on("elementMousemove.tooltip",function(t){p.call("tooltipMove",this,t)}),g.dispatch.on("elementMouseout.tooltip",function(){p.call("tooltipHide",this)}),t.dispatch=p,t.funnel=g,t.legend=m.legend,t.controls=m.controls,t.options=S.optionsFunc.bind(t),S.rebind(t,g,"id","color","fill","classes","gradient","locality","textureFill"),S.rebind(t,g,"getKey","getValue","getCount","fmtKey","fmtValue","fmtCount"),S.rebind(t,g,"yScale","yDomain","forceY","wrapLabels","minLabelWidth"),S.rebind(t,m,"showTitle","showControls","showLegend"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t,e){return S.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t,n){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t,e){var n=t.seriesIndex*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+t.seriesIndex+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t,e){return S.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex+(t.classes?" "+t.classes:"")}}var s=a.gradient?function(t,e){var n={orientation:a.orientation||"vertical",position:a.position||"middle"};return g.gradientFill(t,t.seriesIndex,n)}:i;return g.color(i),g.fill(s),g.classes(o),m.legend.color(i),m.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.tooltips=function(e){return arguments.length?(u=e,t):u},t.tooltipContent=function(e){return arguments.length?(b=e,t):b},t.state=function(e){return arguments.length?(d=e,p.call("stateChange",this,d),t):d},t.strings=function(e){return arguments.length?(h=D(e),m.strings(h),t):h},t.direction=function(e){return arguments.length?(o=e,g.direction(e),m.direction(e),t):o},t.duration=function(e){return arguments.length?(c=e,g.duration(e),t):c},t.delay=function(e){return arguments.length?(s=e,g.delay(e),t):s},t.seriesClick=function(e){return arguments.length?(w=e,t):w},t}function b(){function t(i){return i.each(function(i){function o(t,e){var r=t&&t.length,a=(k-n.left-n.right)/2+n.left,i=(M-n.top-n.bottom)/2+n.top;return S.displayNoData(r,l,e||f.noData,a,i)}var s=this,l=e.select(this),y="gauge",x=i?i.properties||{}:{},w=i?i.data||null:null,k=parseInt(l.style("width"),10),M=parseInt(l.style("height"),10),A="datetime"===x.xDataType||!1,I="currency"===x.yDataType||!1;if(t.update=function(){l.transition().duration(c).call(t)},t.container=this,o(w))return t;var C=0;p.minValue(C),w.forEach(function(t,n){var r=p.getValue()(t);t.seriesIndex=n,r||t.values?S.isNumeric(t.value)&&(t.values=[{x:0,y:r}]):t.values=[],t.values.forEach(function(e,n){e.index=n,e.series=t,e.y0=C,e.y1=C+r}),t.value=r||e.sum(t.values,function(t){return p.getValue()(t)}),t.count=t.count||t.values.length,t.disabled=t.disabled||0===t.value,C+=r});var D=w.filter(function(t,e){return!t.disabled});if(x.count=e.sum(D,function(t){return t.count}),p.maxValue(C),d.disabled=w.map(function(t){return!!t.disabled}),o(D))return t;g.chart(t).title(x.title).controlsData(m).legendData(w);var L=l.selectAll("g.sc-chart-wrap").data([D]),T=L.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+y),E=l.select(".sc-chart-wrap").merge(T);T.append("defs"),T.append("g").attr("class","sc-background-wrap");var N=E.select(".sc-background-wrap");T.append("g").attr("class","sc-title-wrap"),T.append("g").attr("class","sc-"+y+"-wrap");var P=E.select(".sc-"+y+"-wrap");T.append("g").attr("class","sc-controls-wrap"),T.append("g").attr("class","sc-legend-wrap"),E.attr("transform",S.translation(n.left,n.top)),T.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){var e,i,s,u,d,h,m,v;return k=parseInt(l.style("width"),10),M=parseInt(l.style("height"),10),e=r||k||960,i=a||M||400,s=e-n.left-n.right,u=i-n.top-n.bottom,d={top:0,right:0,bottom:0,left:0},h=s-d.left-d.right,m=u-d.top-d.bottom,N.select(".sc-background").attr("width",e).attr("height",i),g.width(s).height(u),l.call(g),v=g.getHeight(),d.top+=v,m=u-d.top-d.bottom,100>m?(o(null,f.displayError),t):(p.width(h).height(m),P.datum(D).attr("transform",S.translation(d.left,d.top)).transition().duration(c).call(p),void p.setPointer(x.value))},t.render(),h.on("tooltipShow",function(t){u&&(v=b(t,s.parentNode,x))}),h.on("tooltipMove",function(t){v&&F.position(s.parentNode,v,t)}),h.on("tooltipHide",function(){u&&F.cleanup()}),h.on("changeState",function(e){"undefined"!=typeof e.disabled&&(D.forEach(function(t,n){t.disabled=e.disabled[n]}),d.disabled=e.disabled),t.update()}),h.on("chartClick",function(){g.controls.enabled()&&g.controls.dispatch.call("closeMenu",this),g.legend.enabled()&&g.legend.dispatch.call("closeMenu",this)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,a=null,i="ltr",s=0,c=0,u=!0,d={},f=D(),h=e.dispatch("chartClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),p=o(),g=l(),m=[],v=null,y=function(t,e){var n=p.fmtKey()(t.point.series),r=p.getCount()(t.point.series),a=p.getValue()(t.point.series);return"<h3>"+n+"</h3><p>"+a+" on "+r+"</p>"},b=function(t,e,n){var r=y(t,n);return F.show(t.e,r,null,null,e)};return g.showTitle(!0).showControls(!1).showLegend(!0).alignLegend("center"),p.dispatch.on("elementMouseover.tooltip",function(t){h.call("tooltipShow",this,t)}),p.dispatch.on("elementMousemove.tooltip",function(t){h.call("tooltipMove",this,t)}),p.dispatch.on("elementMouseout.tooltip",function(){
h.call("tooltipHide",this)}),t.dispatch=h,t.gauge=p,t.legend=g.legend,t.controls=g.controls,t.options=S.optionsFunc.bind(t),S.rebind(t,p,"id","x","y","color","fill","classes","gradient","locality"),S.rebind(t,p,"getKey","getValue","getCount","fmtKey","fmtValue","fmtCount"),S.rebind(t,p,"showLabels","showPointer","setPointer","ringWidth","labelThreshold","maxValue","minValue"),S.rebind(t,g,"showTitle","showControls","showLegend"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t,e){return S.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t,n){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t,e){var n=t.seriesIndex*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+t.seriesIndex+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t,e){return S.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex+(t.classes?" "+t.classes:"")}}var s=a.gradient?function(t,e){return p.gradientFill(t,t.seriesIndex)}:i;return p.color(i),p.fill(s),p.classes(o),g.legend.color(i),g.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.tooltips=function(e){return arguments.length?(u=e,t):u},t.tooltipContent=function(e){return arguments.length?(y=e,t):y},t.state=function(e){return arguments.length?(d=e,t):d},t.strings=function(e){return arguments.length?(f=D(e),g.strings(f),t):f},t.direction=function(e){return arguments.length?(i=e,p.direction(e),g.direction(e),t):i},t.duration=function(e){return arguments.length?(c=e,p.duration(e),t):c},t.delay=function(e){return arguments.length?(s=e,p.delay(e),t):s},t}function x(){function t(t,e,n){var r=N(t,n);return F.show(t.e,r,null,null,e)}function n(s){return s.each(function(s){function l(t,e){var n=t&&t.length,r=($-a.left-a.right)/2+a.left,i=(J-a.top-a.bottom)/2+a.top;return S.displayNoData(n,j,e||h.noData,r,i)}function f(){tt=N(e.event.sourceEvent),et=I.invert(tt),nt=I.rotate(),c&&(F.cleanup(),c=!1),g&&clearInterval(st)}function p(){if(tt){var t=z(e.event.transform.k),n,r,a;n=N(e.event.sourceEvent),r=I.invert(n),r[0]&&(a=[nt[0]+r[0]-et[0],ot.rotate[1]||it.rotate[1]],nt=[a[0],a[1]],I.rotate(a).scale(t),Y())}}function D(){tt=null,c=Q}function N(t){var e=K.getBoundingClientRect(),n=(t?t.clientX||0:0)-e.left,r=(t?t.clientY||0:0)-e.top;return[n,r]}function P(){lt=i||parseInt(j.style("width"),10)||960,ct=o||parseInt(j.style("height"),10)||400,ut=lt-a.left-a.right,dt=ct-a.top-a.bottom}function z(t){var e=Math.min(Math.max(t,.75),3),n=Math.min(dt,ut)/2;return e*n}function O(){return[ut/2+a.left,dt/2+a.top]}function _(t,n){function r(t,e,n,r){var a={point:e,e:t,name:x[e.properties.iso_a2]||e.properties.name,amount:V(e)};return a}T=ft._total;var a=yt.append("g").attr("class",n).selectAll("path").data(t),i=a.enter().append("path").attr("d",q).attr("class",k).style("fill",function(t,e){return t.amount=V(t),M(t,t.properties.mapcolor13||e)});rt=bt.selectAll("path").merge(i),i.on("click",H).on("mouseover",function(t,n,a){if(t.properties){var i=r(e.event,t,n,a);A.call("tooltipShow",this,i)}}).on("mousemove",function(t,n,r){var a=e.event;A.call("tooltipMove",this,a)}).on("mouseout",function(){A.call("tooltipHide",this)})}function H(t){if(at!=e.select(this)&&(B(),b[t.id])){c&&F.cleanup();var n=e.geoCentroid(t),r=C.bounds(t),a=ut/(r[1][0]-r[0][0]),i=dt/(r[1][1]-r[0][1]),o=Math.min(ut*a,dt*i)/2,s=[-n[0],-n[1]];it={rotate:I.rotate(),scale:I.scale()},I.rotate(s).scale(o),ot={rotate:I.rotate(),scale:I.scale()};var l=R(t);l.parent=ft,ft=l,T=ft._total,at=e.select(this),_(b[t.id],"states"),at.style("display","none"),Y()}}function B(){at&&(I.rotate(it.rotate).scale(it.scale),ot={rotate:[null,null],scale:null},ft=ft.parent,T=ft._total,at.style("display","inline"),e.select(".states").remove(),at=!1,Y())}function R(t){return ft._values[t.id]||ft._values[t.properties.name]||{_total:0}}function V(t){return R(t)._total||0}function G(){var t=I.rotate(),e=[10,0],n=[t[0]+e[0]/8,u];W(n)}function W(t){I.rotate(t),Y()}function Y(t){bt.selectAll("path").attr("d",q)}function q(t){return C(t)||"M0,0Z"}var X=this,j=e.select(this),K=e.select("#"+r+" svg").node(),Z=s?s.properties:{},U=s?s.data:null,$=parseInt(j.style("width"),10),J=parseInt(j.style("height"),10),Q=c,tt,et,nt,rt,at=!1,it={rotate:[d,u],scale:1,zoom:1},ot={rotate:[null,null],scale:null,zoom:null},st,lt,ct,ut,dt;if(n.container=this,v=v||function(t,e){return S.colorRadialGradient(t,e,0,0,"35%","35%",w(t,e),mt)},l(U))return n;var ft=U[0],ht=j.selectAll("g.sc-chart-wrap").data([1]),pt=ht.enter().append("g").attr("class","sc-chart-wrap sc-chart-globe"),gt=j.select(".sc-chart-wrap").merge(pt);pt.append("defs");var mt=gt.select("defs");pt.append("svg:rect").attr("class","sc-chart-background").attr("transform",S.translation(a.left,a.top));var vt=gt.select(".sc-chart-background"),yt=pt.append("g").attr("class","sc-globe"),bt=gt.select(".sc-globe");yt.append("path").datum({type:"Sphere"}).attr("class","sphere");var xt=e.select(".sphere");if(m){yt.append("path").datum(L).attr("class","graticule");var wt=e.select(".graticule")}var kt=e.zoom().on("start",f).on("zoom",p).on("end",D);bt.call(kt),xt.on("click",function(){B()}),n.update=function(){j.transition().call(n)},n.resize=function(){var t,e;P(),t=z(I.scale()),e=O(),vt.attr("width",ut).attr("height",dt),I.scale(t).translate(e),Y()},n.render=function(){P(),I.translate(O()).rotate(it.rotate).scale(z(it.scale)),C.projection(I),xt.attr("d",C),m&&wt.attr("d",C),vt.attr("width",ut).attr("height",dt),Y()},n.render(),_(y,"countries"),g&&(st=setInterval(G,10)),A.on("tooltipShow",function(e){c&&(E=t(e,X.parentNode,Z))}),A.on("tooltipMove",function(t){E&&F.position(X.parentNode,E,t,"s")}),A.on("tooltipHide",function(){c&&F.cleanup()}),A.on("changeState",function(t){j.transition().call(n)})}),n}var r=Math.floor(1e4*Math.random()),a={top:0,right:0,bottom:0,left:0},i=null,o=null,s=!1,l="ltr",c=!0,u=0,d=100,f={},h=D(),p=!0,g=!1,m=!0,v=null,y=[],b={},x={},w=function(t,e){return S.defaultColor()(t,e)},k=function(t,e){return"sc-country-"+e},M=w,A=e.dispatch("chartClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState","elementClick","elementDblClick","elementMouseover","elementMouseout"),I=e.geoOrthographic().precision(.1),C=e.geoPath().projection(I),L=e.geoGraticule(),T=0,E=null,N=function(t,n){return"<p><b>"+t.name+"</b></p><p><b>Amount:</b> $"+e.format(",.0f")(t.amount)+"</p>"},P=function(t,e,n){};return n.dispatch=A,n.projection=I,n.path=C,n.graticule=L,n.options=S.optionsFunc.bind(n),n.margin=function(t){if(!arguments.length)return a;for(var e in t)t.hasOwnProperty(e)&&(a[e]=t[e]);return n},n.width=function(t){return arguments.length?(i=t,n):i},n.height=function(t){return arguments.length?(o=t,n):o},n.tooltips=function(t){return arguments.length?(c=t,n):c},n.tooltipContent=function(t){return arguments.length?(N=t,n):N},n.state=function(t){return arguments.length?(f=t,n):f},n.strings=function(t){return arguments.length?(h=D(t),n):h},n.showTitle=function(t){return arguments.length?(s=t,n):s},n.direction=function(t){return arguments.length?(l=t,n):l},n.id=function(t){return arguments.length?(r=t,n):r},n.color=function(t){return arguments.length?(w=t,n):w},n.fill=function(t){return arguments.length?(M=t,n):M},n.classes=function(t){return arguments.length?(k=t,n):k},n.colorData=function(t){var r=arguments[0],a=arguments[1]||{},i=function(t,e){return S.defaultColor()(t,e)},o=function(t,e){return"sc-country-"+e+(t.classes?" "+t.classes:"")};switch(r){case"graduated":i=function(t,n){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(n/a.l)};break;case"class":i=function(){return""},o=function(t,e){var n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-country-"+e+" sc-fill"+n};break;case"data":i=function(t,n){var r=t.amount||0;return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(r/T)}}var s=a.gradient?function(t,e){return n.gradient()(t,e)}:i;return n.color(i),n.classes(o),n.fill(s),n},n.gradient=function(t){return arguments.length?(v=t,n):v},n.showLabels=function(t){return arguments.length?(p=t,n):p},n.autoSpin=function(t){return arguments.length?(g=t,n):g},n.worldMap=function(t){return arguments.length?(y=t,n):y},n.countryMap=function(t){return arguments.length?(b=t,n):b},n.countryLabels=function(t){return arguments.length?(x=t,n):x},n.seriesClick=function(t){return arguments.length?(P=t,n):P},n}function w(){function t(a){return a.each(function(a){function o(t,e){var r=t&&t.length&&t.filter(function(t){return!t.disabled&&Array.isArray(t.values)&&t.values.length}).length,a=(E-n.left-n.right)/2+n.left,i=(N-n.top-n.bottom)/2+n.top;return S.displayNoData(r,b,e||h.noData,a,i)}function s(t){V=t.map(function(t){return t.label}),G=V.length,W=G>0}function l(t,n){var r=n.map(function(t){return e.select(t).datum()}),a=e.max(e.extent(r),function(t){return S.siDecimal(Math.abs(t))}),i=e.max(r,function(t){var n=e.formatPrefix(".2s",a)(t);return S.countSigFigsAfter(n)});return"maxmin"===t&&tt.axis&&(i=Math.max(tt.axis.precision,i)),tt[t]={decimal:a,precision:i},tt[t]}var u=this,b=e.select(this),D="line",L=a?a.properties||{}:{},T=a?a.data||null:null,E=parseInt(b.style("width"),10),N=parseInt(b.style("height"),10),P=r,z=i,O="datetime"===L.xDataType||!1,_="numeric"===L.xDataType||!1,H="currency"===L.yDataType||!1,B=L.groups,R=Array.isArray(B)&&B.length>0,V=[],G=0,W=!1,Y=[],q=0,X=0,j=w.padData()?g:0,K=!1,Z=[{key:"Linear",disabled:"linear"!==w.interpolate()},{key:"Basis",disabled:"basis"!==w.interpolate()},{key:"Monotone",disabled:"monotone"!==w.interpolate()},{key:"Cardinal",disabled:"cardinal"!==w.interpolate()},{key:"Line",disabled:w.isArea()()===!0},{key:"Area",disabled:w.isArea()()===!1}];if(t.update=function(){b.transition().duration(c).call(t)},t.setActiveState=function(t,e){t.active=e,t.values.forEach(function(t){t.active=e})},t.clearActive=function(e){T.forEach(function(n){t.setActiveState(n,e||"")}),delete f.active},t.cellActivate=function(e){var n=T[e.seriesIndex].values[e.pointIndex],r;n&&(r="undefined"==typeof n.active||"inactive"===n.active||""===n.active?"active":"",t.clearActive(),n.active=r)},t.seriesActivate=function(e){var n=e.series||T[e.seriesIndex],r;n&&(r="undefined"==typeof n.active||"inactive"===n.active||""===n.active?"active":"",t.clearActive("active"===r?"inactive":""),t.setActiveState(n,r),f.active=T.map(function(t){return"active"===t.active}))},t.dataSeriesActivate=function(e){var n=e.series||T[e.seriesIndex],r;n&&(r="undefined"==typeof n.active||"inactive"===n.active||""===n.active?"active":"inactive","active"===r?t.seriesActivate(e):t.clearActive())},t.container=this,o(T))return t;if(m=t.locality(),T.forEach(function(t,n){t.seriesIndex=n,t.key=t.key||h.noLabel,t.total=e.sum(t.values,function(t,e){return t.group=R?t.x-1:e,t.y}),t.disabled=t.disabled||0===t.total}),Y=T.filter(function(t){return!t.disabled}).map(function(t,e){return t.seri=e,t}),q=Y.length,o(Y))return t;R?(B.forEach(function(t,e){var n="undefined"==typeof t.label||""===t.label?h.noLabel:O?S.isNumeric(t.label)||-1!==t.label.indexOf("GMT")?new Date(t.label):new Date(t.label+" GMT"):t.label;t.group=e,t.label=n,t.total=0,Y.forEach(function(n,r){n.values.filter(function(t,n){return t.group===e}).forEach(function(e,n){t.total+=e.y})})}),s(B),X=e.sum(B,function(t){return t.total})):(V=e.merge(Y.map(function(t){return t.values})).reduce(function(t,e){return-1===t.indexOf(e.x)&&t.push(e.x),t},[]).map(function(t,e){return O?new Date(t):t}),G=Math.min(Math.ceil(innerWidth/100),V.length),X=e.sum(Y,function(t){return t.total}));var U=75,$=null,J=null,Q=null,tt={axis:null,maxmin:null};O&&($=S.getDateFormatUTC(V)),J=function(t,e,n,r){var a=W?V[e]:t,i=v(t,e,a,O,$);return"no-ellipsis"===r?i:S.stringEllipsify(i,b,U)},Q=function(t,e,n,r){var a=tt[r]||l(r,n);return y(t,e,H,a.precision,a.decimal)},f.disabled=Y.map(function(t){return!!t.disabled}),f.interpolate=w.interpolate(),f.isArea=w.isArea()(),k.chart(t).title(L.title).controlsData(Z).legendData(T),K=1===e.max(Y,function(t){return t.values.length});var et=Math.pow(g,2)*Math.PI*(K?3:1);if(w.xScale(O?e.scaleTime():e.scaleLinear()).singlePoint(K).size(et).sizeRange([et,et]).sizeDomain([et,et]),K){var nt=e.merge(Y.map(function(t){return t.values.map(function(t,e){return w.x()(t,e)})})).reduce(function(t,e){return t.indexOf(e)<0&&t.push(e),t},[]).sort(function(t,e){return t-e}),rt=e.extent(nt),at=1*(O&&!V.length?864e5:1),it=e.merge(Y.map(function(t){return t.values.map(function(t,e){return w.y()(t,e)})})),ot=e.extent(it),st=1===Y.length?2:Math.min((ot[1]-ot[0])/Y.length,ot[0]);w.xDomain([rt[0]-at,rt[1]+at]).yDomain([ot[0]-st,ot[1]+st]),M.orient("bottom").ticks(nt.length).tickValues(nt).highlightZero(!1).showMaxMin(!1),A.orient("left").ticks(K?5:null).highlightZero(!1).showMaxMin(!1)}else w.xDomain(null).yDomain(null),M.orient("bottom").tickValues(W?e.range(1,G+1):null).ticks(W?G:null).highlightZero(!1).showMaxMin(W?!1:!0),A.orient("left").ticks(null).highlightZero(!0).showMaxMin(!0);M.scale(w.xScale()).tickPadding(6).valueFormat(J),A.scale(w.yScale()).tickPadding(6).valueFormat(Q);var lt=b.selectAll("g.sc-chart-wrap").data([Y]),ct=lt.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+D),ut=b.select(".sc-chart-wrap").merge(ct);ct.append("defs"),ct.append("g").attr("class","sc-background-wrap");var dt=ut.select(".sc-background-wrap");ct.append("g").attr("class","sc-title-wrap"),ct.append("g").attr("class","sc-axis-wrap sc-axis-x");var ft=ut.select(".sc-axis-wrap.sc-axis-x");ct.append("g").attr("class","sc-axis-wrap sc-axis-y");var ht=ut.select(".sc-axis-wrap.sc-axis-y");ct.append("g").attr("class","sc-"+D+"-wrap");var pt=ut.select(".sc-"+D+"-wrap");ct.append("g").attr("class","sc-controls-wrap"),ct.append("g").attr("class","sc-legend-wrap"),ut.attr("transform",S.translation(n.left,n.top)),ct.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){function e(t){return"width"===t?g:"height"===t?m:0}function a(){C=M.margin(),I=A.margin(),p.left=Math.max(C.left,I.left),p.right=Math.max(C.right,I.right),p.top=Math.max(C.top,I.top),p.bottom=Math.max(C.bottom,I.bottom),s()}function s(){g=P-p.left-p.right,m=z-v-p.top-p.bottom,w.resetDimensions(e("width"),e("height"))}function l(){A.tickSize(j-g,0).margin(p),ht.call(A),a()}function u(){M.tickSize(j-m,0).margin(p),ft.call(M),a()}var d,f,p,g,m,v,y=0,x=0;if(E=parseInt(b.style("width"),10),N=parseInt(b.style("height"),10),d=r||E||960,f=i||N||400,P=d-n.left-n.right,z=f-n.top-n.bottom,p={top:0,right:0,bottom:0,left:0},g=P-p.left-p.right,m=z-p.top-p.bottom,dt.select(".sc-background").attr("width",d).attr("height",f),U=Math.max(.2*P,75),k.width(P).height(z),b.call(k),v=k.getHeight(),p.top+=v,m=z-p.top-p.bottom,100>m)return o(null,h.displayError),t;w.width(e("width")).height(e("height")),pt.datum(Y).call(w);var I={top:0,right:0,bottom:0,left:0},C={top:0,right:0,bottom:0,left:0};l(),u(),l(),u(),l(),pt.transition().duration(c).call(w),p.top+=v,y=p.left,x=p.top+("bottom"===M.orient()?m:0),ft.attr("transform",S.translation(y,x)),y=p.left+("left"===A.orient()?0:g),x=p.top,ht.attr("transform",S.translation(y,x)),pt.attr("transform",S.translation(p.left,p.top))},t.render(),k.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,T.filter(function(t){return!t.disabled}).length||T.forEach(function(t){t.disabled=!1}),f.disabled=T.map(function(t){return!!t.disabled}),e.active="inactive",e.values.forEach(function(t){t.active="inactive"}),T.filter(function(t){return"active"===t.active}).length||t.clearActive(),f.active=T.map(function(t){return!!t.active}),t.update(),p.call("stateChange",this,f)}),k.controls.dispatch.on("legendClick",function(e,n){if(e.disabled){switch(Z.forEach(function(t){t.disabled=!0}),e.disabled=!1,e.key){case"Basis":w.interpolate("basis");break;case"Linear":w.interpolate("linear");break;case"Monotone":w.interpolate("monotone");break;case"Cardinal":w.interpolate("cardinal");break;case"Line":w.isArea(!1);break;case"Area":w.isArea(!0)}f.interpolate=w.interpolate(),f.isArea=w.isArea(),t.update(),p.call("stateChange",this,f)}}),p.on("tooltipShow",function(t){d&&(W&&(t.group=B[t.groupIndex]),I=C(t,u.parentNode,L))}),p.on("tooltipMove",function(t){I&&F.position(u.parentNode,I,t,"s")}),p.on("tooltipHide",function(){d&&F.cleanup()}),p.on("changeState",function(e){"undefined"!=typeof e.disabled&&(T.forEach(function(t,n){t.disabled=e.disabled[n]}),f.disabled=e.disabled),"undefined"!=typeof e.interpolate&&(w.interpolate(e.interpolate),f.interpolate=e.interpolate),"undefined"!=typeof e.isArea&&(w.isArea(e.isArea),f.isArea=e.isArea),t.update()}),p.on("chartClick",function(){k.controls.enabled()&&k.controls.dispatch.call("closeMenu",this),k.legend.enabled()&&k.legend.dispatch.call("closeMenu",this)}),w.dispatch.on("elementClick",function(e){W&&e.groupIndex&&(e.group=B[e.groupIndex]),p.call("chartClick",this),w.dispatch.call("elementMouseout",this,e),x(T,e,t,V)}),b.on("click",function(){e.event.stopPropagation(),p.call("chartClick",this)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,i=null,o="ltr",s=0,c=0,d=!0,f={},h=D(),p=e.dispatch("chartClick","elementClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),g=3,m={},v=function(t,e,n,r,a){var i=n||t,o;return r?(o=a&&0===a.indexOf("%")?a:"%x",S.dateFormat(i,o,m)):i},y=function(t,e,n,r,a){return S.numberFormatSIFixed(t,r,n,m,a)},b=function(t,e){var n=t.group||{},r=t.point.x,a=t.point.y,i="datetime"===e.xDataType,o="currency"===e.yDataType,s={seriesName:e.seriesName||h.tooltip.key,seriesLabel:t.series.key,groupName:e.groupName||(i?h.tooltip.date:h.tooltip.group),groupLabel:v(r,t.pointIndex,n.label,i,"%x"),valueName:o?h.tooltip.amount:h.tooltip.count,valueLabel:S.numberFormat(a,null,o,m)},l;return t.group&&S.isNumeric(t.group._height)&&(l=Math.abs(100*a/t.group._height).toFixed(1),s.percent=S.numberFormat(l,2,!1,m)),F.multi(s,h)},x=function(t,e,n,r){},w=u(),k=l(),M=a(),A=a(),I=null,C=function(t,e,n){var r=b(t,n),a=t.value<0?"n":"s";return F.show(t.e,r,a,null,e)};return w.clipEdge(!0),k.showTitle(!0).showControls(!0).showLegend(!0),w.dispatch.on("elementMouseover.tooltip",function(t){p.call("tooltipShow",this,t)}),w.dispatch.on("elementMousemove.tooltip",function(t){p.call("tooltipMove",this,t)}),w.dispatch.on("elementMouseout.tooltip",function(t){p.call("tooltipHide",this,t)}),t.dispatch=p,t.lines=w,t.legend=k.legend,t.controls=k.controls,t.xAxis=M,t.xAxisLabel=M.axisLabel,t.yAxis=A,t.yAxisLabel=A.axisLabel,t.options=S.optionsFunc.bind(t),S.rebind(t,w,"id","x","y","xScale","yScale","xDomain","yDomain","forceX","forceY","clipEdge","color","fill","classes","gradient","locality"),S.rebind(t,w,"defined","isArea","interpolate","size","clipVoronoi","useVoronoi","interactive","nice"),S.rebind(t,k,"showTitle","showControls","showLegend"),S.rebind(t,M,"rotateTicks","reduceXTicks","staggerTicks","wrapTicks"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t){return S.defaultColor()(t,t.seriesIndex)},o=function(t){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t){var e=t.seriesIndex,n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+e+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t){return S.defaultColor()(t,t.seriesIndex)},o=function(t){var e=t.seriesIndex;return"sc-series sc-series-"+e+(t.classes?" "+t.classes:"")}}return w.color(i),w.fill(i),w.classes(o),k.legend.color(i),k.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(i=e,t):i},t.tooltips=function(e){return arguments.length?(d=e,t):d},t.tooltipContent=function(e){return arguments.length?(b=e,t):b},t.state=function(e){return arguments.length?(f=e,p.call("stateChange",this,f),t):f},t.strings=function(e){return arguments.length?(h=D(e),k.strings(h),t):h},t.direction=function(e){return arguments.length?(o=e,w.direction(e),M.direction(e),A.direction(e),k.direction(e),t):o},t.duration=function(e){return arguments.length?(c=e,w.duration(e),t):c},t.delay=function(e){return arguments.length?(s=e,w.delay(e),t):s},t.xValueFormat=function(e){return arguments.length?(v=e,t):v},t.yValueFormat=function(e){return arguments.length?(y=e,t):y},t.seriesClick=function(e){return arguments.length?(x=e,t):x},t.pointRadius=function(e){return arguments.length?(g=e,t):g},t}function k(){function t(a){return a.each(function(a){function o(t,e){var r=t&&t.length&&t.filter(function(t){return!t.disabled&&Array.isArray(t.values)&&t.values.length}).length,a=(V-n.left-n.right)/2+n.left,i=(G-n.top-n.bottom)/2+n.top;return S.displayNoData(r,A,e||p.noData,a,i)}function s(t,e){var n={x:t.x,y:t.y};return"undefined"!=typeof t.label&&(n.label=t.label),t.active&&(n.active=t.active),n}function l(t){U=t.map(function(t){return t.label}),$=U.length,J=$>0}function d(t,n){var r=n.map(function(t){return e.select(t).datum()}),a=e.max(e.extent(r),function(t){return S.siDecimal(Math.abs(t))}),i=e.max(r,function(t){var n=e.formatPrefix(".2s",a)(t);return S.countSigFigsAfter(n)});return"maxmin"===t&&ft.axis&&(i=Math.max(ft.axis.precision,i)),ft[t]={decimal:a,precision:i},ft[t]}var h=this,A=e.select(this),D=m?"multibar":"multibar-horizontal",B=a?a.properties||{}:{},R=a?a.data||null:null,V=parseInt(A.style("width"),10),G=parseInt(A.style("height"),10),W=r,Y=i,q="datetime"===B.xDataType||!1,X="numeric"===B.xDataType||!1,j="currency"===B.yDataType||!1,K=B.groups,Z=Array.isArray(K)&&K.length>0,U=[],$=0,J=!1,Q=!1,tt=[],et=0,nt=0,rt=C.stacked()&&m?72:32,at=[{key:"Grouped",disabled:C.stacked()},{key:"Stacked",disabled:!C.stacked()}];if(t.update=function(){A.transition().duration(c).call(t)},t.setActiveState=function(t,e){t.active=e,t.values.forEach(function(t){t.active=e})},t.clearActive=function(e){R.forEach(function(n){t.setActiveState(n,e||"")}),delete f.active},t.cellActivate=function(e){var n=R[e.seriesIndex].values[e.pointIndex],r;n&&(r="undefined"==typeof n.active||"inactive"===n.active||""===n.active?"active":"",t.clearActive(),n.active=r)},t.seriesActivate=function(e){var n=e.series||R[e.seriesIndex],r;n&&(r="undefined"==typeof n.active||"inactive"===n.active||""===n.active?"active":"",t.clearActive("active"===r?"inactive":""),t.setActiveState(n,r),f.active=R.map(function(t){return"active"===t.active}))},t.dataSeriesActivate=function(e){var n=e.series||R[e.seriesIndex],r;n&&(r="undefined"==typeof n.active||"inactive"===n.active||""===n.active?"active":"inactive","active"===r?t.seriesActivate(e):t.clearActive())},t.container=this,o(R))return t;if(x=t.locality(),R.forEach(function(t,n){t._values||(t._values=t.values.map(s)),t.seriesIndex=n,t.key=t.key||p.noLabel,t.total=e.sum(t._values,function(t,e){return t.y}),t.disabled=t.disabled||0===t.total}),tt=R.filter(function(t){return!t.disabled}).map(function(t,e){return t.seri=e,t.values=t._values.map(function(e,n){var r=s(e,n);return r.groupIndex=q||X?n:e.x-1,r.seriesIndex=t.seriesIndex,r.seri=t.seri,r.color=t.color||"",r}),t}),et=tt.length,o(tt))return t;if(Z?K.forEach(function(t,e){var n="undefined"==typeof t.label||""===t.label?p.noLabel:q?S.isNumeric(t.label)||-1!==t.label.indexOf("GMT")?new Date(t.label):new Date(t.label+" GMT"):t.label;t.group=e,t.label=n,t.total=0,t._height=0}):K=tt[0].values.map(function(t,e){return{group:e,label:q?new Date(t.x):t.x,total:0,_height:0}}),l(K),Q=T.areValuesDiscrete(tt,K,C.x(),C.y()),K.forEach(function(t,e){var n=0,r=0;tt.forEach(function(a,i){a.values.filter(function(t,n){return t.groupIndex===e}).forEach(function(e,a){e.size=Math.abs(e.y),t._height+=e.size,t.total+=e.y,e.y<0?(e.y0=(Q?0:r)-(m?0:e.size),r-=e.size):(e.y0=(Q?0:n)+(m?e.size:0),n+=e.size)})}),t.neg={label:M(r),y:r},t.pos={label:M(n),y:n}}),y&&(l(K.filter(function(t,e){return 0!==t._height})),tt.forEach(function(t,e){return t.values=t.values.filter(function(t,e){return 0!==K[t.groupIndex]._height}).map(function(t,e){return t}),t}),o(tt)))return t;nt=e.sum(K,function(t){return t.total});var it=75,ot=null,st=null,lt=null,ct=null,ut=0,dt=0===e.max(e.merge(tt.map(function(t){return t.values.map(function(t){var e=C.y()(t);return S.countSigFigsAfter(e)})})));dt&&(ut=e.max(K,function(t){return t.total}));var ft={axis:null,maxmin:null};q&&(ot=S.getDateFormatUTC(U)),st=function(t,e,n,r){var a=J?U[e]:t,i=w(t,e,a,q,ot);return"no-ellipsis"===r?i:S.stringEllipsify(i,A,it)},lt=function(t,e,n,r){var a=ft[r]||d(r,n);return k(t,e,j,a.precision,a.decimal)},ct=function(t,e,n){return M(t,e,n,j)},f.disabled=tt.map(function(t){return!!t.disabled}),f.active=tt.map(function(t){return"active"===t.active}),f.stacked=C.stacked(),L.chart(t).title(B.title).controlsData(at).legendData(R),C.valueFormat(ct),E.orient(m?"bottom":"left").scale(C.xScale()).valueFormat(st).tickSize(0).tickPadding(4).highlightZero(!1).showMaxMin(!1),N.orient(m?"left":"bottom").scale(C.yScale()).valueFormat(lt).tickPadding(4).showMaxMin(!0);var ht=A.selectAll("g.sc-chart-wrap").data([tt]),pt=ht.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+D),gt=A.select(".sc-chart-wrap").merge(pt);pt.append("defs");var mt=gt.select("defs");pt.append("g").attr("class","sc-background-wrap");var vt=gt.select(".sc-background-wrap");pt.append("g").attr("class","sc-title-wrap"),pt.append("g").attr("class","sc-axis-wrap sc-axis-y");var yt=gt.select(".sc-axis-wrap.sc-axis-y");pt.append("g").attr("class","sc-scroll-wrap");var bt=gt.select(".sc-scroll-wrap");pt.select(".sc-scroll-wrap").append("g").attr("class","sc-axis-wrap sc-axis-x");var xt=gt.select(".sc-axis-wrap.sc-axis-x");pt.select(".sc-scroll-wrap").append("g").attr("class","sc-bars-wrap");var wt=gt.select(".sc-bars-wrap");pt.append("g").attr("class","sc-controls-wrap"),pt.append("g").attr("class","sc-legend-wrap"),gt.attr("transform",S.translation(n.left,n.top)),v?O(gt,pt,bt,E):pt.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){function e(t){return"width"===t?m&&v?Math.max(x,T):x:"height"===t?!m&&v?Math.max(w,T):w:0}function a(){H=E.margin(),_=N.margin(),y.left=Math.max(H.left,_.left),y.right=Math.max(H.right,_.right),y.top=Math.max(H.top,_.top),y.bottom=Math.max(H.bottom,_.bottom),s()}function s(){x=W-y.left-y.right,w=Y-k-y.top-y.bottom,C.resetDimensions(e("width"),e("height"))}function l(){N.ticks(dt&&10>ut?ut:w/48).tickSize(m?-x:-w,0).margin(y),yt.call(N),a()}function u(){E.tickSize(0).margin(y),xt.call(E),a()}var d,h,y,x,w,k,M=0,I=0;if(V=parseInt(A.style("width"),10),G=parseInt(A.style("height"),10),d=r||V||960,h=i||G||400,W=d-n.left-n.right,Y=h-n.top-n.bottom,y={top:0,right:0,bottom:0,left:0},x=W-y.left-y.right,w=Y-y.top-y.bottom,vt.select(".sc-background").attr("width",d).attr("height",h),L.width(W).height(Y),A.call(L),k=L.getHeight(),y.top+=k,w=Y-y.top-y.bottom,100>w)return o(null,p.displayError),t;var F=f.stacked?rt:rt*et+rt,D=rt*(f.stacked?.25:1),T=$*F+D;it=Math.max(m?2*rt:.2*W,75),C.vertical(m).baseDimension(rt).disabled(R.map(function(t){return t.disabled})).width(e("width")).height(e("height")),wt.datum(tt).call(C);var _={top:0,right:0,bottom:0,left:0},H={top:0,right:0,bottom:0,left:0};if(l(),u(),l(),u(),l(),wt.transition().duration(c).call(C),y.top+=k,M=m||"left"===E.orient()?0:x,I=m&&"bottom"===E.orient()?w+2:-2,xt.attr("transform",S.translation(M,I)),M=y.left+(m||"bottom"===N.orient()?0:x),I=y.top+(m||"left"===N.orient()?0:w),yt.attr("transform",S.translation(M,I)),bt.attr("transform",S.translation(y.left,y.top)),v){P=T>(m?x:w),xt.select(".sc-axislabel").attr("x",(m?x:-w)/2);var B=(m?x:w)-T,q=function(){var t;g.call("tooltipHide",this),z=O.pan(B),t=m?x-2*z:2*z-w,t/=2,xt.select(".sc-axislabel").attr("x",t)};O.enable(P).width(x).height(w).margin(y).minDimension(T).vertical(m).panHandler(q).resize(z,b),O.panHandler()()}},t.render(),L.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,R.filter(function(t){return!t.disabled}).length||R.forEach(function(t){t.disabled=!1}),f.disabled=R.map(function(t){return!!t.disabled}),e.active="inactive",e.values.forEach(function(t){t.active="inactive"}),R.filter(function(t){return"active"===t.active}).length||t.clearActive(),f.active=R.map(function(t){return!!t.active}),t.update(),g.call("stateChange",this,f)}),L.controls.dispatch.on("legendClick",function(e,n){e.disabled&&(at.forEach(function(t){t.disabled=!0}),e.disabled=!1,C.stacked("Grouped"===e.key?!1:!0),f.stacked=C.stacked(),t.update(),g.call("stateChange",this,f))}),g.on("tooltipShow",function(t){u&&(J&&(t.group=K[t.groupIndex]),_=H(t,h.parentNode,B))}),g.on("tooltipMove",function(t){_&&F.position(h.parentNode,_,t,m?"s":"w")}),g.on("tooltipHide",function(){u&&F.cleanup()}),g.on("changeState",function(e){"undefined"!=typeof e.disabled&&(R.forEach(function(t,n){t.disabled=e.disabled[n]}),f.disabled=e.disabled),"undefined"!=typeof e.active&&(R.forEach(function(t,n){t.active=e.active[n]?"active":"inactive",t.values.forEach(function(e){e.active=t.active})}),f.active=e.active,R.filter(function(t){return"active"===t.active}).length||t.clearActive()),"undefined"!=typeof e.stacked&&(C.stacked(e.stacked),f.stacked=e.stacked),t.update()}),g.on("chartClick",function(){L.controls.enabled()&&L.controls.dispatch.call("closeMenu",this),L.legend.enabled()&&L.legend.dispatch.call("closeMenu",this)}),C.dispatch.on("elementClick",function(e){J&&e.groupIndex&&(e.group=K[e.groupIndex]),g.call("chartClick",this),I(R,e,t,U)}),A.on("click",function(){e.event.stopPropagation(),g.call("chartClick",this)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,i=null,o="ltr",s=0,c=0,u=!0,f={},p=D(),g=e.dispatch("chartClick","elementClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),m=!0,v=!0,y=!0,b=function(t){},x={},w=function(t,e,n,r,a){var i=n||t,o;return r?(o=a&&0===a.indexOf("%")?a:"%x",S.dateFormat(i,o,x)):i},k=function(t,e,n,r,a){return S.numberFormatSIFixed(t,r,n,x,a)},M=function(t,e,n,r){return n||S.numberFormatSI(t,0,r,x)},A=function(t,e){var n=t.group||{},r=t.point.x,a=t.point.y,i="datetime"===e.xDataType,o="currency"===e.yDataType,s={seriesName:e.seriesName||p.tooltip.key,seriesLabel:t.series.key,groupName:e.groupName||(i?p.tooltip.date:p.tooltip.group),groupLabel:w(r,t.pointIndex,n.label,i,"%x"),valueName:o?p.tooltip.amount:p.tooltip.count,valueLabel:S.numberFormat(a,null,o,x)},l;return t.group&&S.isNumeric(t.group._height)&&(l=Math.abs(100*a/t.group._height).toFixed(1),s.percent=S.numberFormat(l,2,!1,x)),F.multi(s,p)},I=function(t,e,n,r){},C=d(),L=l(),E=a(),N=a(),P=!1,z=0,O=h().id(C.id()),_=null,H=function(t,e,n){var r=A(t,n),a=t.value<0?m?"n":"e":m?"s":"w";return F.show(t.e,r,a,null,e)};return L.showTitle(!0).showControls(!0).showLegend(!0),C.dispatch.on("elementMouseover.tooltip",function(t){g.call("tooltipShow",this,t)}),C.dispatch.on("elementMousemove.tooltip",function(t){g.call("tooltipMove",this,t)}),C.dispatch.on("elementMouseout.tooltip",function(t){g.call("tooltipHide",this,t)}),t.dispatch=g,t.multibar=C,t.legend=L.legend,t.controls=L.controls,t.xAxis=E,t.xAxisLabel=E.axisLabel,t.yAxis=N,t.yAxisLabel=N.axisLabel,t.options=S.optionsFunc.bind(t),S.rebind(t,C,"id","x","y","xScale","yScale","xDomain","yDomain","forceX","forceY","clipEdge","color","fill","classes","gradient","locality"),S.rebind(t,C,"stacked","showValues","nice","textureFill"),S.rebind(t,L,"showTitle","showControls","showLegend"),S.rebind(t,E,"rotateTicks","reduceXTicks","staggerTicks","wrapTicks"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t){
return S.defaultColor()(t,t.seriesIndex)},o=function(t){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t){var e=t.seriesIndex,n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+e+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t){return S.defaultColor()(t,t.seriesIndex)},o=function(t){return"sc-series sc-series-"+t.seriesIndex+(t.classes?" "+t.classes:"")}}var s=a.gradient?function(t){var e={orientation:a.orientation||(m?"vertical":"horizontal"),position:a.position||"middle"};return C.gradientFill(t,t.seriesIndex,e)}:i;return C.color(i),C.fill(s),C.classes(o),L.legend.color(i),L.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(i=e,t):i},t.tooltips=function(e){return arguments.length?(u=e,t):u},t.tooltipContent=function(e){return arguments.length?(A=e,t):A},t.state=function(e){return arguments.length?(f=e,g.call("stateChange",this,f),t):f},t.strings=function(e){return arguments.length?(p=D(e),L.strings(p),t):p},t.direction=function(e){return arguments.length?(o=e,C.direction(e),E.direction(e),N.direction(e),L.direction(e),t):o},t.duration=function(e){return arguments.length?(c=e,C.duration(e),t):c},t.delay=function(e){return arguments.length?(s=e,C.delay(e),t):s},t.valueFormat=function(e){return arguments.length?(M=e,t):M},t.xValueFormat=function(e){return arguments.length?(w=e,t):w},t.yValueFormat=function(e){return arguments.length?(k=e,t):k},t.seriesClick=function(e){return arguments.length?(I=e,t):I},t.vertical=function(e){return arguments.length?(m=e,t):m},t.allowScroll=function(e){return arguments.length?(v=e,t):v},t.hideEmptyGroups=function(e){return arguments.length?(y=e,t):y},t.overflowHandler=function(e){return arguments.length?(b=S.functor(e),t):b},t}function M(){function t(n){return n.each(function(n){function a(t,e){var n=t&&t.length&&t.filter(function(t){return!t.disabled&&Array.isArray(t.values)&&t.values.length}).length,a=(m-r.left-r.right)/2+r.left,i=(w-r.top-r.bottom)/2+r.top;return S.displayNoData(n,u,e||y.noData,a,i)}var s=this,u=e.select(this),d="pareto",p=n?n.properties||{}:{},g=n?n.data||null:null,m=parseInt(u.style("width"),10),w=parseInt(u.style("height"),10),D=Math.pow(6,2)*Math.PI,_="datetime"===p.xDataType||!1,H="currency"===p.yDataType||!1,B=C.stacked()?72:32,W=function(t,e,n,r){var a=U&&Array.isArray(U)?U[e]||t:t,i=M(t,e,a,_),o=Math.max(2*B,75);return r?i:S.stringEllipsify(i,u,o)},Y=function(t,e,n,r){return A(t,e,null,H)},q,X;if(t.update=function(){u.transition().call(t)},t.container=this,a(g))return t;t.dataSeriesActivate=function(e){var n=e.series;n.active=n.active&&"inactive"!==n.active?"inactive":"active",n.values.map(function(t){t.active=n.active}),"active"===n.active&&g.filter(function(t){return"active"!==t.active}).map(function(t){return t.active="inactive",t.values.map(function(t){t.active="inactive"}),t}),g.filter(function(t){return"active"===t.active}).length||g.map(function(t){return t.active="",t.values.map(function(t){t.active=""}),u.selectAll(".sc-series").classed("sc-inactive",!1),t}),u.call(t)},g.forEach(function(t,e){t._values||(t._values=t.values.map(function(t,e){return{x:Array.isArray(t)?t[0]:t.x,y:Array.isArray(t)?t[1]:t.y}}))});var j=g.filter(function(t){return!t.type||"bar"===t.type}).map(function(t,n){return t.seriesIndex=n,t.values=t._values.map(function(e,r){return{group:r,seriesIndex:t.seriesIndex,color:"undefined"!=typeof t.color?t.color:"",x:C.x()(e,r),y:C.y()(e,r),y0:e.y+(n>0?g[t.seriesIndex-1].values[r].y0:0),active:"undefined"!=typeof t.active?t.active:""}}),t.key=t.key||y.noLabel,t.total=e.sum(t._values,function(t,e){return t.y}),t.disabled=t.disabled||0===t.total,t}).filter(function(t){return!t.disabled}).map(function(t,e){return t.seri=e,t.values.forEach(function(e,n){e.seri=t.seri}),t});if(a(j))return t;var K=g.filter(function(t){return"line"===t.type}).map(function(t,e){return t.seriesIndex=e,C.stacked()?(t.values.forEach(function(t){t.y=0}),j.map(function(e){e.values.map(function(e,n){t.values[n].y+=C.y()(e,n)})}),t.values.forEach(function(e,n){n>0&&(e.y+=t.values[n-1].y)})):t.values=t._values.map(function(e,n){return{seriesIndex:t.seriesIndex,color:"undefined"!=typeof t.color?t.color:"",x:T.x()(e,n)+.25*(t.seriesIndex-n),y:T.y()(e,n)}}),t}).filter(function(t){return!t.disabled}).map(function(t,e){return t.seri=e,t.values.forEach(function(e,n){e.seri=t.seri}),t}),Z=p.groupData,U=Z.map(function(t){return[].concat(t.l)[0]||y.noLabel}),$=p.quota||0,J=p.quotaLabel||"",Q=p.targetQuota||0,tt=p.targetQuotaLabel||"",et=g.filter(function(t){return!t.type||"bar"===t.type}),nt=g.filter(function(t){return"line"===t.type});nt.push({key:J,type:"dash",color:"#444",seriesIndex:nt.length,values:{seriesIndex:nt.length,x:0,y:0}}),Q>0&&nt.push({key:tt,type:"dash",color:"#777",seriesIndex:nt.length,values:{seriesIndex:nt.length+1,x:0,y:0}});var rt=g.filter(function(t){return!t.disabled}).map(function(t){return t._values.map(function(t,e){return b(t,e)})}),at=g.map(function(t){return t._values.map(function(t,e){return x(t,e)})});l=l&&p.title&&p.title.length,q=C.xScale(),X=C.yScale(),E.orient("bottom").scale(q).valueFormat(W).tickSize(0).tickPadding(4).highlightZero(!1).showMaxMin(!1),N.orient("left").scale(X).valueFormat(Y).tickPadding(7).showMaxMin(!0),t.render=function(){function n(){A.left=Math.max(bt,vt.left,yt.left),A.right=Math.max(vt.right,yt.right),A.top=Math.max(vt.top,yt.top)+G,A.bottom=Math.max(vt.bottom,yt.bottom),a()}function a(){F=x-A.left-A.right,_=M-A.top-A.bottom,C.resetDimensions(F,_)}m=parseInt(u.style("width"),10),w=parseInt(u.style("height"),10);var v,b,x,M,A,F,_;v=i||m||960,b=o||w||400,x=v-r.left-r.right,M=b-r.top-r.bottom,A={top:0,right:0,bottom:0,left:0},_=M-A.top-A.bottom,F=x-A.left-A.right;var H=0,B=0,R=0,G=0,W={width:0,height:0},Y=u.selectAll("g.sc-chart-wrap").data([g]),Z=Y.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+d),U=u.select(".sc-chart-wrap").merge(Z);Z.append("defs"),Z.append("g").attr("class","sc-background-wrap");var rt=U.select(".sc-background-wrap");Z.append("g").attr("class","sc-title-wrap");var it=U.select(".sc-title-wrap");Z.append("g").attr("class","sc-axis-wrap sc-axis-x");var ot=U.select(".sc-axis-wrap.sc-axis-x");Z.append("g").attr("class","sc-axis-wrap sc-axis-y");var st=U.select(".sc-axis-wrap.sc-axis-y");Z.append("g").attr("class","sc-bars-wrap");var lt=U.select(".sc-bars-wrap");Z.append("g").attr("class","sc-quota-wrap");var ct=U.select(".sc-quota-wrap");Z.append("g").attr("class","sc-lines-wrap1");var ut=U.select(".sc-lines-wrap1");Z.append("g").attr("class","sc-lines-wrap2");var dt=U.select(".sc-lines-wrap2");Z.append("g").attr("class","sc-legend-wrap sc-bar-legend");var ft=U.select(".sc-legend-wrap.sc-bar-legend");Z.append("g").attr("class","sc-legend-wrap sc-line-legend");var ht=U.select(".sc-legend-wrap.sc-line-legend");U.attr("transform",S.translation(r.left,r.top)),Z.select(".sc-background-wrap").append("rect").attr("x",-r.left).attr("y",-r.top).attr("width",v).attr("height",b).attr("fill","#FFF"),it.select(".sc-title").remove(),l&&(it.append("text").attr("class","sc-title").attr("x","rtl"===f?x:0).attr("y",0).attr("dy",".75em").attr("text-anchor","start").attr("stroke","none").attr("fill","black").text(p.title),W=S.getTextBBox(it.select(".sc-title")),G+=W.height),c&&(P.id("barlegend_"+t.id()).strings(y.barLegend).align("left").height(M-A.top),ft.datum(et).call(P),H=P.calcMaxWidth(),z.id("linelegend_"+t.id()).strings(y.lineLegend).align("right").height(M-A.top),ht.datum(nt).call(z),B=z.calcMaxWidth(),R=x/(H+B),P.arrange(Math.floor(R*H)),z.arrange(Math.floor(R*B)),ft.attr("transform","translate("+("rtl"===f?x-P.width():0)+","+A.top+")"),ht.attr("transform","translate("+("rtl"===f?0:x-z.width())+","+A.top+")")),G+=Math.max(P.height(),z.height())+4,_=M-G-A.top-A.bottom;var pt=Math.max(e.max(e.merge(at)),$,Q||0),gt=[0,10*Math.ceil(.1*pt)];C.width(F).height(_).forceY(gt).id(t.id()),lt.datum(j).call(C);var mt=q(1)+q.bandwidth()/(C.stacked()||1===K.length?2:4);L.margin({top:0,right:mt,bottom:0,left:mt}).width(F).height(_).forceY(gt).useVoronoi(!1).id("outline_"+t.id()),T.margin({top:0,right:mt,bottom:0,left:mt}).width(F).height(_).forceY(gt).useVoronoi(!1).size(D).sizeRange([D,D]).sizeDomain([D,D]).id("foreground_"+t.id()),ut.datum(K).call(L),dt.datum(K).call(T),ot.call(E),st.style("opacity",j.length?1:0).call(N);var vt=E.margin(),yt=N.margin(),bt=0,xt=14;ct.selectAll("line").remove(),st.selectAll("text.sc-quota-value").remove(),st.selectAll("text.sc-target-quota-value").remove(),Q>0&&(ct.append("line").attr("class","sc-quota-target").attr("x1",0).attr("y1",0).attr("x2",F).attr("y2",0).attr("transform","translate(0,"+X(Q)+")").style("stroke-dasharray","8, 8"),ct.append("line").datum({key:tt,val:Q}).attr("class","sc-quota-target sc-quota-background").attr("x1",0).attr("y1",0).attr("x2",F).attr("y2",0).attr("transform","translate(0,"+X(Q)+")"),st.append("text").text(I(Q,2,!0)).attr("class","sc-target-quota-value").attr("dy",".36em").attr("dx","0").attr("text-anchor","rtl"===f?"start":"end").attr("transform","translate("+(0-N.tickPadding())+","+X(Q)+")"),bt=Math.round(U.select("text.sc-target-quota-value").node().getBoundingClientRect().width+N.tickPadding())),$>0&&(ct.append("line").attr("class","sc-quota-line").attr("x1",0).attr("y1",0).attr("x2",F).attr("y2",0).attr("transform","translate(0,"+X($)+")").style("stroke-dasharray","8, 8"),ct.append("line").datum({key:J,val:$}).attr("class","sc-quota-line sc-quota-background").attr("x1",0).attr("y1",0).attr("x2",F).attr("y2",0).attr("transform","translate(0,"+X($)+")"),st.append("text").text(I($,2,!0)).attr("class","sc-quota-value").attr("dy",".36em").attr("dx","0").attr("text-anchor","rtl"===f?"start":"end").attr("transform","translate("+-N.tickPadding()+","+X($)+")"),bt=Math.max(bt,Math.round(U.select("text.sc-quota-value").node().getBoundingClientRect().width+N.tickPadding()))),n(),C.width(F).height(_),lt.call(C),ot.call(E),st.call(N),mt=q(1)+q.bandwidth()/(C.stacked()?2:2*K.length),vt=E.margin(),yt=N.margin(),n();var wt=S.translation(A.left,A.top);C.width(F).height(_),lt.attr("transform",wt).call(C),L.margin({top:0,right:mt,bottom:0,left:mt}).width(F).height(_),T.margin({top:0,right:mt,bottom:0,left:mt}).width(F).height(_),ut.attr("transform",wt).call(L),dt.attr("transform",wt).call(T),ct.attr("transform",wt).selectAll("line").attr("x2",F),ot.attr("transform","translate("+A.left+","+("bottom"===E.orient()?_+A.top:A.top)+")").call(E),N.ticks(Math.ceil(_/48)).tickSize(-F,0),st.attr("transform","translate("+("left"===N.orient()?A.left:A.left+F)+","+A.top+")").call(N),Q>0&&(ct.selectAll("line.sc-quota-target").attr("x2",F).attr("transform","translate(0,"+X(Q)+")"),st.select("text.sc-target-quota-value").attr("transform","translate("+(0-N.tickPadding())+","+X(Q)+")"),xt=Math.round(parseInt(U.select("text.sc-target-quota-value").node().getBoundingClientRect().height,10)/1.15),st.selectAll("g.tick, g.sc-axisMaxMin").each(function(t,n){Math.abs(X(t)-X(Q))<=xt&&e.select(this).style("opacity",0)})),$>0&&(ct.selectAll("line.sc-quota-line").attr("x2",F).attr("transform","translate(0,"+X($)+")"),st.select("text.sc-quota-value").attr("transform","translate("+(0-N.tickPadding())+","+X($)+")"),xt=Math.round(parseInt(U.select("text.sc-quota-value").node().getBoundingClientRect().height,10)/1.15),st.selectAll("g.tick, g.sc-axisMaxMin").each(function(t,n){Math.abs(X(t)-X($))<=xt&&e.select(this).style("opacity",0)}),Q>0&&Math.abs(X($)-X(Q))<=xt&&st.select(".sc-target-quota-value").style("opacity",0)),ct.selectAll("line.sc-quota-background").on("mouseover",function(t){if(h){var n={val:t.val,key:t.key,e:e.event};O=V(n,s.parentNode)}}).on("mousemove",function(){var t=e.event;k.call("tooltipMove",this,t)}).on("mouseout",function(){k.call("tooltipHide",this)})},t.render(),P.dispatch.on("legendClick",function(e,n){var r=e.seriesIndex;e.disabled=!e.disabled,t.stacked()||g.filter(function(t){return t.seriesIndex===r&&"line"===t.type}).map(function(t){return t.disabled=!t.disabled,t}),g.filter(function(t){return!t.disabled&&"bar"===t.type}).length||g.map(function(t){return t.disabled=!1,t}),u.call(t)}),k.on("tooltipShow",function(t){h&&(O=R(t,s.parentNode,Z))}),k.on("tooltipMove",function(t){O&&F.position(s.parentNode,O,t,"s")}),k.on("tooltipHide",function(){h&&F.cleanup()}),k.on("changeState",function(e){"undefined"!=typeof e.disabled&&(g.forEach(function(t,n){t.disabled=e.disabled[n]}),v.disabled=e.disabled),"undefined"!=typeof e.stacked&&(C.stacked(e.stacked),v.stacked=e.stacked),u.transition().call(t)}),k.on("chartClick",function(){P.enabled()&&P.dispatch.call("closeMenu",this),z.enabled()&&z.dispatch.call("closeMenu",this)}),C.dispatch.on("elementClick",function(e){k.call("chartClick",this),G(g,e,t,u)})}),t}var n={barLegend:{close:"Hide bar legend",open:"Show bar legend",noLabel:"undefined"},lineLegend:{close:"Hide line legend",open:"Show line legend",noLabel:"undefined"}},r={top:10,right:10,bottom:10,left:10},i=null,o=null,l=!1,c=!0,f="ltr",h=!0,p=!1,g=0,m=0,v={},y=D(n),b=function(t){return t.x},x=function(t){return t.y},w=S.buildLocality(),k=e.dispatch("chartClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),M=function(e,n,r,a){return a?S.dateFormat(r,"%x",t.locality()):r},A=function(e,n,r,a){var i=2;return S.numberFormatSI(e,i,a,t.locality())},I=A,C=d().stacked(!0).clipEdge(!1).withLine(!0).nice(!1),L=u().color(function(t,e){return"#FFF"}).fill(function(t,e){return"#FFF"}).useVoronoi(!1).nice(!1),T=u().useVoronoi(!1).color("data").nice(!1),E=a(),N=a(),P=s().align("left").position("middle"),z=s().align("right").position("middle"),O=null,_=function(t,e,n,r,a){return"<p><b>"+t+"</b></p><p><b>"+n+"</b></p><p><b>"+e+"%</b></p>"},H=function(t,e,n,r,a){return"<p><p>"+t+": <b>"+n+"</b></p>"},B=function(t,e,n,r,a){return"<p>"+r.key+": <b>"+n+"</b></p>"},R=function(e,n,r){var a=e.series.key,i=(100*e.point.y/r[e.pointIndex].t).toFixed(1),o=T.y()(e.point,e.pointIndex),s="bar"===e.series.type?_(a,i,o,e,t):H(a,i,o,e,t);return F.show(e.e,s,"s",null,n)},V=function(e,n){var r=B(e.key,0,e.val,e,t);return F.show(e.e,r,"s",null,n)},G=function(t,e,n,r){};return T.dispatch.on("elementMouseover.tooltip",function(t){k.call("tooltipShow",this,t)}),T.dispatch.on("elementMousemove.tooltip",function(t){k.call("tooltipMove",this,t)}),T.dispatch.on("elementMouseout.tooltip",function(){k.call("tooltipHide",this)}),C.dispatch.on("elementMouseover.tooltip",function(t){k.call("tooltipShow",this,t)}),C.dispatch.on("elementMousemove.tooltip",function(t){k.call("tooltipMove",this,t)}),C.dispatch.on("elementMouseout.tooltip",function(){k.call("tooltipHide",this)}),t.dispatch=k,t.linesBackground=L,t.lines=T,t.multibar=C,t.barLegend=P,t.lineLegend=z,t.xAxis=E,t.xAxisLabel=E.axisLabel,t.yAxis=N,t.yAxisLabel=N.axisLabel,t.options=S.optionsFunc.bind(t),S.rebind(t,C,"id","xScale","yScale","xDomain","yDomain","forceY","color","fill","classes","gradient"),S.rebind(t,C,"stacked","showValues","valueFormat","nice","textureFill"),S.rebind(t,E,"rotateTicks","staggerTicks","wrapTicks","reduceXTicks"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t){return S.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex},s=function(t,n){var r=a.lineColor?a.lineColor:{c1:"#1A8221",c2:"#62B464",l:1};return t.color||e.interpolateHsl(e.rgb(r.c1),e.rgb(r.c2))(t.seriesIndex/2)},l=function(t,e){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t){return e.interpolateHsl(e.rgb(a.barColor.c1),e.rgb(a.barColor.c2))(t.seriesIndex/a.barColor.l)};break;case"class":i=function(){return"inherit"},o=function(t){var e=t.seriesIndex,n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+e+" sc-fill"+n},l=function(t){var e=t.seriesIndex,n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+e+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t){return t.classes?"inherit":t.color||S.defaultColor()(t,t.seriesIndex)},o=function(t){return"sc-series sc-series-"+t.seriesIndex+(t.classes?" "+t.classes:"")},l=function(t){return"sc-series sc-series-"+t.seriesIndex+(t.classes?" "+t.classes:"")}}var c=a.gradient?function(t){var e={orientation:a.orientation||"vertical",position:a.position||"middle"};return C.gradientFill(t,t.seriesIndex,e)}:i;return C.color(i),C.fill(c),C.classes(o),T.color(s),T.fill(s),T.classes(l),P.color(i),P.classes(o),z.color(s),z.classes(l),t},t.x=function(e){return arguments.length?(b=e,T.x(e),C.x(e),t):b},t.y=function(e){return arguments.length?(x=e,T.y(e),C.y(e),t):x},t.margin=function(e){if(!arguments.length)return r;for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return t},t.width=function(e){return arguments.length?(i=e,t):i},t.height=function(e){return arguments.length?(o=e,t):o},t.showTitle=function(e){return arguments.length?(l=e,t):l},t.showLegend=function(e){return arguments.length?(c=e,t):c},t.tooltipBar=function(e){return arguments.length?(_=e,t):_},t.tooltipLine=function(e){return arguments.length?(H=e,t):H},t.tooltipQuota=function(e){return arguments.length?(B=e,t):B},t.tooltips=function(e){return arguments.length?(h=e,t):h},t.clipEdge=function(e){return arguments.length?(p=e,C.clipEdge(e),L.clipEdge(e),T.clipEdge(e),t):p},t.state=function(e){return arguments.length?(v=e,t):v},t.strings=function(e){return arguments.length?(e.barLegend||(e.barLegend=n.barLegend),e.lineLegend||(e.lineLegend=n.lineLegend),y=D(e),P.strings(y.barLegend),z.strings(y.lineLegend),t):y},t.direction=function(e){return arguments.length?(f=e,C.direction(e),E.direction(e),N.direction(e),P.direction(e),z.direction(e),t):f},t.duration=function(e){return arguments.length?(m=e,C.duration(e),L.duration(e),T.duration(e),t):m},t.delay=function(e){return arguments.length?(g=e,C.delay(e),L.delay(e),T.delay(e),t):g},t.seriesClick=function(e){return arguments.length?(G=e,t):G},t.colorFill=function(e){return t},t.xValueFormat=function(e){return arguments.length?(M=e,t):M},t.yValueFormat=function(e){return arguments.length?(A=e,t):A},t.quotaValueFormat=function(e){return arguments.length?(I=e,t):I},t.locality=function(e){return arguments.length?(w=S.buildLocality(e),C.locality(e),L.locality(e),t):w},t}function A(){function t(i){return i.each(function(i){function o(t,e){var r=t&&t.length,a=(A-n.left-n.right)/2+n.left,i=(I-n.top-n.bottom)/2+n.top;return S.displayNoData(r,f,e||h.noData,a,i)}var l=this,f=e.select(this),b="pie",k=i?i.properties||{}:{},M=i?i.data||null:null,A=parseInt(f.style("width"),10),I=parseInt(f.style("height"),10),C="datetime"===k.xDataType||!1,D="currency"===k.yDataType||!1;if(t.update=function(){f.transition().duration(s).call(t)},t.container=this,o(M))return t;t.setActiveState=function(t,e){t.active=e},t.clearActive=function(e){M.forEach(function(n){t.setActiveState(n,e||"")}),delete u.active},t.seriesActivate=function(e){var n=e.series||M[e.seriesIndex],r;n&&(d?(r="undefined"==typeof n.active||"inactive"===n.active||""===n.active?"active":"",t.clearActive("active"===r?"inactive":""),t.setActiveState(n,r),u.active=M.map(function(t){return"active"===t.active})):t.dataSeriesActivate({series:n}))},t.dataSeriesActivate=function(e){var n=e.series;n.active=n.active&&"inactive"!==n.active?"inactive":"active","active"===n.active&&M.filter(function(t){return"active"!==t.active}).forEach(function(t){return t.active="inactive",t}),M.filter(function(t){return"active"===t.active}).length||t.clearActive()},M.forEach(function(t,n){t.seriesIndex=n,t.values||(t.value?isNaN(t.value)||(t.values=[{x:0,y:parseInt(t.value,10)}]):t.values=[]),t.values.forEach(function(e,r){e.index=n,e.series=t,"undefined"==typeof e.value&&(e.value=e.y)}),t.key=t.key||h.noLabel,t.value=t.value||e.sum(t.values,function(t){return t.value}),t.count=t.count||t.values.length,t.disabled=t.disabled||0===t.value});var L=M.filter(function(t){return!t.disabled});if(L.length||(L=[{values:[]}]),k.count=e.sum(L,function(t){return t.count}),k.total=e.sum(L,function(t){return t.value}),u.disabled=M.map(function(t){return!!t.disabled}),!k.total)return o(),t;m.chart(t).title(k.title).controlsData(v).legendData(M);var T=f.selectAll("g.sc-chart-wrap").data([L]),E=T.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+b),N=f.select(".sc-chart-wrap").merge(E);E.append("defs");var P=N.select("defs");E.append("g").attr("class","sc-background-wrap");var z=N.select(".sc-background-wrap");E.append("g").attr("class","sc-title-wrap"),E.append("g").attr("class","sc-"+b+"-wrap");var O=N.select(".sc-"+b+"-wrap");E.append("g").attr("class","sc-controls-wrap"),E.append("g").attr("class","sc-legend-wrap"),N.attr("transform",S.translation(n.left,n.top)),E.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){var e,i,l,c,u,d,p,v;return A=parseInt(f.style("width"),10),I=parseInt(f.style("height"),10),e=r||A||960,i=a||I||400,l=e-n.left-n.right,c=i-n.top-n.bottom,u={top:0,right:0,bottom:0,left:0},d=l-u.left-u.right,p=c-u.top-u.bottom,z.select(".sc-background").attr("width",e).attr("height",i),m.width(l).height(c),f.call(m),v=m.getHeight(),u.top+=v,p=c-u.top-u.bottom,100>p?(o(null,h.displayError),t):(g.width(d).height(p),void O.datum(L).attr("transform",S.translation(u.left,u.top)).transition().duration(s).call(g))},t.render(),m.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,e.active=!1,M.filter(function(t){return!t.disabled}).length||M.forEach(function(t){t.disabled=!1}),M.filter(function(t){return"active"===t.active}).length||M.forEach(function(t){t.active=""}),u.disabled=M.map(function(t){return!!t.disabled}),p.call("stateChange",this,u),t.update()}),p.on("tooltipShow",function(t){c&&(y=x(t,l.parentNode,k))}),p.on("tooltipMove",function(t){y&&F.position(l.parentNode,y,t)}),p.on("tooltipHide",function(){c&&F.cleanup()}),p.on("changeState",function(e){"undefined"!=typeof e.disabled&&(L.forEach(function(t,n){t.disabled=e.disabled[n]}),u.disabled=e.disabled),t.update()}),p.on("chartClick",function(){m.controls.enabled()&&m.controls.dispatch.call("closeMenu",this),m.legend.enabled()&&m.legend.dispatch.call("closeMenu",this)}),g.dispatch.on("elementClick",function(e){p.call("chartClick",this),w(M,e,t)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,a=null,i="ltr",o=0,s=0,c=!0,u={},d=!0,h=D(),p=e.dispatch("chartClick","elementClick","tooltipShow","tooltipHide","tooltipMove","stateChange","changeState"),g=f(),m=l(),v=[],y=null,b=function(e,n){var r=g.getValue()(e),a=n.total?(100*r/n.total).toFixed(1):100,i="currency"===n.yDataType,o={key:g.fmtKey()(e),label:i?h.tooltip.amount:h.tooltip.count,value:S.numberFormat(r,2,i,t.locality()),percent:S.numberFormat(a,2,!1,t.locality())};return F.single(o,h)},x=function(t,e,n){var r=b(t,n);return F.show(t.e,r,null,null,e)},w=function(t,e,n){};return m.showTitle(!0).showControls(!1).showLegend(!0).alignLegend("center"),g.dispatch.on("elementMouseover.tooltip",function(t){p.call("tooltipShow",this,t)}),g.dispatch.on("elementMousemove.tooltip",function(t){p.call("tooltipMove",this,t)}),g.dispatch.on("elementMouseout.tooltip",function(){p.call("tooltipHide",this)}),t.dispatch=p,t.pie=g,t.legend=m.legend,t.controls=m.controls,t.options=S.optionsFunc.bind(t),S.rebind(t,g,"id","color","fill","classes","gradient","locality","textureFill"),S.rebind(t,g,"getKey","getValue","getCount","fmtKey","fmtValue","fmtCount"),S.rebind(t,g,"showLabels","showLeaders","donutLabelsOutside","pieLabelsOutside","labelThreshold"),S.rebind(t,g,"arcDegrees","rotateDegrees","minRadius","maxRadius","fixedRadius","startAngle","endAngle","donut","hole","holeFormat","donutRatio"),S.rebind(t,m,"showTitle","showControls","showLegend"),t.colorData=function(n){var r=arguments[0],a=arguments[1]||{},i=function(t,e){return S.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex};switch(r){case"graduated":i=function(t,n){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(t.seriesIndex/a.l)};break;case"class":i=function(){return"inherit"},o=function(t,e){var n=t.seriesIndex*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-series sc-series-"+t.seriesIndex+" sc-fill"+n+" sc-stroke"+n};break;case"data":i=function(t,e){return S.defaultColor()(t,t.seriesIndex)},o=function(t,e){return"sc-series sc-series-"+t.seriesIndex+(t.classes?" "+t.classes:"")}}var s=a.gradient?function(t,e){return g.gradientFill(t,t.seriesIndex)}:i;return g.color(i),g.fill(s),g.classes(o),m.legend.color(i),m.legend.classes(o),t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.tooltips=function(e){return arguments.length?(c=e,t):c},t.tooltipContent=function(e){return arguments.length?(b=e,t):b},t.state=function(e){return arguments.length?(u=e,t):u},t.strings=function(e){return arguments.length?(h=D(e),m.strings(h),t):h},t.direction=function(e){return arguments.length?(i=e,g.direction(e),m.direction(e),t):i},t.duration=function(e){return arguments.length?(s=e,g.duration(e),t):s},t.delay=function(e){return arguments.length?(o=e,g.delay(e),t):o},t.seriesClick=function(e){return arguments.length?(w=e,t):w},t}function I(){function t(r){return r.each(function(r){function a(t){z=e.hierarchy(t,function(t){return t.children}),B(z),O=z.descendants(),O.forEach(function(t){y(t,2*t.depth*(p?l.width:l.height))}),_=O.slice(1)}function c(t){b(t,w(t)),x(t,k(t)),t.children&&t.children.length&&t.children.forEach(c)}function m(t,e){var n=k(t)-(p?0:l.height-3*i),r=w(t)-(p?l.width-2*i:0),a=k(e),o=w(e),s=p?(r+o)/2:r,c=p?n:(n+a)/2,u=p?(r+o)/2:o,d=p?a:(n+a)/2;return"M"+r+","+n+"C"+s+","+c+" "+u+","+d+" "+o+","+a}function v(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null)}function F(e){v(e.data),t.update(e)}function L(t){var e="node-"+I(t);return e}function T(t){var e="link-"+(t.parent?I(t.parent):0)+"-"+I(t);return e}var E=e.select(this),N=r,P=e.transition("tree").duration(o).ease(e.easeLinear),z=null,O=null,_=null,H=null,B=e.tree().size([null,null]).nodeSize([p?l.height:l.width,1]).separation(function J(t,e){return t.parent==e.parent,1}),R={width:parseInt(E.style("width"),10)-n.left-n.right,height:parseInt(E.style("height"),10)-n.top-n.bottom},V=E.selectAll("g.sc-chart-wrap").data([1]),G=V.enter().append("g").attr("class","sc-chart-wrap sc-chart-tree"),W=E.select(".sc-chart-wrap").merge(G),Y=G.append("defs"),q=W.select("defs").merge(Y),X=S.dropShadow("node_back_"+g,q,{blur:2});Y.append("clipPath").attr("id","sc-edge-clip-"+g).append("rect");var j=q.select("#sc-edge-clip-"+g+" rect");j.attr("width",R.width).attr("height",R.height).attr("x",n.left).attr("y",n.top),W.attr("clip-path",D?"url(#sc-edge-clip-"+g+")":""),G.append("rect").attr("class","sc-chart-background").attr("width",R.width).attr("height",R.height).attr("transform",S.translation(n.left,n.top)).style("fill","transparent");var K=W.select(".sc-chart-background"),Z=G.append("g").attr("class","sc-tree-wrap"),U=W.select(".sc-tree-wrap");Z.append("g").attr("class","sc-wrap sc-tree");var $=W.select(".sc-wrap.sc-tree");t.setZoom=function(){H=e.zoom().scaleExtent([s.min,s.max]).on("zoom",function(){U.attr("transform","translate("+e.event.transform.x+","+e.event.transform.y+")scale("+e.event.transform.k+")"),d(e.event.transform.k)})},t.unsetZoom=function(t){H.on("zoom",null)},t.resetZoom=function(){W.call(H.transform,e.zoomIdentity)},t.orientation=function(e){p="horizontal"!==e&&p?!1:!0,B.nodeSize([p?l.height:l.width,1]),t.update(z)},t.showall=function(){function e(t){t._children&&t._children.length&&(t.children=t._children,t._children=null),t.children&&t.children.length&&t.children.forEach(e)}N=r,e(N),t.update(z)},t.zoomStep=function(t){var n=e.zoomTransform(W.node()),r=n.k+t;return this.zoomLevel(r)},t.zoomLevel=function(t){var n=e.zoomTransform(W.node()),r=Math.min(Math.max(t,s.min),s.max),a=n.k,i=[n.x,n.y],o=K.node().getBoundingClientRect(),l=[o.width,o.height],c=[(l[0]-l[0]*r)/2,(l[1]-l[1]*r)/2],u=[r*(i[0]-(l[0]-l[0]*a)/2)/a,r*(i[1]-(l[1]-l[1]*a)/2)/a],d=[c[0]+u[0],c[1]+u[1]],f=e.zoomIdentity.translate(d[0],d[1]).scale(r);return W.call(H.transform,f),r},t.zoomScale=function(){var t=e.zoomTransform(W.node());return t.k},t.filter=function(e){function n(t){I(t)===e?(N=t,a=!0):!a&&t.children&&t.children.forEach(n)}var a=!1;n(r),t.update(z)},t.update=function(e){function n(t){if(I(e)===I(z))return m(z,z);var n={x:M(e),y:A(e)};return m(n,n)}function r(t){return m(t,t.parent)}function s(){return m(d,d)}var d={x:0,y:0};a(N);var g=(p?i-l.width:l.width/-2)+"px",v=(p?(i-l.height)/2:2*i-l.height)+"px",y=$.selectAll("g.sc-card").data(O,I),b;b=y.enter().insert("g").attr("class","sc-card").attr("id",L).attr("opacity",function(t){return I(e)===I(t)?1:0}).attr("transform",function(t){return I(e)===I(z)?"translate("+w(z)+","+k(z)+")":"translate("+(p?A(e):M(e))+","+(p?M(e):A(e))+")"}),b.each(function(t){var e,n;q.select("#"+C(t)).empty()&&(e=q.append("svg").attr("class","sc-foreign-object").attr("id",C(t)).attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("x",g).attr("y",v).attr("width",l.width+"px").attr("height",l.height+"px").attr("viewBox","0 0 "+l.width+" "+l.height).attr("xml:space","preserve"),n=e.append("g").attr("class","sc-tree-node-content").attr("transform","translate("+i+","+i+")"),u(n,t,l.width-2*i,l.height-3*i))}),b.append("use").attr("xlink:href",function(t){return"#"+C(t)}).attr("filter",X).on("click",h);var x;x=$.selectAll("g.sc-card").merge(b),x.transition(P).duration(o).attr("opacity",1).attr("transform",function(t){return I(e)===I(t)&&(d={x:p?k(t):w(t),y:p?w(t):k(t)}),"translate("+w(t)+","+k(t)+")"}).on("end",f);var S;S=y.exit().transition(P).duration(o).attr("opacity",0).attr("transform",function(t){return"translate("+M(e)+","+A(e)+")"}).remove(),S.selectAll(".sc-expcoll").style("stroke-opacity",1e-6),q.selectAll(".sc-foreign-object").attr("x",g).attr("y",v);var D;D=b.append("g").attr("class","sc-expcoll").style("opacity",1e-6).on("click",F),D.append("circle").attr("class","sc-circ-back").attr("r",i),D.append("line").attr("class","sc-line-vert").attr("x1",0).attr("y1",.5-i).attr("x2",0).attr("y2",i-.5).style("stroke","#bbb"),D.append("line").attr("class","sc-line-hrzn").attr("x1",.5-i).attr("y1",0).attr("x2",i-.5).attr("y2",0).style("stroke","#fff");var E;E=$.selectAll("g.sc-expcoll").merge(D),E.style("opacity",function(t){return t.data.children&&t.data.children.length||t.data._children&&t.data._children.length?1:0}),E.select(".sc-circ-back").style("fill",function(t){return t.data._children&&t.data._children.length?"#777":t.data.children?"#bbb":"none"}),E.select(".sc-line-vert").style("stroke",function(t){return t.data._children&&t.data._children.length?"#fff":"#bbb"});var H=$.selectAll("path.link").data(_,T),B=H.enter().insert("path","g").attr("d",n).attr("class","link").attr("id",T).attr("opacity",0),R;R=$.selectAll("path.link").merge(B),R.transition(P).duration(o).attr("d",r).attr("opacity",1),H.exit().transition(P).duration(o).attr("d",s).attr("opacity",0).remove(),c(z),t.resize(I(e)===I(z))},t.render=function(){t.resize(!0)},t.resize=function(r){r="undefined"==typeof r?!0:r,t.resetZoom(),R={width:parseInt(E.style("width"),10)-n.left-n.right,height:parseInt(E.style("height"),10)-n.top-n.bottom};var a=[Math.abs(e.min(O,w))+Math.abs(e.max(O,w))+l.width,Math.abs(e.min(O,k))+Math.abs(e.max(O,k))+l.height],i=R.width/a[0],s=R.height/a[1],c=e.min([i,s]),u=[Math.abs(e.min(O,w))+(s>i?0:(R.width/c-a[0])/2),Math.abs(e.min(O,k))+(s>i?(R.height/c-a[1])/2:0)],d=[l.width/(p?1:2),l.height/(p?2:1)],f=[(u[0]+d[0])*c+n.left/(p?2:1),(u[1]+d[1])*c+n.top/(p?1:2)];
j.attr("width",R.width).attr("height",R.height),K.attr("width",R.width).attr("height",R.height),$.transition(P).duration(r?0:o).attr("transform","translate("+f+")scale("+c+")")},t.setZoom(),W.call(H),a(N),c(z),t.update(z)}),t}var n={top:10,right:10,bottom:10,left:10},r=null,a=null,i=6,o=0,s={min:.25,max:2},l={width:100,height:50},c="../img/",u=function(t){return'<div class="sc-tree-node"></div>'},d=function(t){},f=function(t){},h=function(t){},p=!1,g=Math.floor(1e4*Math.random()),m=function(t,e){return S.defaultColor()(t,e)},v=function(t,e){return m(t,e)},y=function(t,e){t.y=e},b=function(t,e){t.data.x0=e},x=function(t,e){t.data.y0=e},w=function(t){return p?t.y:t.x},k=function(t){return p?t.x:t.y},M=function(t){return p?t.data.y0:t.data.x0},A=function(t){return p?t.data.x0:t.data.y0},I=function(t){return t.id||t.data.id},C=function(t){return"card-"+I(t)},F=!1,D=!0,L=!0,T=e.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout");return t.dispatch=T,t.options=S.optionsFunc.bind(t),t.id=function(e){return arguments.length?(g=e,t):g},t.margin=function(e){return arguments.length?(n=e,t):n},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.x=function(e){return arguments.length?(w=e,t):w},t.y=function(e){return arguments.length?(k=S.functor(e),t):k},t.showLabels=function(e){return arguments.length?(L=e,t):L},t.color=function(e){return arguments.length?(m=e,t):m},t.fill=function(e){return arguments.length?(v=e,t):v},t.useClass=function(e){return arguments.length?(F=e,t):F},t.radius=function(e){return arguments.length?(i=e,t):i},t.duration=function(e){return arguments.length?(o=e,t):o},t.zoomExtents=function(e){return arguments.length?(s=e,t):s},t.zoomCallback=function(e){return arguments.length?(d=e,t):d},t.nodeSize=function(e){return arguments.length?(l=e,t):l},t.nodeImgPath=function(e){return arguments.length?(c=e,t):c},t.nodeRenderer=function(e){return arguments.length?(u=e,t):u},t.nodeCallback=function(e){return arguments.length?(f=e,t):f},t.nodeClick=function(e){return arguments.length?(h=e,t):h},t.horizontal=function(e){return arguments.length?(p=e,t):p},t.getId=function(e){return arguments.length?(I=e,t):I},t.getCardId=function(e){return arguments.length?(C=e,t):C},t}function C(){function t(i){return i.each(function(i){function o(t,e){var r=t&&t.length&&t.filter(function(t){return t&&t.children&&t.children.length}).length,a=(m-n.left-n.right)/2+n.left,i=(M-n.top-n.bottom)/2+n.top;return S.displayNoData(r,u,e||h.noData,a,i)}var l=this,u=e.select(this),d="treemap",f={},g=[i],m=parseInt(u.style("width"),10),M=parseInt(u.style("height"),10);if(t.update=function(){u.transition().duration(s).call(t)},t.setActiveState=function(t,e){t.active=e},t.clearActive=function(e){var n=e||g;n.children&&n.children.forEach(function(e){t.setActiveState(e,"")})},t.cellActivate=function(e){var n=e.d,r;n&&(r="undefined"==typeof n.active||"inactive"===n.active||""===n.active?"active":"",t.clearActive(n.parent),n.active=r,t.render())},t.container=this,o(g))return t;var A=g.filter(function(t){return!t.disabled});if(!A.length)return o(),t;b.chart(t).title(f.title).controlsData(x).legendData(g);var I=u.selectAll("g.sc-chart-wrap").data([A]),C=I.enter().append("g").attr("class","sc-chart-wrap sc-chart-"+d),D=u.select(".sc-chart-wrap").merge(C);C.append("defs"),C.append("g").attr("class","sc-background-wrap");var L=D.select(".sc-background-wrap");C.append("g").attr("class","sc-title-wrap"),C.append("g").attr("class","sc-"+d+"-wrap");var T=D.select(".sc-"+d+"-wrap");C.append("g").attr("class","sc-controls-wrap"),C.append("g").attr("class","sc-legend-wrap"),D.attr("transform",S.translation(n.left,n.top)),C.select(".sc-background-wrap").append("rect").attr("class","sc-background").attr("x",-n.left).attr("y",-n.top).attr("fill","#FFF"),t.render=function(){var e,i,l,c,d,f,p,g;return m=parseInt(u.style("width"),10),M=parseInt(u.style("height"),10),e=r||m||960,i=a||M||400,l=e-n.left-n.right,c=i-n.top-n.bottom,d={top:0,right:0,bottom:0,left:0},f=l-d.left-d.right,p=c-d.top-d.bottom,L.select(".sc-background").attr("width",e).attr("height",i),b.width(l).height(c),u.call(b),g=b.getHeight(),p=c-d.top-d.bottom,100>p?(o(null,h.displayError),t):(y.width(f).height(p),void T.datum(A).attr("transform",S.translation(d.left,d.top)).transition().duration(s).call(y))},t.render(),b.legend.dispatch.on("legendClick",function(e,n){e.disabled=!e.disabled,g.filter(function(t){return!t.disabled}).length||g.forEach(function(t){t.disabled=!1}),t.update()}),p.on("tooltipShow",function(t){c&&(w=k(t,l.parentNode))}),p.on("tooltipMove",function(t){w&&F.position(l.parentNode,w,t)}),p.on("tooltipHide",function(){c&&F.cleanup()}),y.dispatch.on("chartClick",function(e){e.children&&t.clearActive(e)}),y.dispatch.on("elementClick",function(e){v(g,e,t)})}),t}var n={top:10,right:10,bottom:10,left:10},r=null,a=null,i="ltr",o=0,s=0,c=!0,u="default",d=e.scaleOrdinal(e.schemeCategory20).range().map(S.identity),f={},h=D(),p=e.dispatch("chartClick","elementClick","tooltipShow","tooltipHide","tooltipMove","elementMousemove"),m=function(t,e){var n="<h3>"+t.data.name+"</h3><p>"+S.numberFormatSI(t.value)+"</p>";return n},v=function(t,e,n){},y=g(),b=l(),x=[],w=null,k=function(t,e,n){var r=m(t.point,n);return F.show(t.e,r,null,null,e)};return b.showTitle(!0).showControls(!1).showLegend(!1),y.dispatch.on("elementMouseover.tooltip",function(t){p.call("tooltipShow",this,t)}),y.dispatch.on("elementMousemove.tooltip",function(t){p.call("tooltipMove",this,t)}),y.dispatch.on("elementMouseout.tooltip",function(){p.call("tooltipHide",this)}),t.dispatch=p,t.treemap=y,t.legend=b.legend,t.options=S.optionsFunc.bind(t),S.rebind(t,y,"id","color","fill","classes","gradient"),S.rebind(t,y,"leafClick","getValue","getKey","textureFill"),S.rebind(t,b,"showTitle","showControls","showLegend"),t.colorData=function(n){if(!arguments.length)return u;var r=arguments[0],a=arguments[1]||{},i=function(t,e){var n="data"===r&&t.color?{color:t.color}:{};return S.getColor(d)(n,e)},o=function(t,e){return"sc-child"};switch(r){case"graduated":i=function(t,n,r){return e.interpolateHsl(e.rgb(a.c1),e.rgb(a.c2))(n/r)};break;case"class":i=function(){return"inherit"},o=function(t,e){var n=e*(a.step||1)%14;return n=(n>9?"":"0")+n,"sc-child "+(t.className||"sc-fill"+n)}}var s=a.gradient?function(t,e){var n={orientation:a.orientation||"horizontal",position:a.position||"base"};return y.gradientFill(t,e,n)}:i;return y.color(i),y.fill(s),y.classes(o),b.legend.color(i),b.legend.classes(o),u=arguments[0],t},t.margin=function(e){if(!arguments.length)return n;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.tooltips=function(e){return arguments.length?(c=e,t):c},t.tooltipContent=function(e){return arguments.length?(m=e,t):m},t.strings=function(e){return arguments.length?(h=D(e),b.strings(h),t):h},t.direction=function(e){return arguments.length?(i=e,y.direction(e),b.direction(e),t):i},t.duration=function(e){return arguments.length?(s=e,y.duration(e),t):s},t.delay=function(e){return arguments.length?(o=e,y.delay(e),t):o},t.seriesClick=function(e){return arguments.length?(v=e,t):v},t}e=e&&e.hasOwnProperty("default")?e["default"]:e;var S={};S.identity=function(t){return t},S.functor=function O(t){return"function"==typeof t?t:function(){return t}},S.isFunction=function(t){var e={};return t&&"[object Function]"==e.toString.call(t)},S.rebind=function(t,e){for(var r=1,a=arguments.length,i;++r<a;)t[i=arguments[r]]=n(t,e,e[i]);return t},S.optionsFunc=function(t){return t?(e.map(t).each(function(t,e){var n=this[e],r=S.toNative(t);S.isFunction(n)&&(Array.isArray(r)?n.apply(r):n(r))}.bind(this)),this):this},S.windowSize=function(){var t={};return window.innerWidth&&window.innerHeight?(t.width=window.innerWidth,t.height=window.innerHeight):document.body&&document.body.offsetWidth?(t.width=document.body.offsetWidth,t.height=document.body.offsetHeight):"CSS1Compat"===document.compatMode&&document.documentElement&&document.documentElement.offsetWidth?(t.width=document.documentElement.offsetWidth,t.height=document.documentElement.offsetHeight):(t.width=640,t.height=480),t},S.windowResize=function(t){window.attachEvent?window.attachEvent("onresize",t):window.addEventListener&&window.addEventListener("resize",t,!0)},S.windowUnResize=function(t){window.detachEvent?window.detachEvent("onresize",t):window.removeEventListener&&window.removeEventListener("resize",t,!0)},S.resizeOnPrint=function(t){if(window.matchMedia){var e=window.matchMedia("print");e.addListener(function(e){e.matches&&t()})}else window.attachEvent?window.attachEvent("onbeforeprint",t):window.onbeforeprint=t},S.unResizeOnPrint=function(t){if(window.matchMedia){var e=window.matchMedia("print");e.removeListener(function(e){e.matches&&t()})}else window.detachEvent?window.detachEvent("onbeforeprint",t):window.onbeforeprint=null},S.getColor=function(t){return arguments.length?Array.isArray(t)?function(e,n){return e.color||t[n%t.length]}:"[object String]"===Object.prototype.toString.call(t)?function(e){return e.color||"#"+t.replace("#","")}:t:S.defaultColor()},S.defaultColor=function(){var t=e.scaleOrdinal(e.schemeCategory20).range();return function(e,n){return e.color||t[n%t.length]}},S.getTextContrast=function(t,n,r){var a=t,i=e.lab(a),o=i.l,s=o>60?i.darker(4+(o-75)/25).l:i.brighter(4+(18-o)/25).l,l=e.lab(s,0,0),c=l.toString();return r&&r(i,l),c},S.customTheme=function(t,n,r){var a;return n=n||function(t){return t.key},r=r||e.scaleOrdinal(e.schemeCategory20).range(),a=r.length,function(e){var i=n(e);return a||(a=r.length),"undefined"!=typeof t[i]?"function"==typeof t[i]?t[i]():t[i]:r[--a]}},S.colorLinearGradient=function(t,n,r,a,i){var o="lg_gradient_"+n,s=i.select("#"+o);return s.empty()&&("middle"===r.position?S.createLinearGradient(o,r,i,[{offset:"0%","stop-color":e.rgb(a).darker().toString(),"stop-opacity":1},{offset:"20%","stop-color":e.rgb(a).toString(),"stop-opacity":1},{offset:"50%","stop-color":e.rgb(a).brighter().toString(),"stop-opacity":1},{offset:"80%","stop-color":e.rgb(a).toString(),"stop-opacity":1},{offset:"100%","stop-color":e.rgb(a).darker().toString(),"stop-opacity":1}]):S.createLinearGradient(o,r,i,[{offset:"0%","stop-color":e.rgb(a).darker().toString(),"stop-opacity":1},{offset:"50%","stop-color":e.rgb(a).toString(),"stop-opacity":1},{offset:"100%","stop-color":e.rgb(a).brighter().toString(),"stop-opacity":1}])),"url(#"+o+")"},S.createLinearGradient=function(t,e,n,r){var a="horizontal"===e.orientation?"0%":"100%",i="horizontal"===e.orientation?"100%":"0%",o,s,l=n.append("linearGradient");l.attr("id",t).attr("x1","0%").attr("y1","0%").attr("x2",a).attr("y2",i).attr("spreadMethod","pad");for(var c=0;c<r.length;c+=1)o=r[c],s=l.append("stop"),Object.getOwnPropertyNames(o).forEach(function(t){s.attr(t,o[t])})},S.colorRadialGradient=function(t,n,r,a,i){var o="rg_gradient_"+n,s=i.select("#"+o);return s.empty()&&S.createRadialGradient(o,r,i,[{offset:r.s,"stop-color":e.rgb(a).brighter().toString(),"stop-opacity":1},{offset:"100%","stop-color":e.rgb(a).darker().toString(),"stop-opacity":1}]),"url(#"+o+")"},S.createRadialGradient=function(t,e,n,r){var a,i,o;o=n.append("radialGradient").attr("id",t).attr("r",e.r).attr("cx",e.x).attr("cy",e.y).attr("gradientUnits",e.u).attr("spreadMethod","pad");for(var s=0;s<r.length;s+=1)a=r[s],i=o.append("stop"),Object.getOwnPropertyNames(a).forEach(function(t){i.attr(t,a[t])})},S.roundedRectangle=function(t,e,n,r,a){var i="M"+t+","+e+"h"+(n-2*a)+"a"+a+","+a+" 0 0 1 "+a+","+a+"v"+(r-2-2*a)+"a"+a+","+a+" 0 0 1 "+-a+","+a+"h"+(2*a-n)+"a"+-a+","+a+" 0 0 1 "+-a+","+-a+"v"+(-r+2*a+2)+"a"+a+","+a+" 0 0 1 "+a+","+-a+"z";return i},S.dropShadow=function(t,e,n){var r=n||{},a=r.height||"130%",i=r.offset||2,o=r.blur||1,s,l;return e.select("#"+t).empty()&&(s=e.append("filter").attr("id",t).attr("height",a),s.append("feOffset").attr("in","SourceGraphic").attr("result","offsetBlur").attr("dx",i).attr("dy",i),s.append("feColorMatrix").attr("in","offsetBlur").attr("result","matrixOut").attr("type","matrix").attr("values","1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 1 0"),s.append("feGaussianBlur").attr("in","matrixOut").attr("result","blurOut").attr("stdDeviation",o),l=s.append("feMerge"),l.append("feMergeNode"),l.append("feMergeNode").attr("in","SourceGraphic")),"url(#"+t+")"},S.createTexture=function(t,e,n,r){var a="#sc-diagonalHatch-"+e,i="#sc-textureMask-"+e;return t.append("pattern").attr("id","sc-diagonalHatch-"+e).attr("patternUnits","userSpaceOnUse").attr("width",8).attr("height",8).append("path").attr("d","M-1,1 l2,-2 M0,8 l8,-8 M7,9 l1,-1").attr("class","texture-line").attr("stroke","#fff").attr("stroke-linecap","square"),t.append("mask").attr("id","sc-textureMask-"+e).attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").append("rect").attr("x",n||0).attr("y",r||-1).attr("width","100%").attr("height","100%").attr("fill","url("+a+")"),i},S.stringSetLengths=function(t,e,n){var r=[],a=e.select(".tmp-text-strings").select("text");return a.empty()&&(a=e.append("g").attr("class","tmp-text-strings").append("text")),a.classed(n,!0),a.style("display","inline"),t.forEach(function(t){a.text(t),r.push(a.node().getBoundingClientRect().width)}),a.text("").attr("class","tmp-text-strings").style("display","none"),r},S.stringSetThickness=function(t,e,n){var r=[],a=e.select(".tmp-text-strings").select("text");return a.empty()&&(a=e.append("g").attr("class","tmp-text-strings").append("text")),a.classed(n,!0),a.style("display","inline"),t.forEach(function(t){a.text(t),r.push(a.node().getBoundingClientRect().height)}),a.text("").attr("class","tmp-text-strings").style("display","none"),r},S.maxStringSetLength=function(t,n,r,a){var i=S.stringSetLengths(t,n,r,a);return e.max(i)},S.stringEllipsify=function(t,e,n){var r=e.select(".tmp-text-strings").select("text"),a=t,i=0,o=0,s=0;for(r.empty()&&(r=e.append("g").attr("class","tmp-text-strings").append("text")),r.style("display","inline"),r.text("..."),o=r.node().getBoundingClientRect().width,r.text(a),i=r.node().getBoundingClientRect().width,s=i;i>n&&i>30;)a=a.slice(0,-1),r.text(a),i=r.node().getBoundingClientRect().width+o;return r.text(""),a+(s>n?"...":"")},S.getTextBBox=function(t,e){var n=t.node().getBoundingClientRect(),r={width:e?n.width:parseInt(n.width,10),height:e?n.height:parseInt(n.height,10),top:e?n.top:parseInt(n.top,10),left:e?n.left:parseInt(n.left,10)};return r},S.strip=function(t){return t.replace(/(\s|&)/g,"")},S.isRTLChar=function(t){var e="֑-߿יִ-﷿ﹰ-ﻼ",n=new RegExp("["+e+"]");return n.test(t)},S.NaNtoZero=function(t){return S.isNumeric(t)?t:0},S.polarToCartesian=function(t,e,n,r){var a=S.angleToRadians(r),i=t+n*Math.cos(a),o=e+n*Math.sin(a);return[i,o]},S.angleToRadians=function(t){return t*Math.PI/180},S.angleToDegrees=function(t){return 180*t/Math.PI},S.getAbsoluteXY=function(t){var e=document.documentElement,n=t.getBoundingClientRect(),r=e.scrollLeft+document.body.scrollLeft,a=e.scrollTop+document.body.scrollTop,i=n.left+r,o=n.top+a;return{left:i,top:o}},S.translation=function(t,e){return"translate("+t+","+e+")"},S.isNumeric=function(t){var e=parseFloat(t);return!isNaN(e)&&"number"==typeof e&&isFinite(e)},S.toNative=function(t){var e=S.isNumeric(parseFloat(t))?parseFloat(t):"true"===t?!0:"false"===t?!1:t;return e},S.toBoolean=function(t){var e=S.isNumeric(parseFloat(t))?!!parseFloat(t):"true"===t?!0:"false"===t?!1:t;return e},S.round=function(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n},S.countSigFigsAfter=function(t){var e=/^[^\d]*([\d.,\s]+)[^\d]*$/,n=t.toString().match(e)[1].replace(/[,\s]/,"."),r=0;return Math.floor(n)!==parseFloat(n)&&(r=parseFloat(n).toString().split(".").pop().length||0),r},S.countSigFigsBefore=function(t){return Math.floor(t).toString().replace(/0+$/g,"").length},S.siDecimal=function(t){return Math.pow(10,Math.floor(Math.log(t)*Math.LOG10E))},S.siValue=function(t){if(S.isNumeric(t))return S.siDecimal(t);var e={y:1e-24,yocto:1e-24,z:1e-21,zepto:1e-21,a:1e-18,atto:1e-18,f:1e-15,femto:1e-15,p:1e-12,pico:1e-12,n:1e-9,nano:1e-9,"µ":1e-6,micro:1e-6,m:.001,milli:.001,k:1e3,kilo:1e3,M:1e6,mega:1e6,G:1e9,giga:1e9,T:1e12,tera:1e12,P:1e15,peta:1e15,E:1e18,exa:1e18,Z:1e21,zetta:1e21,Y:1e24,yotta:1e24};return e[t]||0},S.numberFormat=function(t,n,r,a){var i,o,s,l,c,u;return i=parseFloat(t),o="boolean"==typeof r?r:!1,!S.isNumeric(i)||0===i&&!o?t.toString():(s=S.countSigFigsAfter(i),l=S.isNumeric(n)?Math.floor(n):"undefined"!=typeof a?a.precision:o?2:null,l=S.isNumeric(l)?s&&o?l:Math.min(l,s):s,c="undefined"==typeof a?e.format:e.formatLocale(a).format,u=o?"$,":",",u+=s?"."+l+"f":"",c(u)(i))},S.numberFormatFixed=function(t,n,r,a){var i,o;return S.isNumeric(t)?(r="boolean"==typeof r?r:!1,n=S.isNumeric(n)?n:r?2:0,i="undefined"==typeof a?e.format:e.formatLocale(a).format,o=r?"$,":",",o+="."+n+"f",i(o)(t)):t.toString()},S.numberFormatSI=function(t,n,r,a){var i,o,s;if(!S.isNumeric(t))return t;if(r="boolean"==typeof r?r:!1,n=S.isNumeric(n)?n:0,i="undefined"==typeof a?e.format:e.formatLocale(a).format,s=S.countSigFigsAfter(t),o=r?"$,":",",r&&s&&1e3>t)t=S.round(t,n),s=S.countSigFigsAfter(t),n=Math.min(s,n),1===n&&(n=2),o+="."+n+"f";else if(Math.abs(t)<1)o+=0===+t.toFixed(n)?".1s":"."+Math.min(n,s)+"f";else{if(!(Math.abs(t)<1e3)){if(i="undefined"==typeof a?e.formatPrefix:e.formatLocale(a).formatPrefix,0!==n){var l=i("."+n+"s",t)(t),c=l.split(".").pop().replace(/[^\d]+$/,"").match(/0+$/g);Array.isArray(c)&&(n-=c.pop().length)}return o+="."+n+"s",i(o,t)(t)}t=S.round(t,n)}return i(o)(t)},S.numberFormatSIFixed=function(t,n,r,a,i){var o,s;return S.isNumeric(t)?(r="boolean"==typeof r?r:!1,n=S.isNumeric(n)?n:r?2:0,o="undefined"==typeof a?e.formatPrefix:e.formatLocale(a).formatPrefix,i=S.siValue(i),s=r?"$,":",",s+="."+n+"s",o(s,i)(t)):t.toString()},S.numberFormatPercent=function(t,e,n){var r,a,i,o;return r=parseFloat(e),a=S.isNumeric(r)&&r>0?100*t/r:100,o=n&&"undefined"!=typeof n.precision?n.precision:1,i=S.numberFormat(a,o,!1,n),i+"%"},S.daysInMonth=function(t,e){return new Date(e,t+1,0).getDate()},S.isValidDate=function(t){return t?t instanceof Date&&!isNaN(t.valueOf()):!1},S.parseDatetime=function(t){var e;return S.isNumeric(Math.floor(t))&&4===t.toString().length?e=new Date(Math.floor(t)+"-1-1 GMT"):parseInt(t,10).toString()===t||parseInt(t,10)===t?e=new Date(parseInt(t,10)):(e=new Date(t),"Z"===t.toString().substr(-1)||-1!==t.toString().indexOf("GMT")||t.toString().match(/\d\d\d\d-\d\d-\d\dT/)||e.setUTCMilliseconds(e.getUTCMilliseconds()-6e4*e.getTimezoneOffset())),S.isValidDate(e)||(e=t),e},S.getDateFormat=function(t,n){var r=["multi","%x, %I:%M:%S.%L %p","%x, %I:%M:%S %p","%x, %I:%M %p","%x, %I %p","%x","%b %d","%B %Y","%Y"],a=t.length?e.min(t,function(t){n===!0&&t.setUTCMilliseconds(t.getUTCMilliseconds()+6e4*t.getTimezoneOffset());var r=new Date(t),a;return a=+e.timeSecond(t)<+r?1:+e.timeMinute(t)<+r?2:+e.timeHour(t)<+r?3:+e.timeDay(t)<+r?4:+e.timeMonth(t)<+r?5:+e.timeYear(t)<+r?7:8}):8;return r[a]},S.getDateFormatUTC=function(t){var n=["multi","%x, %I:%M:%S.%L %p","%x, %I:%M:%S %p","%x, %I:%M %p","%x, %I %p","%x","%b %d","%B %Y","%Y"],r=t.length?e.min(t,function(t){var n=new Date(t),r;return r=+e.utcSecond(t)<+n?1:+e.utcMinute(t)<+n?2:+e.utcHour(t)<+n?3:+e.utcDay(t)<+n?4:+e.utcMonth(t)<+n?5:+e.utcYear(t)<+n?7:8}):8;return n[r]},S.multiFormat=function(t,e){return e===!1?S.getDateFormat([t]):S.getDateFormatUTC([t])},S.dateFormat=function(t,n,r){var a,i,o,s=S.parseDatetime(t);return S.isValidDate(s)?(r&&r.hasOwnProperty("utcFormat")?(i=r.utcFormat,o=n?-1!==n.indexOf("%")?n:S.multiFormat(s):"%Y"):(a=S.buildLocality(r),i=e.timeFormatLocale(a).utcFormat,o=n?-1!==n.indexOf("%")?n:a[n]||S.multiFormat(s):"%Y"),i(o)(s)):t},S.buildLocality=function(t,e){var n=t||{},r=!!e,a=function(t){return t.join("|").split("|").map(function(t){return t?isNaN(t)?t:+t:""})},i={decimal:".",thousands:",",grouping:[3],currency:["$",""],precision:2,periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],date:"%b %-d, %Y",time:"%-I:%M:%S %p",dateTime:"%B %-d, %Y at %X GMT%Z",full:"%A, %c","long":"%c",medium:"%x, %X","short":"%-m/%-d/%y, %-I:%M %p",yMMMEd:"%a, %x",yMEd:"%a, %-m/%-d/%Y",yMMMMd:"%B %-d, %Y",yMMMd:"%x",yMd:"%-m/%-d/%Y",yMMMM:"%B %Y",yMMM:"%b %Y",MMMd:"%b %-d",MMMM:"%B",MMM:"%b",y:"%Y"};return Object.getOwnPropertyNames(n).forEach(function(t){var e=n[t];i[t]=r&&Array.isArray(e)?a(e):e}),i},S.displayNoData=function(t,e,n,r,a){var i=t?[]:[n],o=e.selectAll(".sc-no-data").data(i),s=o.enter().append("text").attr("class","sc-no-data").attr("dy","-.7em").style("text-anchor","middle"),l=e.selectAll(".sc-no-data").merge(s);return o.exit().remove(),i.length?(l.attr("x",r).attr("y",a).text(S.identity),e.selectAll(".sc-chart-wrap").remove(),!0):!1};var F=function(){function t(t,e,n){return t.replace(/>\s+</gm,"><").replace(/{{(\w+)}}/gm,function(t,n){return e[n]||n}).replace(/{{str\s([\w.]+)}}/gm,function(t,e){return n.translate(e)})}return{show:function(t,e,n,r,a,i){var o=document.createElement("div"),s=document.createElement("div"),l=document.createElement("div");return n=n||"s",r=r||5,s.className="tooltip-inner",l.className="tooltip-arrow",s.innerHTML=e,o.style.left=0,o.style.top=-1e3,o.style.opacity=0,o.className=(i||"sc-tooltip")+" tooltip xy-tooltip in",o.appendChild(s),o.appendChild(l),a.appendChild(o),F.position(a,o,t,n,r),o.style.opacity=1,o},cleanup:function(){for(var t=document.getElementsByClassName("tooltip"),e=[],n=t.length;n>0;)n-=1,-1!==t[n].className.indexOf("xy-tooltip")&&(e.push(t[n]),t[n].style.transitionDelay="0 !important",t[n].style.opacity=0,t[n].className="sctooltip-pending-removal out");setTimeout(function(){for(var t;e.length;)t=e.pop(),t.parentNode.removeChild(t)},500)},position:function(t,e,n,r,a){function i(){var t=u[0]-d/2;return g>t&&(t=g),t+d>h&&(t=h-d),t}function o(){var t=u[1]-f/2;return m>t&&(t=m),t+f>m+p&&(t=m-f),t}function s(t){var n=u[0]-d/2-t-5,r=e.getElementsByClassName("tooltip-arrow")[0];r.style.marginLeft=n+"px"}function l(t){var n=u[1]-f/2-t-5,r=e.getElementsByClassName("tooltip-arrow")[0];r.style.marginTop=n+"px"}r=r||"s",a=a||5;var c=t.getBoundingClientRect(),u=[n.clientX-c.left,n.clientY-c.top],d=parseInt(e.offsetWidth,10),f=parseInt(e.offsetHeight,10),h=t.clientWidth,p=t.clientHeight,g=t.scrollLeft,m=t.scrollTop,v=e.className.replace(/ top| right| bottom| left/g,""),y,b;switch(r){case"e":b=o(),y=u[0]-d-a,l(b),g>y?(y=u[0]+a,v+=" right"):v+=" left";break;case"w":b=o(),y=u[0]+a,l(b),y+d>h?(y=u[0]-d-a,v+=" left"):v+=" right";break;case"n":y=i(),b=u[1]+a,s(y),b+f>m+p?(b=u[1]-f-a,v+=" top"):v+=" bottom";break;case"s":y=i(),b=u[1]-f-a,s(y),m>b?(b=u[1]+a,v+=" bottom"):v+=" top"}e.style.left=y+"px",e.style.top=b+"px",e.className=v},single:function(e,n){var r='<div class="tooltip-header">             <b>{{key}}</b>         </div>         <div class="tooltip-grid">             <p><span>{{label}}</span> <span>{{value}}</span></p>'+("undefined"!=typeof e.percent&&String(e.percent).length?"<p><span>{{str tooltip.percent}}</span> <span>{{percent}}%</span></p>":"")+"</div>"+("undefined"!=typeof e.msg&&e.msg.length?'<div class="tooltip-status"><i>{{msg}}</i></div>':"");return t(r,e,n)},multi:function(e,n){var r='<div class="tooltip-grid">             <p><span>{{groupName}}</span> <span>{{groupLabel}}</span></p>'+("undefined"!=typeof e.seriesName&&String(e.seriesName).length?"<p><span>{{seriesName}}</span> <span>{{seriesLabel}}</span></p>":"")+"<p><span>{{valueName}}</span> <span>{{valueLabel}}</span></p>"+("undefined"!=typeof e.percent&&String(e.percent).length?"<p><span>{{str tooltip.percent}}</span> <span>{{percent}}%</span></p>":"")+"</div>"+("undefined"!=typeof e.msg&&e.msg.length?'<div class="tooltip-status"><i>{{msg}}</i></div>':"");return t(r,e,n)}}}(),D=function(){function t(e,n){var r=e?Object.getOwnPropertyNames(e):[];r.length&&r.forEach(function(r){var a=e[r];if("string"==typeof a||a instanceof String)n[r]=a.toString();else{var i=n[r]||(n[r]={});!(i instanceof Object)||i instanceof Date||i instanceof Function||t(a,i)}})}return function(e){var n={legend:{close:"Hide legend",open:"Show legend",noLabel:"undefined"},controls:{close:"Hide controls",open:"Show controls"},tooltip:{amount:"Amount",count:"Count",date:"Date",group:"Group",key:"Key",percent:"Percent"},noData:"No Data Available.",noLabel:"undefined",displayError:"The chart cannot be displayed due to its configuration."};return n.translate=function(t){var e=t.split("."),r=n[e[0]];return"string"==typeof r?r:2===e.length?r[e[1]]:t},t(e,n),n}}(),L={area:r,axis:a,funnel:i,gauge:o,headers:l,line:u,menu:s,multibar:d,pie:f,scatter:c,scroller:h,table:p,treemap:g},T=function(){function t(t){return t[0]}function n(t){return t[1]}function r(t){return t.x}function a(t){return t.y}function i(t,e){return e}function o(t){return t}function s(t){return t.hasOwnProperty("value")||t.hasOwnProperty("y")}function l(t){return Array.isArray(t.values)&&t.values.length}function c(t){return l(t)&&1===t.values.length}function u(t,e){var n=["multibar","line","area","pie","funnel","gauge"];return-1!==n.indexOf(t)&&Array.isArray(e)&&e.filter(function(t){return l(t)||s(t)}).length>0}function d(t,e){var n=["multibar","line","area"];return-1!==n.indexOf(t)&&Array.isArray(e)&&e.length>0}function f(t){return Array.isArray(t)&&t.length>0&&Array.isArray(t[0])}function h(t){return Array.isArray(t)&&t.length>0&&s(t[0])}function p(t){return"undefined"!=typeof t&&String(t.hasOwnProperty("label")?t.label:t).toString()||v}function g(t){return"undefined"!=typeof t&&t.hasOwnProperty("key")?String(t.key).toString()||v:p(t)}function m(t,e){t.hasOwnProperty("disabled")&&(e.disabled=t.disabled),t.hasOwnProperty("color")&&(e.color=t.color),t.hasOwnProperty("classes")&&(e.classes=t.classes)}var v=D().translate("noLabel"),y=function(s,l,c){function v(t,e){var n={group:e+1,label:p(t)};return t.values&&(n.total=y(t)),n}function y(t){var n=0;return t.hasOwnProperty("value")?n=t.value:t.hasOwnProperty("y")?n=t.y:t.hasOwnProperty("values")?n=e.sum(t.values,R):S.isNumeric(t)&&(n=t),n}function x(t,e){var n=E?t:{};return n.x=B(t,e),n.y=R(t,e),n}function w(t,e){return e.values.map(function(e,n){var r=E?e:{},a=H(e,n)+H(t.values[n],n);return r.x=B(e,n),r.y=parseFloat(a),r})}function k(t){var e,n;return n=t.values.map(x),e={key:g(t),values:n},m(t,e),e}function M(t,e,n){var r,a;return a=n.map(function(t,n){var r=t.values[0];return e===n?x(r,n):{x:B(r,n),y:0}}),r={key:g(t),values:a},m(t,r),r}function A(t,e){var n,r;return r=[x(t.values[e]||t.values[0],e)],n={key:g(t),values:r},m(t,n),n}function I(t,n){var r,a;r=t.keys||n.shift().splice(1),L=[],a=e.transpose(n.map(function(t,e){var n=t.shift();return P||z||L.push(v(n,e)),t.map(function(t){return P||z?[n,t]:[e+1,t]})})),F=r.map(function(t,e){return{key:t,values:a[e]}})}var C=s.properties?Array.isArray(s.properties)?s.properties[0]:s.properties:{},F=[],D=[],L=[],T=!1,E=!1,N=!1,P="datetime"===C.xDataType||!1,z="numeric"===C.xDataType||!1,O=!1,_,H,B,R;if(f(s.values)?I(C,s.values):s.values?(F=s.values,L=s.label||[]):(F=s.data,L=C.groups||C.labels||C.label||[]),O=d(l,L),u(l,F)){switch(T=f(F[0].values),E=h(F[0].values),_=T?t:E?r:i,H=T?n:E?a:o,N=b(F,L,_,H),B=O?function(t,e){return e+1}:P?function(t,e){var n,r,a;return n=_(t,e),r=4===n.toString().length?"1/1/"+n.toString():n,"string"==typeof r&&-1===r.indexOf("GMT")&&(r+=" GMT"),a=new Date(r),a.valueOf()}:z?function(t,e){return parseFloat(_(t,e))}:function(t,e){return _(t,e)},R=function(t,e){return parseFloat(H(t,e))},l){case"multibar":"basic"===c?(D=1===F.length?F.map(k):[{key:C.key||"Series 0",values:F.reduce(w)}],C.colorLength=D[0].values.length):D=N?F.map(A):F.map(k);break;case"gauge":case"pie":D=F.map(function(t){var e;return e={key:g(t),value:y(t)},m(t,e),e});break;case"funnel":D=F.reverse().map(function(t,n){var r,a;return r=e.sum(t.values,H),a={key:g(t),values:[{series:n,x:0,y:r,y0:0}]},m(t,a),a});break;case"area":case"line":D=F.map(k)}_=r,H=a,d(l,L)?C.groups=L.map(v):delete C.groups,C.hasOwnProperty("colorLength")||(C.colorLength=D.length),D.forEach(function(t,e){t.seriesIndex=e,t.total=y(t),t.total||(t.disabled=!0)})}else switch(l){case"bubble":if(s.data)C=s.properties,D=s.data;else{var V={"Negotiation/Review":"Negotiat./Review","Perception Analysis":"Percept. Analysis","Proposal/Price Quote":"Proposal/Quote","Id. Decision Makers":"Id. Deciders"};C={title:"Bubble Chart Data",yDataType:"string",xDataType:"datetime",colorLength:s.records.length},D=s.records.map(function(t){return{id:t.id,x:t.date_closed,y:Math.round(parseInt(t.likely_case,10)/parseFloat(t.base_rate)),shape:"circle",account_name:t.account_name,assigned_user_name:t.assigned_user_name,sales_stage:t.sales_stage,sales_stage_short:V[t.sales_stage]||t.sales_stage,probability:parseInt(t.probability,10),base_amount:parseInt(t.likely_case,10),currency_symbol:"$"}})}break;case"pareto":C=s.properties,D=s.data}return{properties:C,data:D}},b=function(t,e,n,r){function a(t,e){return t.reduce(function(t,n){return n.values.reduce(function(t,n){var r=e(n);return-1===t.indexOf(r)&&t.push(r),t},t)},[]).length===t.length}function i(t,e){return t.length===t[0].values.length&&t.filter(function(t){return t.values.filter(function(t){return 0!==e(t)}).length<=1}).length===t.length}function o(t,e,n){return g(t)===p(e[n])}function l(t,e){return null===d?a(t,e):d}function u(t,e){return null===f?i(t,e):f}var d=null,f=null,h=Array.isArray(e)&&e.length>0&&e.length===t.length;return t.reduce(function(a,i,d){return a?s(i)||c(i)&&(h&&o(i,e,d)||l(t,n))||(!h||o(i,e,d))&&u(t,r):!1},!0)};return y.areValuesDiscrete=b,y}(),E={areaChart:m,bubbleChart:v,funnelChart:y,gaugeChart:b,globeChart:x,lineChart:w,multibarChart:k,paretoChart:M,pieChart:A,treeChart:I,treemapChart:C},N="0.7.6",P="scr",z=!1;t.version=N,t.build=P,t.development=z,t.utility=S,t.tooltip=F,t.language=D,t.models=L,t.charts=E,t.transform=T,Object.defineProperty(t,"__esModule",{value:!0})});
